{% extends 'components/baseb.html' %}
{% load static %}
{% csrf_token %}

<!-- Agregar esto justo despu√©s de {% load static %} en tu template -->
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
{% block title %}Modificaci√≥n de Materiales | Biblioteca Digital{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/modificacion_material.css' %}">
<link rel="stylesheet" href="{% static 'css/style_form.css' %}">
<link rel="stylesheet" href="{% static 'css/manual_modal.css' %}">
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/botones.css' %}">
<style>
    .page-header {
        background: linear-gradient(135deg, #4ECDC4, #44A08D);
        color: white;
        padding: 1.5rem 0;
        text-align: center;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 600;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .controls-row {
        background: white;
        padding: 1rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }

    .buscar {
        position: relative;
        width: 100%;
    }

    .buscar input[type="text"] {
        width: 100%;
        padding: 8px 40px 8px 12px;
        border: 1px solid #ddd;
        border-radius: 20px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.3s ease;
    }

    .buscar input[type="text"]:focus {
        border-color: #4ECDC4;
        box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
    }

    .buscar button {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 15px;
        transition: background-color 0.3s ease;
    }

    .buscar button:hover {
        background-color: #f0f0f0;
    }

    .icono-buscar {
        font-size: 16px;
    }

    /* ===== ESTILOS PARA EL FILTRO DE NO DISPONIBLES ===== */
    .mostrar-no-disponibles {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #dee2e6;
        transition: all 0.2s ease;
    }

    .mostrar-no-disponibles:hover {
        background: #e9ecef;
        border-color: #adb5bd;
    }

    .mostrar-no-disponibles input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: #dc3545; /* Color rojo para indicar "no disponibles" */
    }

    .mostrar-no-disponibles label {
        font-size: 14px;
        font-weight: 500;
        color: #495057;
        cursor: pointer;
        margin: 0;
        user-select: none;
    }

    .mostrar-no-disponibles input[type="checkbox"]:checked + label {
        color: #dc3545;
        font-weight: 600;
    }

    /* Indicador visual cuando el filtro est√° activo */
    .mostrar-no-disponibles input[type="checkbox"]:checked {
        transform: scale(1.1);
    }

    .manual-button {
        background-color: #8B1D69 !important;
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
    }

    .manual-button:hover {
        background-color: #6d1552 !important;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .tipo-material-container label {
        font-weight: 600;
        margin-bottom: 5px;
        display: block;
        color: #25898D;
    }

    /* Comentamos estos estilos para que use los del main.css */
    /*
    .tipo-material-container select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        background: white;
    }
    */

    /* Tabla de materiales */
    .tabla-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .libros-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .libros-table thead {
        background: linear-gradient(135deg, #4ECDC4, #44A08D);
        color: white;
    }

    .libros-table th {
        padding: 15px 10px;
        text-align: left;
        font-weight: 600;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .libros-table th.text-center {
        text-align: center;
    }

    .libros-table tbody tr {
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.2s ease;
    }

    .libros-table tbody tr:nth-child(odd) {
        background-color: #f8f9fa;
    }

    .libros-table tbody tr:nth-child(even) {
        background-color: white;
    }

    .libros-table tbody tr:hover {
        background-color: #e8f8f5;
        transform: scale(1.002);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .libros-table td {
        padding: 12px 10px;
        vertical-align: middle;
        font-size: 13px;
    }

    .titulo-cell {
        font-weight: 600;
        color: #2c3e50;
        max-width: 200px;
        word-wrap: break-word;
    }

    .disponibilidad-cell {
        text-align: center;
    }

    .disponible {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-block;
        box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
    }

    .reservado {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-block;
        box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
    }

    .no-disponible {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-block;
        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    }

    .acciones-cell {
        text-align: center;
        white-space: nowrap;
    }

    .btn-icon {
        background: none;
        border: none;
        font-size: 16px;
        margin: 0 3px;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 35px;
        height: 35px;
    }

    .btn-detalle:hover {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
    }

    .btn-editar:hover {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
    }

    .btn-imprimir:hover {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.4);
    }

    .btn-eliminar:hover {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
    }

    .btn-ver-informe:hover {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(52, 73, 94, 0.4);
    }

    .no-results {
        text-align: center;
        color: #7f8c8d;
        font-style: italic;
        padding: 30px;
        font-size: 16px;
    }

    /* Estilos para libros no disponibles */
    .libro-no-disponible {
        opacity: 0.6;
        background-color: #fdf2f2 !important;
    }

    .libro-no-disponible:hover {
        background-color: #f8d7da !important;
    }

    /* Estilos para ordenamiento */
    .ordenar-por {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .ordenar-por label {
        font-weight: 600;
        margin-bottom: 0;
        color: #25898D;
        font-size: 14px;
        white-space: nowrap;
    }

    .ordenar-por select {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        background: white;
        min-width: 150px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .libros-table {
            font-size: 12px;
        }
        
        .libros-table th,
        .libros-table td {
            padding: 8px 5px;
        }
        
        .btn-icon {
            width: 30px;
            height: 30px;
            font-size: 14px;
            margin: 0 2px;
        }
        
        .page-title {
            font-size: 1.5rem;
        }
        
        .controls-row {
            padding: 0.8rem;
        }
    }

    /* ===== ESTILOS PARA EL MODAL DE OBLEAS ===== */

    /* Modal de obleas */
    #obleasModal .modal-dialog {
        max-width: 95%;
        width: 1200px;
    }

    /* Estilos para las obleas */
    .oblea {
        width: 100px;
        height: 140px;
        border: 2px solid #2c3e50;
        border-radius: 8px;
        padding: 8px;
        background: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .oblea:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .oblea .cdu {
        font-size: 14px;
        color: #2c3e50;
        font-weight: 900;
        line-height: 1.2;
        margin-bottom: 8px;
        padding: 4px;
        border-bottom: 1px solid #bdc3c7;
    }

    .oblea .siglas {
        font-size: 12px;
        color: #34495e;
        font-weight: 700;
        margin-bottom: 8px;
        word-wrap: break-word;
        line-height: 1.1;
    }

    .oblea .ejemplar {
        font-size: 16px;
        color: #e74c3c;
        font-weight: 900;
        background: #ecf0f1;
        padding: 4px;
        border-radius: 4px;
        margin-top: auto;
    }

    .oblea .eliminar {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .oblea .eliminar:hover {
        background: #c0392b;
        transform: scale(1.1);
    }

    /* Notificaciones */
    .notificacion-obleas {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #2ecc71;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        font-weight: 600;
        font-size: 14px;
        max-width: 300px;
        animation: slideInRight 0.3s ease;
    }

    .notificacion-obleas.warning {
        background: #f39c12;
    }

    .notificacion-obleas.info {
        background: #3498db;
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    /* Botones del modal */
    #obleasModal .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* ===== ESTILOS PARA EL MODAL DE DAR DE ALTA ===== */
    .modal-dar-alta .modal-content {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .modal-dar-alta .modal-header {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        padding: 1.5rem;
        border: none;
        text-align: center;
    }

    .modal-dar-alta .modal-title {
        font-weight: 700;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
        line-height: 1.3;
    }

    .modal-dar-alta .form-group-custom {
        margin-bottom: 1.5rem;
    }

    .modal-dar-alta .form-group-custom label {
        font-weight: 600;
        color: #28a745;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
        display: block;
    }

    .modal-dar-alta .form-control-custom {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
    }

    .modal-dar-alta .form-control-custom:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        outline: none;
    }

    .modal-dar-alta .select-custom {
        appearance: none;
        background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 12px;
        padding-right: 40px;
    }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid">
    <!-- Controles principales -->
    <div class="controls-row">
        <div class="row align-items-center">
            <!-- Buscador -->
            <div class="col-12 col-md-3 col-lg-2">
                <form method="get" class="buscar">
                    <input type="text" name="q" placeholder="Buscar por..." value="{{ request.GET.q }}" id="searchInput">
                    <button type="submit" title="Buscar">
                        <span class="icono-buscar">üîç</span>
                    </button>
                </form>
            </div>

            <!-- Espacio en blanco -->
            <div class="col-md-3 col-lg-4 d-none d-md-block"></div>

            <!-- Mostrar no disponibles -->
            <div class="col-12 col-md-3 col-lg-2">
                <div class="mostrar-no-disponibles">
                    <input type="checkbox" id="mostrar_no_disponibles" name="mostrar_no_disponibles">
                    <label for="mostrar_no_disponibles">Mostrar no disponibles</label>
                </div>
            </div>

            <!-- Ordenar por -->
            <div class="col-12 col-md-2 col-lg-2">
                <div class="ordenar-por">
                    <label for="ordenar_por">Ordenar por:</label>
                    <select id="ordenar_por" name="ordenar_por">
                        <option value="titulo">T√≠tulo</option>
                        <option value="autor">Autor</option>
                        <option value="fecha">Fecha</option>
                    </select>
                </div>
            </div>

            <!-- Manual de usuario -->
            <div class="col-12 col-md-1 col-lg-2 text-end">
                <button type="button" class="btn btn-dark btn-sm manual-button w-100" onclick="document.getElementById('manualModal').style.display='flex'">
                    MANUAL
                </button>
            </div>
        </div>

        <!-- Segunda fila: Tipo de material -->
        <div class="row mt-3">
            <div class="col-12 col-md-3 col-lg-2">
                <div class="tipo-material-container">
                    <label for="tipo_material" class="text-input" style="color:#25898D;">Tipo de Material:</label>
                    <select class="form-control form-control-sm" id="tipo_material" name="tipo_material">
                        <option value="" selected>Selecciona un tipo de material</option>
                        <option value="libro">LIBRO</option>
                        <option value="mapa">MAPA</option>
                        <option value="multimedia">MULTIMEDIA</option>
                        <option value="notebook">NOTEBOOK</option>
                        <option value="programa">PROGRAMA</option>
                        <option value="proyector">PROYECTOR</option>
                        <option value="varios">VARIOS</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de libros -->
    <div class="tabla-container" id="libros-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th>T√≠tulo</th>
                    <th>Autor</th>
                    <th>Editorial</th>
                    <th>Clasificaci√≥n</th>
                    <th>Etiquetas</th>
                    <th class="text-center">Sede</th>
                    <th>Observaciones</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="libros-table">
                {% if libros %}
                    {% for libro in libros %}
                    <tr class="libro-row{% if libro.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ libro.estado|lower }}"
                        data-titulo="{{ libro.titulo|lower }}"
                        data-autor="{{ libro.autor|lower }}"
                        data-editorial="{{ libro.editorial|lower }}">
                        <td class="text-center">{{ libro.id_libro|default:'' }}</td>
                        <td class="titulo-cell">{{ libro.titulo }}</td>
                        <td>{{ libro.autor }}</td>
                        <td>{{ libro.editorial }}</td>
                        <td class="text-center">{{ libro.clasificacion_cdu|default:'' }}</td>
                        <td>{{ libro.etiqueta_palabra_clave|default:'' }}</td>
                        <td class="text-center">{{ libro.sede|default:'LA PLATA' }}</td>
                        <td>{{ libro.observaciones|default:'' }}</td>
                        <td class="disponibilidad-cell">
                            {% if libro.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif libro.estado == 'Reservado' %}
                                <span class="reservado">{{ libro.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ libro.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <button class="btn-icon btn-detalle" title="Ver detalles" onclick="verDetalles({{ libro.id_libro }})">
                                üìã
                            </button>
                            <a href="{% url 'editar_libro' libro.id_libro %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            <button class="btn-icon btn-imprimir" title="Imprimir" onclick="imprimirLibro({{ libro.id_libro }})">
                                üñ®Ô∏è
                            </button>
                            {% if libro.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBaja({{ libro.id_libro }}, '{{ libro.titulo|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif libro.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBaja({{ libro.id_libro }})">
                                    üìÑ
                                </button>
                                
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="12" class="no-results">No se encontraron libros disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de mapas -->
    <div class="tabla-container" id="mapas-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th>Tipo</th>
                    <th>Denominaci√≥n</th>
                    <th>Descripci√≥n</th>
                    <th class="text-center">N¬∞ Registro</th>
                    <th class="text-center">Sede</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="mapas-table">
                {% if mapas %}
                    {% for mapa in mapas %}
                    <tr class="mapa-row{% if mapa.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ mapa.estado|lower }}"
                        data-tipo="{{ mapa.tipo|lower }}"
                        data-titulo="{{ mapa.tipo|lower }}"
                        data-denominacion="{{ mapa.denominacion|lower }}">
                        <td class="text-center">{{ mapa.id_mapa|default:'' }}</td>
                        <td class="titulo-cell">{{ mapa.tipo }}</td>
                        <td>{{ mapa.denominacion }}</td>
                        <td>{{ mapa.descripcion|default:'' }}</td>
                        <td class="text-center">{{ mapa.num_registro|default:'' }}</td>
                        <td class="text-center">{{ mapa.sede|default:'LA PLATA' }}</td>
                        <td class="disponibilidad-cell">
                            {% if mapa.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif mapa.estado == 'Reservado' %}
                                <span class="reservado">{{ mapa.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ mapa.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_mapa' mapa.id_mapa %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if mapa.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaMapa({{ mapa.id_mapa }}, '{{ mapa.tipo|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif mapa.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaMapa({{ mapa.id_mapa }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="no-results">No se encontraron mapas disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de programas -->
    <div class="tabla-container" id="programas-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th>Materia</th>
                    <th>Profesor</th>
                    <th>Carrera</th>
                    <th>Ciclo Lectivo</th>
                    <th>Enlace</th>
                    <th class="text-center">Sede</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="programas-table">
                {% if programas %}
                    {% for programa in programas %}
                    <tr class="programa-row{% if programa.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ programa.estado|lower }}"
                        data-materia="{{ programa.materia|lower }}"
                        data-profesor="{{ programa.profesor|lower }}"
                        data-carrera="{{ programa.carrera|lower }}">
                        <td class="text-center">{{ programa.id_programa|default:'' }}</td>
                        <td class="titulo-cell">{{ programa.materia }}</td>
                        <td>{{ programa.profesor }}</td>
                        <td>{{ programa.carrera }}</td>
                        <td class="text-center">{{ programa.ciclo_lectivo }}</td>
                        <td>
                            {% if programa.ingresar_enlace %}
                                <a href="{{ programa.ingresar_enlace }}" target="_blank" title="Ver enlace">üîó</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="text-center">{{ programa.sede|default:'LA PLATA' }}</td>
                        <td class="disponibilidad-cell">
                            {% if programa.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif programa.estado == 'Reservado' %}
                                <span class="reservado">{{ programa.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ programa.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_programa' programa.id_programa %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if programa.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaPrograma({{ programa.id_programa }}, '{{ programa.materia|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif programa.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaPrograma({{ programa.id_programa }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="9" class="no-results">No se encontraron programas disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de multimedia -->
    <div class="tabla-container" id="multimedia-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th>Materia</th>
                    <th>Profesor</th>
                    <th>Carrera</th>
                    <th>T√≠tulo Contenido</th>
                    <th>Enlace</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="multimedia-table">
                {% if multimedia %}
                    {% for multi in multimedia %}
                    <tr class="multimedia-row{% if multi.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ multi.estado|lower }}"
                        data-tipo="{{ multi.tipo|lower }}"
                        data-denominacion="{{ multi.denominacion|lower }}">
                        <td class="text-center">{{ multi.id_multi|default:'' }}</td>
                        <td class="titulo-cell">{{ multi.materia }}</td>
                        <td>{{ multi.profesor }}</td>
                        <td>{{ multi.carrera }}</td>
                        <td>{{ multi.titulo_contenido }}</td>
                        <td>
                            {% if multi.ingresar_enlace %}
                                <a href="{{ multi.ingresar_enlace }}" target="_blank" title="Ver enlace">üîó</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="disponibilidad-cell">
                            {% if multi.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif multi.estado == 'Reservado' %}
                                <span class="reservado">{{ multi.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ multi.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_multimedia' multi.id_multi %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if multi.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaMultimedia({{ multi.id_multi }}, '{{ multi.tipo|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif multi.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaMultimedia({{ multi.id_multi }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" class="no-results">No se encontraron elementos multimedia disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de notebook -->
    <div class="tabla-container" id="notebook-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th class="text-center">N¬∞ Registro</th>
                    <th>Modelo</th>
                    <th class="text-center">Sede</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="notebook-table">
                {% if notebooks %}
                    {% for not in notebooks %}
                    <tr class="notebook-row{% if not.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ not.estado|lower }}"
                        data-tipo="{{ not.modelo_not|lower }}"
                        data-denominacion="{{ not.modelo_not|lower }}">
                        <td class="text-center">{{ not.id_not|default:'' }}</td>
                        <td class="text-center">{{ not.num_registro|default:'' }}</td>
                        <td class="titulo-cell">{{ not.modelo_not }}</td>
                        <td class="text-center">{{ not.sede|default:'LA PLATA' }}</td>
                        <td class="disponibilidad-cell">
                            {% if not.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif not.estado == 'Reservado' %}
                                <span class="reservado">{{ not.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ not.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_notebook' not.id_not %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if not.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaNotebook({{ not.id_not }}, '{{ not.modelo_not|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif not.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaNotebook({{ not.id_not }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="no-results">No se encontraron notebooks disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de proyector -->
    <div class="tabla-container" id="proyector-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th class="text-center">N¬∞ Registro</th>
                    <th>Modelo</th>
                    <th class="text-center">Sede</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="proyector-table">
                {% if proyectores %}
                    {% for pro in proyectores %}
                    <tr class="proyector-row{% if pro.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ pro.estado|lower }}"
                        data-tipo="{{ pro.tipo|lower }}"
                        data-denominacion="{{ pro.denominacion|lower }}">
                        <td class="text-center">{{ pro.id_proyector|default:'' }}</td>
                        <td class="text-center">{{ pro.num_registro|default:'' }}</td>
                        <td class="titulo-cell">{{ pro.modelo_pro }}</td>
                        <td class="text-center">{{ pro.sede|default:'LA PLATA' }}</td>
                        <td class="disponibilidad-cell">
                            {% if pro.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif pro.estado == 'Reservado' %}
                                <span class="reservado">{{ pro.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ pro.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_proyector' pro.id_proyector %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if pro.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaProyector({{ pro.id_proyector }}, '{{ pro.tipo|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif pro.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaProyector({{ pro.id_proyector }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="no-results">No se encontraron proyectores disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Tabla de varios -->
    <div class="tabla-container" id="varios-container" style="display: none;">
        <table class="libros-table">
            <thead>
                <tr>
                    <th class="text-center">ID</th>
                    <th>Tipo</th>
                    <th class="text-center">Sede</th>
                    <th class="text-center">Cantidad</th>
                    <th class="text-center">Disponible</th>
                    <th class="text-center">Disponibilidad</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody id="varios-table">
                {% if varios %}
                    {% for var in varios %}
                    <tr class="varios-row{% if var.estado == 'No disponible' %} libro-no-disponible{% endif %}" 
                        data-estado="{{ var.estado|lower }}"
                        data-tipo="{{ var.tipo|lower }}">
                        <td class="text-center">{{ var.id_varios|default:'' }}</td>
                        <td class="titulo-cell">{{ var.tipo }}</td>
                        <td class="text-center">{{ var.sede|default:'LA PLATA' }}</td>
                        <td class="text-center">{{ var.cantidad|default:'1' }}</td>
                        <td class="text-center">{{ var.cantidad_disponible|default:'1' }}</td>
                        <td class="disponibilidad-cell">
                            {% if var.estado == 'Disponible' %}
                                <span class="disponible">Disponible para pr√©stamo</span>
                            {% elif var.estado == 'Reservado' %}
                                <span class="reservado">{{ var.estado }}</span>
                            {% else %}
                                <span class="no-disponible">{{ var.estado }}</span>
                            {% endif %}
                        </td>
                        <td class="acciones-cell">
                            <a href="{% url 'editar_varios' var.id_varios %}" class="btn-icon btn-editar" title="Editar">
                                ‚úèÔ∏è
                            </a>
                            {% if var.estado == 'Disponible' %}
                                <button class="btn-icon btn-eliminar" title="Dar de baja" 
                                        onclick="darDeBajaVarios({{ var.id_varios }}, '{{ var.tipo|escapejs }}')">
                                    üóëÔ∏è
                                </button>
                            {% elif var.estado == 'No disponible' %}
                                <button class="btn-icon btn-ver-informe" title="Ver informe de baja" 
                                        onclick="verInformeBajaVarios({{ var.id_varios }})">
                                    üìÑ
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="no-results">No se encontraron elementos varios disponibles.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Script para manejar la interacci√≥n con las tablas -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar datos de multimedia para el modal de baja
        window.multimediaTableData = [
            {% for multi in multimedia %}
            {
                id_multi: {{ multi.id_multi }},
                id_inventario: {{ multi.id_inventario }},
                titulo_contenido: "{{ multi.titulo_contenido|escapejs }}",
                profesor: "{{ multi.profesor|escapejs }}",
                carrera: "{{ multi.carrera|escapejs }}",
                materia: "{{ multi.materia|escapejs }}",
                ingresar_enlace: "{{ multi.ingresar_enlace|escapejs }}",
                sede: "{{ multi.sede|escapejs }}",
                estado: "{{ multi.estado|escapejs }}",
                tipo: "{{ multi.tipo|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        // Inicializar datos de notebooks para el modal de baja
        window.notebookTableData = [
            {% for notebook in notebooks %}
            {
                id_not: {{ notebook.id_not }},
                sede: "{{ notebook.sede|escapejs }}",
                num_registro: "{{ notebook.num_registro|escapejs }}",
                modelo_not: "{{ notebook.modelo_not|escapejs }}",
                estado: "{{ notebook.estado|escapejs }}",
                motivo_baja: "{{ notebook.motivo_baja|escapejs }}",
                descripcion: "{{ notebook.descripcion|escapejs }}",
                num_ejemplar: {{ notebook.num_ejemplar|default:"null" }}
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        // Inicializar datos de programas para el modal de baja
        window.programaTableData = [
            {% for programa in programas %}
            {
                id_programa: {{ programa.id_programa }},
                materia: "{{ programa.materia|escapejs }}",
                profesor: "{{ programa.profesor|escapejs }}",
                carrera: "{{ programa.carrera|escapejs }}",
                ciclo: "{{ programa.ciclo|escapejs }}",
                sede: "{{ programa.sede|escapejs }}",
                estado: "{{ programa.estado|escapejs }}",
                motivo_baja: "{{ programa.motivo_baja|escapejs }}",
                descripcion: "{{ programa.descripcion|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        // Inicializar datos de proyectores para el modal de baja
        window.proyectorTableData = [
            {% for proyector in proyectores %}
            {
                id_proyector: {{ proyector.id_proyector }},
                sede: "{{ proyector.sede|escapejs }}",
                num_registro: "{{ proyector.num_registro|escapejs }}",
                modelo_pro: "{{ proyector.modelo_pro|escapejs }}",
                estado: "{{ proyector.estado|escapejs }}",
                motivo_baja: "{{ proyector.motivo_baja|escapejs }}",
                descripcion: "{{ proyector.descripcion|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
        
        // Obtener el selector de tipo de material
        const tipoMaterialSelect = document.getElementById('tipo_material');
        
        // Obtener los contenedores de tablas
        const librosContainer = document.getElementById('libros-container');
        const mapasContainer = document.getElementById('mapas-container');
        const multimediaContainer = document.getElementById('multimedia-container');
        const notebookContainer = document.getElementById('notebook-container');
        const proyectorContainer = document.getElementById('proyector-container');
        const variosContainer = document.getElementById('varios-container');
        
        // Obtener el contenedor de programas
        const programasContainer = document.getElementById('programas-container');
        
        // Manejar el cambio en el selector de tipo de material
        tipoMaterialSelect.addEventListener('change', function() {
            // Ocultar todas las tablas
            librosContainer.style.display = 'none';
            mapasContainer.style.display = 'none';
            multimediaContainer.style.display = 'none';
            notebookContainer.style.display = 'none';
            proyectorContainer.style.display = 'none';
            variosContainer.style.display = 'none';
            programasContainer.style.display = 'none';
            
            // Mostrar la tabla correspondiente al tipo seleccionado
            if (this.value === 'libro') {
                librosContainer.style.display = 'block';
            } else if (this.value === 'mapa') {
                mapasContainer.style.display = 'block';
            } else if (this.value === 'multimedia') {
                multimediaContainer.style.display = 'block';
            } else if (this.value === 'notebook') {
                notebookContainer.style.display = 'block';
            } else if (this.value === 'proyector') {
                proyectorContainer.style.display = 'block';
            } else if (this.value === 'varios') {
                variosContainer.style.display = 'block';
            } else if (this.value === 'programa') {
                programasContainer.style.display = 'block';
            }
            
            // Reaplicar filtros despu√©s de cambiar de tabla
            setTimeout(() => {
                filtrarLibros();
            }, 100);
        });
        
        // Funciones para mapas
        window.verDetallesMapa = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=mapa`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal de mapa
                        document.getElementById('detalle_mapa_id').textContent = detalles.detalle_mapa_id || '-';
                        document.getElementById('detalle_mapa_num_registro').textContent = detalles.detalle_mapa_num_registro || '-';
                        document.getElementById('detalle_mapa_tipo').textContent = detalles.detalle_mapa_tipo || '-';
                        document.getElementById('detalle_mapa_denominacion').textContent = detalles.detalle_mapa_denominacion || '-';
                        document.getElementById('detalle_mapa_sede').textContent = detalles.detalle_mapa_sede || '-';
                        document.getElementById('detalle_mapa_estado').textContent = detalles.detalle_mapa_estado || '-';
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesMapaModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del mapa: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del mapa');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del mapa');
            }
        };
        
        // Funciones para programas
        window.verDetallesPrograma = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=programa`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Funci√≥n helper para validar elementos DOM
                        const setTextContent = (id, value) => {
                            const element = document.getElementById(id);
                            if (element) {
                                element.textContent = value || '-';
                            } else {
                                console.warn(`Elemento con ID '${id}' no encontrado`);
                            }
                        };
                        
                        // Llenar datos en el modal de programa con validaci√≥n
                        setTextContent('detalle_programa_id', detalles.detalle_programa_id);
                        setTextContent('detalle_programa_num_registro', detalles.detalle_programa_num_registro);
                        setTextContent('detalle_programa_tipo', detalles.detalle_programa_tipo);
                        setTextContent('detalle_programa_denominacion', detalles.detalle_programa_denominacion);
                        setTextContent('detalle_programa_enlace', detalles.detalle_programa_enlace);
                        setTextContent('detalle_programa_sede', detalles.detalle_programa_sede);
                        setTextContent('detalle_programa_disponibilidad', detalles.detalle_programa_disponibilidad);
                        setTextContent('detalle_programa_observaciones', detalles.detalle_programa_observaciones || 'Sin observaciones');
                        
                        // Mostrar el modal
                        const modalElement = document.getElementById('detallesProgramaModal');
                        if (modalElement) {
                            const modal = new bootstrap.Modal(modalElement);
                            modal.show();
                        } else {
                            console.error('Modal detallesProgramaModal no encontrado');
                            alert('Error: Modal no encontrado');
                        }
                    } else {
                        alert('Error al cargar los detalles del programa: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del programa');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del programa');
            }
        };
        
        // Funciones para notebook
        window.verDetallesNotebook = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=notebook`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal de notebook
                        document.getElementById('detalle_notebook_id').textContent = detalles.detalle_notebook_id || '-';
                        document.getElementById('detalle_notebook_num_registro').textContent = detalles.detalle_notebook_num_registro || '-';
                        document.getElementById('detalle_notebook_modelo').textContent = detalles.detalle_notebook_modelo || '-';
                        document.getElementById('detalle_notebook_marca').textContent = detalles.detalle_notebook_marca || '-';
                        document.getElementById('detalle_notebook_sede').textContent = detalles.detalle_notebook_sede || '-';
                        document.getElementById('detalle_notebook_estado').textContent = detalles.detalle_notebook_estado || '-';
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesNotebookModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del notebook: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del notebook');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del notebook');
            }
        };
        
        // Funciones para proyector
        window.verDetallesProyector = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=proyector`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal de proyector
                        document.getElementById('detalle_proyector_id').textContent = detalles.detalle_proyector_id || '-';
                        document.getElementById('detalle_proyector_num_registro').textContent = detalles.detalle_proyector_num_registro || '-';
                        document.getElementById('detalle_proyector_modelo').textContent = detalles.detalle_proyector_modelo || '-';
                        document.getElementById('detalle_proyector_sede').textContent = detalles.detalle_proyector_sede || '-';
                        document.getElementById('detalle_proyector_estado').textContent = detalles.detalle_proyector_estado || '-';
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesProyectorModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del proyector: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del proyector');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del proyector');
            }
        };
        
        // Funciones para multimedia
        window.verDetallesMultimedia = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=multimedia`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal de multimedia
                        document.getElementById('detalle_multimedia_id').textContent = detalles.detalle_multimedia_id || '-';
                        document.getElementById('detalle_multimedia_materia').textContent = detalles.detalle_multimedia_materia || '-';
                        document.getElementById('detalle_multimedia_profesor').textContent = detalles.detalle_multimedia_profesor || '-';
                        document.getElementById('detalle_multimedia_carrera').textContent = detalles.detalle_multimedia_carrera || '-';
                        document.getElementById('detalle_multimedia_titulo_contenido').textContent = detalles.detalle_multimedia_titulo_contenido || '-';
                        document.getElementById('detalle_multimedia_estado').textContent = detalles.detalle_multimedia_estado || '-';
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesMultimediaModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del multimedia: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del multimedia');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del multimedia');
            }
        };
        
        // Funciones para varios
        window.verDetallesVarios = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=varios`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal de varios
                        document.getElementById('detalle_varios_id').textContent = detalles.detalle_varios_id || '-';
                        document.getElementById('detalle_varios_num_registro').textContent = detalles.detalle_varios_num_registro || '-';
                        document.getElementById('detalle_varios_tipo').textContent = detalles.detalle_varios_tipo || '-';
                        document.getElementById('detalle_varios_denominacion').textContent = detalles.detalle_varios_denominacion || '-';
                        document.getElementById('detalle_varios_sede').textContent = detalles.detalle_varios_sede || '-';
                        document.getElementById('detalle_varios_cantidad').textContent = detalles.detalle_varios_cantidad || '-';
                        document.getElementById('detalle_varios_cantidad_disponible').textContent = detalles.detalle_varios_cantidad_disponible || '-';
                        document.getElementById('detalle_varios_estado').textContent = detalles.detalle_varios_estado || '-';
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesVariosModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del elemento varios: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del elemento varios');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del elemento varios');
            }
        };
        
        // Funci√≥n para libros (detallesModal general)
        window.verDetalles = function(id) {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/ver-detalles-material/${id}/?tipo=libro`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const detalles = data.detalles;
                        
                        // Llenar datos en el modal general de detalles
                        const setTextContent = (id, value) => {
                            const element = document.getElementById(id);
                            if (element) {
                                element.textContent = value || '-';
                            }
                        };
                        
                        setTextContent('detalle_num_inventario', detalles.detalle_num_inventario);
                        setTextContent('detalle_titulo', detalles.detalle_titulo);
                        setTextContent('detalle_autor', detalles.detalle_autor);
                        setTextContent('detalle_editorial', detalles.detalle_editorial);
                        setTextContent('detalle_cdu', detalles.detalle_cdu);
                        setTextContent('detalle_siglas', detalles.detalle_siglas);
                        setTextContent('detalle_sede', detalles.detalle_sede);
                        setTextContent('detalle_disponibilidad', detalles.detalle_disponibilidad);
                        setTextContent('detalle_estado', detalles.detalle_estado);
                        setTextContent('detalle_descripcion', detalles.detalle_descripcion || 'Sin descripci√≥n disponible');
                        setTextContent('detalle_observaciones', detalles.detalle_observaciones || 'Sin observaciones');
                        
                        // Manejar imagen
                        const imagenElement = document.getElementById('detalle_imagen_principal');
                        const placeholderElement = document.getElementById('detalle_placeholder_principal');
                        if (detalles.detalle_imagen && imagenElement && placeholderElement) {
                            imagenElement.src = detalles.detalle_imagen;
                            imagenElement.style.display = 'block';
                            placeholderElement.style.display = 'none';
                        } else if (imagenElement && placeholderElement) {
                            imagenElement.style.display = 'none';
                            placeholderElement.style.display = 'flex';
                        }
                        
                        // Manejar etiquetas
                        const etiquetasContainer = document.getElementById('detalle_etiquetas');
                        if (etiquetasContainer) {
                            etiquetasContainer.innerHTML = '';
                            if (detalles.detalle_etiquetas && detalles.detalle_etiquetas.length > 0) {
                                detalles.detalle_etiquetas.forEach(etiqueta => {
                                    const span = document.createElement('span');
                                    span.style.cssText = 'background: #3498db; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;';
                                    span.textContent = etiqueta;
                                    etiquetasContainer.appendChild(span);
                                });
                            } else {
                                const span = document.createElement('span');
                                span.style.cssText = 'color: #95a5a6; font-style: italic; font-size: 14px;';
                                span.textContent = 'Sin etiquetas asignadas';
                                etiquetasContainer.appendChild(span);
                            }
                        }
                        
                        // Mostrar el modal
                        const modal = new bootstrap.Modal(document.getElementById('detallesModal'));
                        modal.show();
                    } else {
                        alert('Error al cargar los detalles del material: ' + (data.error || 'Error desconocido'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar los detalles del material');
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del material');
            }
        };

    // ===== FUNCIONALIDAD DE FILTRADO Y B√öSQUEDA CORREGIDA =====
    const searchInput = document.getElementById('searchInput');
    const mostrarNoDisponibles = document.getElementById('mostrar_no_disponibles');
    const ordenarPor = document.getElementById('ordenar_por');

    function filtrarLibros() {
        const searchTerm = searchInput.value.toLowerCase();
        const showOnlyUnavailable = mostrarNoDisponibles.checked; // Cambio de nombre para claridad
        let visibleCount = 0;

        // Obtener todas las filas de todas las tablas
        const allRows = document.querySelectorAll('.libro-row, .mapa-row, .programa-row, .multimedia-row, .notebook-row, .proyector-row, .varios-row');

        allRows.forEach(row => {
            const titulo = row.dataset.titulo || '';
            const autor = row.dataset.autor || '';
            const editorial = row.dataset.editorial || '';
            const denominacion = row.dataset.denominacion || '';
            const materia = row.dataset.materia || '';
            const tipo = row.dataset.tipo || '';
            const modelo = row.dataset.modelo || '';
            const estado = row.dataset.estado;
            
            // Buscar en todos los campos relevantes seg√∫n el tipo de material
            const matchesSearch = titulo.includes(searchTerm) || 
                                 autor.includes(searchTerm) || 
                                 editorial.includes(searchTerm) ||
                                 denominacion.includes(searchTerm) ||
                                 materia.includes(searchTerm) ||
                                 tipo.includes(searchTerm) ||
                                 modelo.includes(searchTerm);
            
            // L√≥gica corregida del filtro de estado
            let showByState;
            if (showOnlyUnavailable) {
                // Si el checkbox est√° marcado, mostrar SOLO los no disponibles
                showByState = estado === 'no disponible';
            } else {
                // Si el checkbox NO est√° marcado, mostrar SOLO los disponibles y reservados
                showByState = estado === 'disponible' || estado === 'reservado';
            }
            
            const showRow = matchesSearch && showByState;
            
            row.style.display = showRow ? '' : 'none';
            if (showRow) visibleCount++;
        });

        updateNoResultsMessage(visibleCount);
        updateTabCounts(); // Actualizar contadores de pesta√±as
    }

    function updateNoResultsMessage(count) {
        // Actualizar mensaje para todas las tablas
        const tables = ['libros', 'mapas', 'programas', 'multimedia', 'notebook', 'proyector', 'varios'];
        
        tables.forEach(tableType => {
            const tbody = document.getElementById(`${tableType}-table`);
            if (!tbody) return;
            
            let noResultsRow = tbody.querySelector('.no-results-row');
            const visibleRows = tbody.querySelectorAll('tr:not(.no-results-row)').length;
            const actuallyVisibleRows = Array.from(tbody.querySelectorAll('tr:not(.no-results-row)')).filter(row => row.style.display !== 'none').length;
            
            if (actuallyVisibleRows === 0 && visibleRows > 0) {
                if (!noResultsRow) {
                    noResultsRow = document.createElement('tr');
                    noResultsRow.className = 'no-results-row';
                    const colspan = tbody.closest('table').querySelector('thead tr').children.length;
                    noResultsRow.innerHTML = `<td colspan="${colspan}" class="no-results">No se encontraron resultados con los filtros aplicados.</td>`;
                    tbody.appendChild(noResultsRow);
                }
            } else {
                if (noResultsRow) {
                    noResultsRow.remove();
                }
            }
        });
    }

    function updateTabCounts() {
        // Actualizar contadores en las pesta√±as si existen
        const tabs = document.querySelectorAll('.nav-link');
        tabs.forEach(tab => {
            const tabType = tab.getAttribute('data-tab');
            if (tabType) {
                const rows = document.querySelectorAll(`.${tabType}-row`);
                const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none').length;
                
                // Actualizar texto del tab si tiene contador
                const tabText = tab.textContent.replace(/\(\d+\)/, '');
                tab.textContent = `${tabText} (${visibleRows})`;
            }
        });
    }

    // Event listeners para filtros
    searchInput.addEventListener('input', filtrarLibros);
    mostrarNoDisponibles.addEventListener('change', function() {
        console.log('Checkbox "mostrar no disponibles" cambiado a:', this.checked);
        filtrarLibros();
    });

    // ===== APLICAR FILTRO INICIAL AL CARGAR LA P√ÅGINA =====
    filtrarLibros(); // <- AGREGAR ESTA L√çNEA
    
    // Agregar event listener para cambio de pesta√±as
    const tabButtons = document.querySelectorAll('.nav-link');
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            setTimeout(() => {
                filtrarLibros(); // Aplicar filtros despu√©s de cambiar de pesta√±a
            }, 100);
        });
    });

    // ===== FUNCIONALIDAD DE ORDENAMIENTO =====
    ordenarPor.addEventListener('change', function() {
        // Obtener la tabla activa actualmente
        const activeContainer = document.querySelector('.tabla-container:not([style*="display: none"])');
        if (!activeContainer) return;
        
        const tbody = activeContainer.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr:not(.no-results-row)'));
        
        rows.sort((a, b) => {
            let aValue, bValue;
            
            switch (this.value) {
                case 'autor':
                    aValue = a.dataset.autor || a.dataset.profesor || '';
                    bValue = b.dataset.autor || b.dataset.profesor || '';
                    break;
                case 'fecha':
                    aValue = parseInt(a.querySelector('td:first-child').textContent) || 0;
                    bValue = parseInt(b.querySelector('td:first-child').textContent) || 0;
                    return bValue - aValue; // Descendente para fechas
                default: // titulo
                    aValue = a.dataset.titulo || a.dataset.tipo || a.dataset.materia || '';
                    bValue = b.dataset.titulo || b.dataset.tipo || b.dataset.materia || '';
            }
            
            return aValue.localeCompare(bValue);
        });
        
        rows.forEach(row => tbody.appendChild(row));
        
        // Reaplicar filtros despu√©s del ordenamiento
        filtrarLibros();
    });

    // ===== MANEJO DE SUBIDA DE IM√ÅGENES EN MODAL DE BAJA =====
    const inputImagen = document.getElementById('imagen_rota');
    
    if (inputImagen) {
        inputImagen.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const uploadZone = document.querySelector('[onclick="document.getElementById(\'imagen_rota\').click()"]');
            
            if (file) {
                uploadZone.innerHTML = `
                    <div style="text-align: center; color: #27ae60;">
                        <div style="font-size: 20px; margin-bottom: 4px;">‚úÖ</div>
                        <div style="font-size: 10px; font-weight: 600;">${file.name}</div>
                    </div>
                `;
                uploadZone.style.background = '#d5f4e6';
                uploadZone.style.borderColor = '#27ae60';
            } else {
                uploadZone.innerHTML = `
                    <div style="text-align: center; color: #f39c12;">
                        <div style="font-size: 24px; margin-bottom: 4px;">üìÅ</div>
                        <div style="font-size: 11px; font-weight: 600;">SUBIR ARCHIVO</div>
                    </div>
                `;
                uploadZone.style.background = '#fef9e7';
                uploadZone.style.borderColor = '#f39c12';
            }
        });
    }

    // ===== SISTEMA DE GESTI√ìN DE OBLEAS =====
    class SistemaObleas {
        constructor() {
            this.obleas = [];
            this.contadorEjemplar = {};
            this.init();
        }
        
        init() {
            // Event listeners para el modal de obleas
            document.getElementById('limpiarObleas').addEventListener('click', () => this.limpiarTodo());
            document.getElementById('imprimirPDF').addEventListener('click', () => this.generarPDF());
            
            // Cerrar modal con escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && document.getElementById('obleasModal').classList.contains('show')) {
                    this.cerrarModal();
                }
            });
            
            // Inicializar estado del bot√≥n imprimir
            this.actualizarContador();
        }
        
        agregarOblea(libroData) {
            // Generar n√∫mero de ejemplar √∫nico por CDU + Siglas
            const clave = `${libroData.cdu}_${libroData.siglas}`;
            if (!this.contadorEjemplar[clave]) {
                this.contadorEjemplar[clave] = 0;
            }
            this.contadorEjemplar[clave]++;
            
            // Crear oblea con datos del libro
            const oblea = {
                id: Date.now() + Math.random(),
                cdu: libroData.cdu || 'SIN CDU',
                siglas: libroData.siglas || 'ABC',
                ejemplar: this.contadorEjemplar[clave],
                titulo: libroData.titulo,
                autor: libroData.autor
            };
            
            // Agregar a la colecci√≥n y actualizar vista
            this.obleas.push(oblea);
            this.renderizarObleas();
            this.actualizarContador();
            this.mostrarModal();
            
            // Mostrar notificaci√≥n de √©xito
            this.mostrarNotificacion(`Oblea agregada: ${oblea.cdu} - ${oblea.siglas} (Ej. ${oblea.ejemplar})`);
        }
        
        eliminarOblea(id) {
            // Encontrar la oblea a eliminar
            const obleaAEliminar = this.obleas.find(oblea => oblea.id === id);
            if (!obleaAEliminar) return;
            
            // Confirmar eliminaci√≥n
            if (confirm(`¬øEliminar oblea ${obleaAEliminar.cdu} - ${obleaAEliminar.siglas}?`)) {
                this.obleas = this.obleas.filter(oblea => oblea.id !== id);
                this.renderizarObleas();
                this.actualizarContador();
                
                // Mostrar notificaci√≥n
                this.mostrarNotificacion(`Oblea eliminada: ${obleaAEliminar.cdu} - ${obleaAEliminar.siglas}`, 'warning');
            }
        }
        
        limpiarTodo() {
            if (this.obleas.length === 0) {
                alert('No hay obleas para limpiar');
                return;
            }
            
            if (confirm(`¬øEst√° seguro de eliminar todas las ${this.obleas.length} obleas?`)) {
                this.obleas = [];
                this.contadorEjemplar = {};
                this.renderizarObleas();
                this.actualizarContador();
                
                // Mostrar notificaci√≥n
                this.mostrarNotificacion('Todas las obleas han sido eliminadas', 'info');
            }
        }
        
        renderizarObleas() {
            const container = document.getElementById('obleasContainer');
            
            if (this.obleas.length === 0) {
                container.innerHTML = `
                    <div id="placeholder" style="grid-column: 1 / -1; text-align: center; color: #95a5a6; font-style: italic; padding: 40px;">
                        Haz clic en "Imprimir" de cualquier libro para agregar obleas aqu√≠
                    </div>
                `;
                return;
            }
            
            container.innerHTML = this.obleas.map(oblea => `
                <div class="oblea" title="Clic para eliminar">
                    <button class="eliminar" onclick="sistemaObleas.eliminarOblea(${oblea.id})">√ó</button>
                    <div class="cdu">${oblea.cdu}</div>
                    <div class="siglas">${oblea.siglas}</div>
                    <div class="ejemplar">Ej. ${oblea.ejemplar}</div>
                </div>
            `).join('');
        }
        
        actualizarContador() {
            document.getElementById('contadorObleas').textContent = this.obleas.length;
            
            // Habilitar/deshabilitar bot√≥n de imprimir
            const btnImprimir = document.getElementById('imprimirPDF');
            if (btnImprimir) {
                btnImprimir.disabled = this.obleas.length === 0;
                btnImprimir.style.opacity = this.obleas.length === 0 ? '0.5' : '1';
            }
        }
        
        mostrarModal() {
            const modal = new bootstrap.Modal(document.getElementById('obleasModal'));
            modal.show();
        }
        
        cerrarModal() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('obleasModal'));
            if (modal) modal.hide();
        }
        
        mostrarNotificacion(mensaje, tipo = 'success') {
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion-obleas ${tipo}`;
            notificacion.textContent = mensaje;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.remove();
            }, 3000);
        }
        
        generarPDF() {
            if (this.obleas.length === 0) {
                alert('No hay obleas para imprimir');
                return;
            }
            
            // Simular generaci√≥n de PDF
            this.mostrarNotificacion(`PDF generado con ${this.obleas.length} obleas`, 'success');
            
            // Aqu√≠ se implementar√≠a la l√≥gica real de generaci√≥n de PDF
            console.log('Generando PDF con obleas:', this.obleas);
            
            // Cerrar modal despu√©s de generar
            setTimeout(() => {
                this.cerrarModal();
            }, 1500);
        }
    }

    // Inicializar sistema de obleas
    window.sistemaObleas = null;
    document.addEventListener('DOMContentLoaded', function() {
        try {
            window.sistemaObleas = new SistemaObleas();
            console.log('Sistema de obleas inicializado correctamente');
        } catch (error) {
            console.error('Error al inicializar sistema de obleas:', error);
        }
    });

    // ===== FUNCI√ìN PARA IMPRIMIR LIBRO ACTUALIZADA =====
    window.imprimirLibro = function(libroId) {
        try {
            console.log('üñ®Ô∏è Imprimiendo libro con ID:', libroId);
            
            // Verificar si sistemaObleas est√° inicializado
            if (!window.sistemaObleas) {
                console.log('Inicializando sistema de obleas...');
                window.sistemaObleas = new SistemaObleas();
            }
            
            // Buscar la fila del libro en la tabla
            const botonImprimir = document.querySelector(`button[onclick*="imprimirLibro(${libroId})"]`);
            if (!botonImprimir) {
                console.error('No se encontr√≥ el bot√≥n de imprimir para el libro ID:', libroId);
                alert('Error: No se pudo encontrar la informaci√≥n del libro');
                return;
            }
            
            const filaLibro = botonImprimir.closest('tr');
            const celdas = filaLibro.querySelectorAll('td');
            
            // Verificar que tenemos suficientes celdas
            if (celdas.length < 7) {
                console.error('No se encontraron suficientes celdas en la fila del libro');
                alert('Error: No se pudo extraer la informaci√≥n del libro de la tabla');
                return;
            }
            
            // Extraer datos del libro de la tabla
            const libroData = {
                id: libroId,
                numInventario: celdas[0].textContent.trim(),
                titulo: celdas[1].textContent.trim(),
                autor: celdas[2].textContent.trim(),
                editorial: celdas[3].textContent.trim(),
                cdu: celdas[4].textContent.trim(),
                siglas: celdas[5].textContent.trim(),
                sede: celdas[6].textContent.trim()
            };
            
            console.log('Datos del libro extra√≠dos:', libroData);
            
            // Agregar oblea al sistema
            window.sistemaObleas.agregarOblea(libroData);
            
        } catch (error) {
            console.error('Error al imprimir libro:', error);
            alert('Error al procesar la impresi√≥n del libro: ' + error.message);
        }
    };

    // ===== FUNCI√ìN PARA DAR DE BAJA LIBRO ACTUALIZADA =====
    window.darDeBaja = function(libroId, titulo) {
        try {
            console.log('üóëÔ∏è Dando de baja libro con ID:', libroId, 'T√≠tulo:', titulo);
            
            const filaLibro = document.querySelector(`tr[data-titulo*="${titulo.toLowerCase()}"]`);
            
            if (!filaLibro) {
                console.error('No se pudo encontrar la fila del libro');
                return;
            }
            
            // Extraer datos de la fila
            const celdas = filaLibro.querySelectorAll('td');
            const numInventario = celdas[0].textContent.trim();
            const tituloLibro = celdas[1].textContent.trim();
            const autor = celdas[2].textContent.trim();
            const editorial = celdas[3].textContent.trim();
            const cdu = celdas[4].textContent.trim();
            const siglas = celdas[5].textContent.trim();
            const sede = celdas[6].textContent.trim();
            
            // Obtener imagen del libro
            const imagenElement = filaLibro.querySelector('.libro-thumbnail');
            const imagenSrc = imagenElement ? imagenElement.src : '';
            
            // Llenar el formulario oculto
            document.getElementById('libro_id').value = libroId;
            
            // Llenar los datos en el modal
            document.getElementById('modal_num_inventario').textContent = numInventario || '1';
            document.getElementById('modal_titulo').textContent = tituloLibro;
            document.getElementById('modal_autor').textContent = autor || 'Sin autor';
            document.getElementById('modal_editorial').textContent = editorial || 'Sin editorial';
            document.getElementById('modal_cdu').textContent = cdu || 'Sin CDU';
            document.getElementById('modal_siglas').textContent = siglas || 'ABC';
            document.getElementById('modal_sede').textContent = sede || 'LA PLATA';
            
            // Manejar la imagen
            const imagenModal = document.getElementById('libro_imagen_modal');
            const placeholderModal = document.getElementById('libro_placeholder');
            
            if (imagenSrc && !imagenSrc.includes('placeholder')) {
                imagenModal.src = imagenSrc;
                imagenModal.style.display = 'block';
                placeholderModal.style.display = 'none';
            } else {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Limpiar el formulario
            document.getElementById('motivo_baja').value = '';
            document.getElementById('imagen_rota').value = '';
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error al dar de baja libro:', error);
            alert('Error al abrir el modal de baja');
        }
    };

    // ===== FUNCI√ìN PARA VER INFORME DE BAJA ACTUALIZADA CON DATOS REALES =====
    window.verInformeBaja = function(libroId) {
        try {
            console.log('üìã Viendo informe de baja para libro ID:', libroId);
            
            // Buscar la fila del libro en la tabla
            const botonInforme = document.querySelector(`button[onclick*="verInformeBaja(${libroId})"]`);
            if (!botonInforme) {
                console.error('No se encontr√≥ el bot√≥n de informe para el libro ID:', libroId);
                alert('Error: No se pudo encontrar la informaci√≥n del libro');
                return;
            }
            
            const filaLibro = botonInforme.closest('tr');
            const celdas = filaLibro.querySelectorAll('td');
            
            // Extraer datos del libro de la tabla
            const datosLibro = {
                id: libroId,
                numInventario: celdas[0]?.textContent.trim() || 'N/A',
                titulo: celdas[1]?.textContent.trim() || 'N/A',
                autor: celdas[2]?.textContent.trim() || 'N/A',
                editorial: celdas[3]?.textContent.trim() || 'N/A',
                cdu: celdas[4]?.textContent.trim() || 'N/A',
                siglas: celdas[5]?.textContent.trim() || 'N/A',
                sede: celdas[6]?.textContent.trim() || 'N/A'
            };
            
            // Guardar el ID del libro para usar en el bot√≥n DAR DE ALTA
            window.currentLibroId = libroId;
            
            // Llenar los datos b√°sicos en el modal
            document.getElementById('informe_num_inventario').textContent = datosLibro.numInventario;
            document.getElementById('informe_titulo').textContent = datosLibro.titulo;
            document.getElementById('informe_autor').textContent = datosLibro.autor;
            document.getElementById('informe_cdu').textContent = datosLibro.cdu;
            document.getElementById('informe_siglas').textContent = datosLibro.siglas;
            
            // Manejar imagen del libro
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            // Buscar imagen en la fila (si existe)
            const imagenEnFila = filaLibro.querySelector('img');
            const imagenSrc = imagenEnFila ? imagenEnFila.src : null;
            
            if (imagenSrc && !imagenSrc.includes('placeholder')) {
                imagenModal.src = imagenSrc;
                imagenModal.style.display = 'block';
                placeholderModal.style.display = 'none';
            } else {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // ===== OBTENER DATOS REALES DEL BACKEND =====
            obtenerInformeBajaReal(libroId);
            
            console.log('Informe mostrado para libro:', datosLibro);
            
        } catch (error) {
            console.error('Error al ver informe de baja:', error);
            alert('Error al acceder al informe de baja');
        }
    };

    // ===== FUNCI√ìN PARA OBTENER DATOS REALES DEL INFORME DE BAJA =====
    function obtenerInformeBajaReal(libroId) {
        // Mostrar indicadores de carga
        document.getElementById('informe_motivo').innerHTML = '<div style="text-align: center; color: #6c757d;"><i class="fas fa-spinner fa-spin"></i> Cargando motivo de baja...</div>';
        document.getElementById('informe_fecha_baja').textContent = 'Cargando...';
        
        // Preparar datos para la petici√≥n
        const formData = new FormData();
        formData.append('libro_id', libroId);
        
        // Obtener token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Realizar petici√≥n AJAX al backend
        fetch('/obtener-informe-baja/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('üìã Datos del informe recibidos:', data);
            
            if (data.success) {
                // Actualizar motivo de baja con el dato real
                const motivoElement = document.getElementById('informe_motivo');
                if (data.informe.motivo && data.informe.motivo.trim() !== '') {
                    motivoElement.textContent = data.informe.motivo;
                    motivoElement.style.color = '#495057';
                } else {
                    motivoElement.textContent = 'Motivo no registrado';
                    motivoElement.style.color = '#6c757d';
                    motivoElement.style.fontStyle = 'italic';
                }
                
                // Actualizar fecha de baja si est√° disponible
                if (data.informe && data.informe.fecha_baja) {
                    document.getElementById('informe_fecha_baja').textContent = data.informe.fecha_baja;
                } else {
                    document.getElementById('informe_fecha_baja').textContent = 'Fecha no registrada';
                }
                
                // Manejar imagen de baja si existe
                const imagenBajaContainer = document.getElementById('imagen_baja_container');
                const imagenBaja = document.getElementById('imagen_baja');
                
                if (data.informe.imagen_baja) {
                    imagenBaja.src = data.informe.imagen_baja;
                    imagenBajaContainer.style.display = 'block';
                    console.log('üñºÔ∏è Imagen de baja cargada:', data.informe.imagen_baja);
                } else {
                    imagenBajaContainer.style.display = 'none';
                    console.log('‚ùå No hay imagen de baja disponible');
                }
                
            } else {
                // Error del servidor
                console.error('‚ùå Error del servidor:', data.error);
                document.getElementById('informe_motivo').innerHTML = `<span style="color: #dc3545; font-style: italic;">Error al cargar: ${data.error}</span>`;
                document.getElementById('informe_fecha_baja').textContent = 'Error al cargar';
            }
        })
        .catch(error => {
            console.error('‚ùå Error en la petici√≥n:', error);
            document.getElementById('informe_motivo').innerHTML = '<span style="color: #dc3545; font-style: italic;">Error de conexi√≥n al cargar el motivo</span>';
            document.getElementById('informe_fecha_baja').textContent = 'Error de conexi√≥n';
        });
    }

    // ===== FUNCIONES PARA OTROS TIPOS DE MATERIALES =====
    window.imprimirMapa = function(id) {
        alert(`Imprimir Mapa ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.imprimirPrograma = function(id) {
        alert(`Imprimir Programa ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.imprimirMultimedia = function(id) {
        alert(`Imprimir Multimedia ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.imprimirNotebook = function(id) {
        alert(`Imprimir Notebook ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.imprimirProyector = function(id) {
        alert(`Imprimir Proyector ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.imprimirVarios = function(id) {
        alert(`Imprimir Varios ID: ${id} - Funcionalidad en desarrollo`);
    };

    window.darDeBajaMapa = function(id, tipo) {
        try {
            // Obtener datos del mapa desde la fila de la tabla
            const filasMapa = document.querySelectorAll('#mapas-table tr');
            let mapaData = null;
            
            filasMapa.forEach(fila => {
                const celdas = fila.querySelectorAll('td');
                if (celdas.length > 0 && celdas[0].textContent.trim() === id.toString()) {
                    mapaData = {
                        id: celdas[0].textContent.trim(),
                        tipo: celdas[1].textContent.trim(),
                        denominacion: celdas[2].textContent.trim(),
                        num_registro: celdas[3].textContent.trim(),
                        sede: celdas[4].textContent.trim()
                    };
                }
            });
            
            if (!mapaData) {
                alert('Error: No se pudieron obtener los datos del mapa');
                return;
            }
            
            // Llenar datos en el modal de baja
            document.getElementById('modal_num_inventario').textContent = mapaData.num_registro;
            document.getElementById('modal_titulo').textContent = mapaData.denominacion;
            document.getElementById('modal_autor').textContent = mapaData.tipo;
            document.getElementById('modal_editorial').textContent = '-';
            document.getElementById('modal_cdu').textContent = '-';
            document.getElementById('modal_siglas').textContent = '-';
            document.getElementById('modal_sede').textContent = mapaData.sede;
            
            // Configurar el formulario para mapas
            const form = document.querySelector('#bajaModal form');
            form.action = '/baja-mapa/';
            
            // Agregar campo oculto para el ID del mapa
            let hiddenInput = document.getElementById('mapa_id_hidden');
            if (!hiddenInput) {
                hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'mapa_id';
                hiddenInput.id = 'mapa_id_hidden';
                form.appendChild(hiddenInput);
            }
            hiddenInput.value = id;
            
            // Limpiar el campo libro_id para evitar conflictos
            document.getElementById('libro_id').value = '';
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error en darDeBajaMapa:', error);
            alert('Error al procesar la baja del mapa');
        }
    };

    window.darDeBajaPrograma = function(id, materia) {
        try {
            console.log('üìö Iniciando proceso de baja para programa:', id);
            
            // Buscar los datos del programa en la tabla
            const programaData = window.programaTableData?.find(item => item.id_programa == id);
            
            if (!programaData) {
                console.error('‚ùå No se encontraron datos para programa ID:', id);
                alert('Error: No se encontraron los datos del programa');
                return;
            }
            
            console.log('üìä Datos del programa encontrados:', programaData);
            
            // Llenar datos en el modal espec√≠fico de programa
            document.getElementById('modal_programa_id').textContent = programaData.id_programa || 'N/A';
            document.getElementById('modal_programa_materia').textContent = programaData.materia || 'Sin materia';
            document.getElementById('modal_programa_profesor').textContent = programaData.profesor || 'Sin profesor';
            document.getElementById('modal_programa_carrera').textContent = programaData.carrera || 'Sin carrera';
            document.getElementById('modal_programa_ciclo').textContent = programaData.ciclo_lectivo || 'Sin ciclo lectivo';
            document.getElementById('modal_programa_sede').textContent = programaData.sede || 'Sin sede';
            
            // Configurar el campo oculto del ID del programa
            document.getElementById('programa_id_baja').value = id;
            
            // Limpiar el textarea del motivo
            document.getElementById('motivo_baja_programa').value = '';
            
            // Mostrar el modal espec√≠fico de programa
            const bajaProgramaModal = new bootstrap.Modal(document.getElementById('bajaProgramaModal'));
            bajaProgramaModal.show();
            
        } catch (error) {
            console.error('Error en darDeBajaPrograma:', error);
            alert('Error al procesar la baja del programa');
        }
    };

    window.darDeBajaMultimedia = function(id, tipo) {
        try {
            console.log('üé¨ Iniciando proceso de baja para multimedia:', id);
            
            // Buscar los datos del multimedia en la tabla
            const multimediaData = window.multimediaTableData?.find(item => item.id_multi == id);
            
            if (!multimediaData) {
                console.error('‚ùå No se encontraron datos para multimedia ID:', id);
                alert('Error: No se encontraron los datos del multimedia');
                return;
            }
            
            console.log('üìä Datos del multimedia encontrados:', multimediaData);
            
            // Llenar datos en el modal de baja
            document.getElementById('modal_num_inventario').textContent = multimediaData.id_inventario || 'N/A';
            document.getElementById('modal_titulo').textContent = multimediaData.titulo_contenido || 'Sin t√≠tulo';
            document.getElementById('modal_autor').textContent = multimediaData.profesor || 'Sin especificar';
            document.getElementById('modal_editorial').textContent = multimediaData.carrera || 'Sin especificar';
            document.getElementById('modal_cdu').textContent = multimediaData.materia || 'Sin especificar';
            document.getElementById('modal_siglas').textContent = multimediaData.ingresar_enlace || 'Sin enlace';
            document.getElementById('modal_sede').textContent = multimediaData.sede || 'Sin especificar';
            
            // Configurar el formulario para multimedia
            const form = document.querySelector('#bajaModal form');
            form.action = '/baja-multimedia/';
            
            // Agregar campo oculto para el ID del multimedia
            let hiddenInput = document.getElementById('multimedia_id_hidden');
            if (!hiddenInput) {
                hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'id_multi';
                hiddenInput.id = 'multimedia_id_hidden';
                form.appendChild(hiddenInput);
            }
            hiddenInput.value = id;
            
            // Limpiar el campo libro_id para evitar conflictos
            document.getElementById('libro_id').value = '';
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error en darDeBajaMultimedia:', error);
            alert('Error al procesar la baja del multimedia');
        }
    };

    window.darDeBajaNotebook = function(id, tipo) {
        try {
            console.log('üíª Iniciando proceso de baja para notebook:', id);
            
            // Buscar los datos del notebook en la tabla
            const notebookData = window.notebookTableData?.find(item => item.id_not == id);
            
            if (!notebookData) {
                console.error('‚ùå No se encontraron datos para notebook ID:', id);
                alert('Error: No se encontraron los datos del notebook');
                return;
            }
            
            console.log('üìä Datos del notebook encontrados:', notebookData);
            
            // Llenar datos en el modal de baja
            document.getElementById('modal_num_inventario').textContent = notebookData.id_not || 'N/A';
            document.getElementById('modal_titulo').textContent = notebookData.modelo_not || 'Sin modelo';
            document.getElementById('modal_autor').textContent = notebookData.num_registro || 'Sin registro';
            document.getElementById('modal_editorial').textContent = notebookData.sede || 'Sin especificar';
            document.getElementById('modal_cdu').textContent = notebookData.estado || 'Sin estado';
            document.getElementById('modal_siglas').textContent = notebookData.descripcion || 'Sin descripci√≥n';
            document.getElementById('modal_sede').textContent = notebookData.sede || 'Sin especificar';
            
            // Configurar el formulario para notebook
            const form = document.querySelector('#bajaModal form');
            form.action = '/baja-notebook-mejorada/';
            
            // Agregar campo oculto para el ID del notebook
            let hiddenInput = document.getElementById('notebook_id_hidden');
            if (!hiddenInput) {
                hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'not_id';
                hiddenInput.id = 'notebook_id_hidden';
                form.appendChild(hiddenInput);
            }
            hiddenInput.value = id;
            
            // Limpiar otros campos para evitar conflictos
            document.getElementById('libro_id').value = '';
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error en darDeBajaNotebook:', error);
            alert('Error al procesar la baja del notebook');
        }
    };

    window.darDeBajaProyector = function(id, tipo) {
        try {
            console.log('üìΩÔ∏è Iniciando proceso de baja para proyector:', id);
            
            // Buscar los datos del proyector en la tabla
            const proyectorData = window.proyectorTableData?.find(item => item.id_proyector == id);
            
            if (!proyectorData) {
                console.error('No se encontraron datos del proyector en la tabla');
                // Buscar en la tabla DOM como fallback
                const filaProyector = document.querySelector(`#proyectores-table tr[data-id="${id}"]`);
                if (!filaProyector) {
                    alert('Error: No se pudieron obtener los datos del proyector');
                    return;
                }
            }
            
            // Obtener datos del proyector (desde datos de tabla o DOM)
            let marca, modelo, numRegistro, sede;
            
            if (proyectorData) {
                marca = proyectorData.marca_pro || '';
                modelo = proyectorData.modelo_pro || '';
                numRegistro = proyectorData.num_registro || '';
                sede = proyectorData.sede || '';
            } else {
                // Fallback: obtener desde DOM
                const celdas = document.querySelector(`#proyectores-table tr[data-id="${id}"]`)?.querySelectorAll('td');
                if (celdas && celdas.length > 0) {
                    numRegistro = celdas[1]?.textContent.trim() || '';
                    modelo = celdas[2]?.textContent.trim() || '';
                    sede = celdas[3]?.textContent.trim() || '';
                }
            }
            
            // Llenar datos b√°sicos del proyector en el modal
            document.getElementById('modal_num_inventario').textContent = numRegistro || id;
            document.getElementById('modal_titulo').textContent = modelo || 'Proyector';
            document.getElementById('modal_autor').textContent = tipo || 'Proyector';
            document.getElementById('modal_editorial').textContent = modelo || '-';
            document.getElementById('modal_cdu').textContent = '-';
            document.getElementById('modal_siglas').textContent = sede || 'LA PLATA';
            document.getElementById('modal_sede').textContent = sede || 'LA PLATA';
            
            // Configurar el formulario para proyector
            const form = document.querySelector('#bajaForm');
            form.action = "{% url 'baja_proyector' %}";
            
            // Agregar campo oculto para el ID del proyector
            let hiddenInput = document.getElementById('proyector_id_hidden');
            if (!hiddenInput) {
                hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'proyector_id';
                hiddenInput.id = 'proyector_id_hidden';
                form.appendChild(hiddenInput);
            }
            hiddenInput.value = id;
            
            // Limpiar otros campos ID para evitar conflictos
            const otherIds = ['libro_id', 'multimedia_id_hidden', 'notebook_id_hidden', 'programa_id_hidden'];
            otherIds.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.value = '';
            });
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error en darDeBajaProyector:', error);
            alert('Error al procesar la baja del proyector');
        }
    };

    window.darDeBajaVarios = function(id, tipo) {
        try {
            console.log('üóëÔ∏è Dando de baja varios con ID:', id, 'Tipo:', tipo);
            
            // Buscar la fila del varios en la tabla
            const filasVarios = document.querySelectorAll('#varios-table tr');
            let variosData = null;
            
            filasVarios.forEach(fila => {
                const celdas = fila.querySelectorAll('td');
                if (celdas.length > 0 && celdas[0].textContent.trim() === id.toString()) {
                    variosData = {
                        id: celdas[0].textContent.trim(),
                        tipo: celdas[1].textContent.trim(),
                        denominacion: celdas[2].textContent.trim(),
                        num_registro: celdas[3].textContent.trim(),
                        sede: celdas[4].textContent.trim()
                    };
                }
            });
            
            if (!variosData) {
                console.error('No se pudo encontrar la fila del varios');
                alert('Error: No se pudieron obtener los datos del material varios');
                return;
            }
            
            // Llenar el formulario oculto con el ID
            const libroIdField = document.getElementById('libro_id');
            libroIdField.value = id;
            // Cambiar el nombre del campo para que coincida con lo que espera la vista baja_varios
            libroIdField.name = 'varios_id';
            
            // Llenar los datos en el modal (adaptando los campos para varios)
            document.getElementById('modal_num_inventario').textContent = variosData.num_registro || id;
            document.getElementById('modal_titulo').textContent = variosData.denominacion || 'Material Varios';
            document.getElementById('modal_autor').textContent = variosData.tipo || 'Varios';
            document.getElementById('modal_editorial').textContent = 'N/A';
            document.getElementById('modal_cdu').textContent = 'N/A';
            document.getElementById('modal_siglas').textContent = 'VAR';
            document.getElementById('modal_sede').textContent = variosData.sede || 'LA PLATA';
            
            // Manejar la imagen (varios generalmente no tienen imagen)
            const imagenModal = document.getElementById('libro_imagen_modal');
            const placeholderModal = document.getElementById('libro_placeholder');
            
            imagenModal.style.display = 'none';
            placeholderModal.style.display = 'flex';
            
            // Limpiar el formulario
            document.getElementById('motivo_baja').value = '';
            document.getElementById('imagen_rota').value = '';
            
            // Cambiar la acci√≥n del formulario para varios
            const form = document.querySelector('#bajaForm');
            form.action = "{% url 'baja_varios' %}";
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('bajaModal'));
            modal.show();
            
        } catch (error) {
            console.error('Error al dar de baja varios:', error);
            alert('Error al abrir el modal de baja para varios');
        }
    };

    window.verInformeBajaMapa = function(id) {
        try {
            // Obtener datos del mapa desde la fila de la tabla
            const filasMapa = document.querySelectorAll('#mapas-table tr');
            let mapaData = null;
            
            filasMapa.forEach(fila => {
                const celdas = fila.querySelectorAll('td');
                if (celdas.length > 0 && celdas[0].textContent.trim() === id.toString()) {
                    mapaData = {
                        id: celdas[0].textContent.trim(),
                        tipo: celdas[1].textContent.trim(),
                        denominacion: celdas[2].textContent.trim(),
                        num_registro: celdas[3].textContent.trim(),
                        sede: celdas[4].textContent.trim()
                    };
                }
            });
            
            if (!mapaData) {
                alert('Error: No se pudieron obtener los datos del mapa');
                return;
            }
            
            // Llenar datos b√°sicos del mapa en el modal
            document.getElementById('informe_num_inventario').textContent = mapaData.num_registro;
            document.getElementById('informe_titulo').textContent = mapaData.denominacion;
            document.getElementById('informe_autor').textContent = mapaData.tipo;
            document.getElementById('informe_cdu').textContent = '-';
            document.getElementById('informe_siglas').textContent = mapaData.sede;
            
            // Mostrar indicador de carga
            const motivoElement = document.getElementById('informe_motivo');
            const fechaElement = document.getElementById('informe_fecha_baja');
            
            motivoElement.textContent = 'Cargando motivo de baja...';
            fechaElement.textContent = 'Cargando...';
            
            // Manejar imagen del mapa
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            if (imagenModal && placeholderModal) {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Guardar ID del mapa actual para el bot√≥n de dar de alta
            window.currentMapaId = id;
            window.currentLibroId = null; // Limpiar ID de libro
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // Obtener datos reales del informe de baja
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch('/obtener-informe-baja-mapa/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    mapa_id: id
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const informe = data.informe;
                    
                    // Actualizar motivo de baja
                    if (informe.motivo && informe.motivo.trim() !== '') {
                        motivoElement.textContent = informe.motivo;
                        motivoElement.style.color = '#495057';
                        motivoElement.style.fontStyle = 'normal';
                    } else {
                        motivoElement.textContent = 'Motivo no registrado';
                        motivoElement.style.color = '#6c757d';
                        motivoElement.style.fontStyle = 'italic';
                    }
                    
                    // Actualizar fecha de baja
                    if (informe && informe.fecha_baja) {
                    fechaElement.textContent = informe.fecha_baja;
                    } else {
                        fechaElement.textContent = 'Fecha no registrada';
                    }
                    
                    // Manejar imagen de baja
                    const imagenBajaContainer = document.getElementById('imagen_baja_container');
                    const imagenBaja = document.getElementById('imagen_baja');
                    
                    if (informe.imagen_baja && imagenBaja && imagenBajaContainer) {
                        imagenBaja.src = informe.imagen_baja;
                        imagenBajaContainer.style.display = 'block';
                    } else if (imagenBajaContainer) {
                        imagenBajaContainer.style.display = 'none';
                    }
                } else {
                    motivoElement.innerHTML = `<span style="color: #dc3545; font-style: italic;">Error al cargar: ${data.error}</span>`;
                    fechaElement.textContent = 'Error al cargar';
                    console.error('Error:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                motivoElement.innerHTML = '<span style="color: #dc3545; font-style: italic;">Error de conexi√≥n al cargar el motivo</span>';
                fechaElement.textContent = 'Error de conexi√≥n';
            });
            
        } catch (error) {
            console.error('Error en verInformeBajaMapa:', error);
            alert('Error al mostrar el informe de baja del mapa');
        }
    };

    window.verInformeBajaPrograma = function(id) {
        try {
            console.log('Iniciando verInformeBajaPrograma para ID:', id);
            
            // Obtener datos del programa desde la tabla
            const programaData = window.programaTableData?.find(item => item.id_programa == id);
            
            if (!programaData) {
                console.error('No se encontraron datos para programa ID:', id);
                alert('Error: No se pudieron obtener los datos del programa');
                return;
            }
            
            // Guardar ID del programa actual para el bot√≥n de dar de alta
            window.currentProgramaId = id;
            window.currentLibroId = null;
            window.currentMapaId = null;
            window.currentMultimediaId = null;
            window.currentNotebookId = null;
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // Llenar datos b√°sicos del programa en el modal
            document.getElementById('informe_num_inventario').textContent = programaData.id_programa;
            document.getElementById('informe_titulo').textContent = programaData.materia;
            document.getElementById('informe_autor').textContent = programaData.profesor;
            document.getElementById('informe_cdu').textContent = programaData.carrera;
            document.getElementById('informe_siglas').textContent = programaData.sede;
            
            // Obtener elementos para mostrar informaci√≥n de baja
            const motivoElement = document.getElementById('informe_motivo');
            const fechaElement = document.getElementById('informe_fecha_baja');
            
            // Mostrar indicadores de carga
            motivoElement.innerHTML = '<span style="color: #6c757d; font-style: italic;">Cargando motivo de baja...</span>';
            fechaElement.innerHTML = '<span style="color: #6c757d; font-style: italic;">Cargando fecha...</span>';
            
            // Manejar imagen del programa (ocultar ya que los programas no tienen imagen)
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            if (imagenModal && placeholderModal) {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
                placeholderModal.innerHTML = 'Programa<br>Acad√©mico';
            }
            
            // Ocultar contenedor de imagen de baja inicialmente
            const imagenBajaContainer = document.getElementById('imagen_baja_programa_container');
            if (imagenBajaContainer) {
                imagenBajaContainer.style.display = 'none';
            }
            
            // Obtener datos reales del informe de baja
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            const formData = new FormData();
            formData.append('programa_id', id);
            formData.append('csrfmiddlewaretoken', csrfToken);
            
            console.log('Enviando solicitud para obtener informe de baja del programa:', id);
            
            fetch('/obtener-informe-baja-programa/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la respuesta del servidor: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('Datos recibidos del servidor:', data);
                
                // Verificar si hay un mensaje de error en la respuesta
                if (data.error) {
                    throw new Error('Error del servidor: ' + data.error);
                }
                
                // Verificar si la estructura de datos es correcta
                if (!data.success || !data.informe) {
                    throw new Error('Formato de respuesta inv√°lido o error en el servidor');
                }
                
                const informe = data.informe;
                console.log('Informe completo:', informe);
                console.log('Motivo de baja:', informe && informe.motivo_baja ? informe.motivo_baja : 'No disponible');
                console.log('Fecha de baja:', informe && informe.fecha_baja ? informe.fecha_baja : 'No disponible');
                
                // Actualizar motivo de baja
                if (informe && informe.motivo_baja && informe.motivo_baja.trim() !== '') {
                    motivoElement.innerHTML = informe.motivo_baja;
                    motivoElement.style.color = '#495057';
                    motivoElement.style.fontStyle = 'normal';
                } else {
                    motivoElement.innerHTML = 'Sin motivo especificado';
                    motivoElement.style.color = '#6c757d';
                    motivoElement.style.fontStyle = 'italic';
                }
                
                // Actualizar fecha de baja
                if (informe && informe.fecha_baja) {
                    fechaElement.innerHTML = informe.fecha_baja;
                    fechaElement.style.color = '#dc3545';
                    fechaElement.style.fontStyle = 'normal';
                } else {
                    fechaElement.innerHTML = 'Fecha no disponible';
                    fechaElement.style.color = '#6c757d';
                    fechaElement.style.fontStyle = 'italic';
                }
                
                // Manejar imagen de baja si existe
                const imagenBaja = document.getElementById('imagen_baja_programa');
                
                if (imagenBajaContainer && imagenBaja) {
                    if (informe.imagen_baja && informe.imagen_baja.trim() !== '') {
                        imagenBaja.src = informe.imagen_baja;
                        imagenBajaContainer.style.display = 'block';
                        console.log('Mostrando imagen de baja:', informe.imagen_baja);
                    } else {
                        imagenBajaContainer.style.display = 'none';
                        console.log('No hay imagen de baja para mostrar');
                    }
                } else {
                    console.error('No se encontraron elementos para la imagen de baja');
                }
            })
            .catch(error => {
                console.error('Error al obtener o procesar informe de baja:', error);
                
                // Mostrar mensaje de error en los elementos
                motivoElement.innerHTML = 'Error al cargar el motivo';
                motivoElement.style.color = '#dc3545';
                motivoElement.style.fontStyle = 'italic';
                
                fechaElement.innerHTML = 'Error al cargar la fecha';
                fechaElement.style.color = '#dc3545';
                fechaElement.style.fontStyle = 'italic';
                
                // Ocultar contenedor de imagen en caso de error
                if (imagenBajaContainer) {
                    imagenBajaContainer.style.display = 'none';
                }
            });
            
        } catch (error) {
            console.error('Error general en verInformeBajaPrograma:', error);
            alert('Error al mostrar el informe de baja del programa');
        }
    };

    window.verInformeBajaMultimedia = function(id) {
        try {
            // Obtener datos del multimedia desde la fila de la tabla
            const filasMultimedia = document.querySelectorAll('#multimedia-table tr');
            let multimediaData = null;
            
            filasMultimedia.forEach(fila => {
                const celdas = fila.querySelectorAll('td');
                if (celdas.length > 0 && celdas[0].textContent.trim() === id.toString()) {
                    multimediaData = {
                        id: celdas[0].textContent.trim(),
                        titulo_contenido: celdas[1].textContent.trim(),
                        profesor: celdas[2].textContent.trim(),
                        carrera: celdas[3].textContent.trim(),
                        materia: celdas[4].textContent.trim(),
                        enlace: celdas[5].textContent.trim(),
                        sede: celdas[6].textContent.trim()
                    };
                }
            });
            
            if (!multimediaData) {
                alert('Error: No se pudieron obtener los datos del multimedia');
                return;
            }
            
            // Llenar datos b√°sicos del multimedia en el modal
            document.getElementById('informe_num_inventario').textContent = multimediaData.id;
            document.getElementById('informe_titulo').textContent = multimediaData.titulo_contenido;
            document.getElementById('informe_autor').textContent = multimediaData.profesor;
            document.getElementById('informe_cdu').textContent = multimediaData.carrera;
            document.getElementById('informe_siglas').textContent = multimediaData.sede;
            
            // Mostrar indicador de carga
            const motivoElement = document.getElementById('informe_motivo');
            const fechaElement = document.getElementById('informe_fecha_baja');
            
            motivoElement.textContent = 'Cargando motivo de baja...';
            fechaElement.textContent = 'Cargando...';
            
            // Manejar imagen del multimedia
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            if (imagenModal && placeholderModal) {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Guardar ID del multimedia actual para el bot√≥n de dar de alta
            window.currentMultimediaId = id;
            window.currentLibroId = null; // Limpiar ID de libro
            window.currentMapaId = null; // Limpiar ID de mapa
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // Obtener datos reales del informe de baja
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            const formData = new FormData();
            formData.append('multimedia_id', id);
            formData.append('csrfmiddlewaretoken', csrfToken);
            
            fetch('/obtener-informe-baja-multimedia/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const informe = data.informe;
                    
                    // Actualizar motivo de baja
                    if (informe && informe.motivo_baja && informe.motivo_baja.trim() !== '') {
                    motivoElement.textContent = informe.motivo_baja;
                        motivoElement.style.color = '#495057';
                        motivoElement.style.fontStyle = 'normal';
                    } else {
                        motivoElement.textContent = 'Motivo no registrado';
                        motivoElement.style.color = '#6c757d';
                        motivoElement.style.fontStyle = 'italic';
                    }
                    
                    // Actualizar fecha de baja
                    if (informe && informe.fecha_baja) {
                    fechaElement.textContent = informe.fecha_baja;
                    } else {
                        fechaElement.textContent = 'Fecha no registrada';
                    }
                    
                    // Manejar imagen de baja
                    const imagenBajaContainer = document.getElementById('imagen_baja_container');
                    const imagenBaja = document.getElementById('imagen_baja');
                    
                    if (informe && informe.imagen_url && imagenBaja && imagenBajaContainer) {
                    imagenBaja.src = informe.imagen_url;
                        imagenBajaContainer.style.display = 'block';
                    } else if (imagenBajaContainer) {
                        imagenBajaContainer.style.display = 'none';
                    }
                } else {
                    motivoElement.innerHTML = `<span style="color: #dc3545; font-style: italic;">Error al cargar: ${data.error}</span>`;
                    fechaElement.textContent = 'Error al cargar';
                    console.error('Error:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                motivoElement.innerHTML = '<span style="color: #dc3545; font-style: italic;">Error de conexi√≥n al cargar el motivo</span>';
                fechaElement.textContent = 'Error de conexi√≥n';
            });
            
        } catch (error) {
            console.error('Error en verInformeBajaMultimedia:', error);
            alert('Error al mostrar el informe de baja del multimedia');
        }
    };

    window.verInformeBajaNotebook = function(id) {
            console.log('üìã Mostrando informe de baja para notebook:', id);
            
            // Buscar datos del notebook
            const notebookData = window.notebookTableData?.find(item => item.id_not == id);
            if (!notebookData) {
                console.error('‚ùå No se encontraron datos para notebook ID:', id);
                alert('Error: No se encontraron datos del notebook');
                return;
            }
            
            // Llenar datos b√°sicos del notebook en el modal (usando los mismos elementos que libros y mapas)
            document.getElementById('informe_num_inventario').textContent = notebookData.id_not || 'N/A';
            document.getElementById('informe_titulo').textContent = notebookData.modelo_not || 'Notebook';
            document.getElementById('informe_autor').textContent = notebookData.num_registro || '-';
            document.getElementById('informe_cdu').textContent = '-';
            document.getElementById('informe_siglas').textContent = notebookData.sede || 'N/A';
            
            // Mostrar indicador de carga
            const motivoElement = document.getElementById('informe_motivo');
            const fechaElement = document.getElementById('informe_fecha_baja');
            
            motivoElement.textContent = 'Cargando motivo de baja...';
            fechaElement.textContent = 'Cargando...';
            
            // Manejar imagen del notebook
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            if (imagenModal && placeholderModal) {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Guardar ID del notebook actual para el bot√≥n de dar de alta
            window.currentNotebookId = id;
            window.currentLibroId = null; // Limpiar ID de libro
            window.currentMapaId = null; // Limpiar ID de mapa
            window.currentMultimediaId = null; // Limpiar ID de multimedia
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // Obtener datos reales del informe de baja
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            const formData = new FormData();
            formData.append('notebook_id', id);
            formData.append('csrfmiddlewaretoken', csrfToken);
            
            fetch('/obtener-informe-baja-notebook/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('üîç DEBUG - Respuesta completa del servidor:', data);
                
                if (data.success) {
                    const informe = data.informe;
                    console.log('üîç DEBUG - Datos del informe:', informe);
                    console.log('üîç DEBUG - Motivo de baja recibido:', informe.motivo_baja);
                    
                    // Actualizar motivo de baja
                    const motivoElement = document.getElementById('informe_motivo');
                    if (informe && informe.motivo_baja && informe.motivo_baja.trim() !== '') {
                    motivoElement.textContent = informe.motivo_baja;
                        motivoElement.style.color = '#495057';
                        motivoElement.style.fontStyle = 'normal';
                        console.log('‚úÖ DEBUG - Motivo mostrado correctamente:', informe.motivo_baja);
                    } else {
                        motivoElement.textContent = 'Motivo no registrado';
                        motivoElement.style.color = '#6c757d';
                        motivoElement.style.fontStyle = 'italic';
                        console.log('‚ö†Ô∏è DEBUG - Motivo vac√≠o o nulo');
                    }
                    
                    // Actualizar fecha de baja
                    const fechaElement = document.getElementById('informe_fecha_baja');
                    if (informe && informe.fecha_baja) {
                    fechaElement.textContent = informe.fecha_baja;
                    } else {
                        fechaElement.textContent = 'Fecha no registrada';
                    }
                    
                    // Manejar imagen de baja
                    const imagenBaja = document.getElementById('imagen_baja');
                    if (informe.imagen_rota && informe.imagen_rota.trim() !== '') {
                        imagenBaja.src = informe.imagen_rota;
                        imagenBaja.style.display = 'block';
                    } else {
                        imagenBaja.style.display = 'none';
                    }
                } else {
                    console.error('‚ùå Error al obtener informe:', data.error);
                    // Mostrar valores por defecto
                    document.getElementById('informe_motivo').textContent = 'Error al cargar motivo';
                    document.getElementById('informe_fecha_baja').textContent = 'Error al cargar fecha';
                }
            })
            .catch(error => {
                console.error('‚ùå Error en la petici√≥n:', error);
                document.getElementById('informe_motivo').textContent = 'Error de conexi√≥n';
                document.getElementById('informe_fecha_baja').textContent = 'Error de conexi√≥n';
            });
        };

    window.verInformeBajaProyector = function(id) {
        console.log('üìΩÔ∏è Mostrando informe de baja para proyector:', id);
        
        // Buscar datos del proyector
        const proyectorData = window.proyectorTableData?.find(item => item.id_proyector == id);
        if (!proyectorData) {
            console.error('‚ùå No se encontraron datos para proyector ID:', id);
            alert('Error: No se encontraron datos del proyector');
            return;
        }
        
        // Llenar datos b√°sicos del proyector en el modal
        document.getElementById('informe_num_inventario').textContent = proyectorData.id_proyector || 'N/A';
        document.getElementById('informe_titulo').textContent = proyectorData.modelo_pro || 'Proyector';
        document.getElementById('informe_autor').textContent = proyectorData.num_registro || '-';
        document.getElementById('informe_cdu').textContent = '-';
        document.getElementById('informe_siglas').textContent = proyectorData.sede || 'N/A';
        
        // Mostrar indicador de carga
        const motivoElement = document.getElementById('informe_motivo');
        const fechaElement = document.getElementById('informe_fecha_baja');
        
        motivoElement.textContent = 'Cargando motivo de baja...';
        fechaElement.textContent = 'Cargando...';
        
        // Manejar imagen del proyector
        const imagenModal = document.getElementById('informe_imagen');
        const placeholderModal = document.getElementById('informe_placeholder');
        
        if (imagenModal && placeholderModal) {
            imagenModal.style.display = 'none';
            placeholderModal.style.display = 'flex';
        }
        
        // Guardar ID del proyector actual para el bot√≥n de dar de alta
        window.currentProyectorId = id;
        window.currentLibroId = null; // Limpiar ID de libro
        window.currentMapaId = null; // Limpiar ID de mapa
        window.currentMultimediaId = null; // Limpiar ID de multimedia
        window.currentNotebookId = null; // Limpiar ID de notebook
        window.currentProgramaId = null; // Limpiar ID de programa
        
        // Mostrar el modal
        const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
        modal.show();
        
        // Obtener datos reales del informe de baja
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const formData = new FormData();
        formData.append('proyector_id', id);
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        fetch('/obtener-informe-baja-proyector/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('Datos recibidos del servidor:', data);
            if (data.success) {
                // Actualizar datos reales del informe
                document.getElementById('informe_motivo').textContent = data.motivo || 'Sin motivo especificado';
                document.getElementById('informe_fecha_baja').textContent = data.fecha_baja || 'Fecha no disponible';
                
                console.log('‚úÖ Informe de baja cargado exitosamente para proyector:', id);
            } else {
                console.error('‚ùå Error al obtener informe de baja:', data.error);
                document.getElementById('informe_motivo').textContent = 'Error al cargar motivo';
                document.getElementById('informe_fecha_baja').textContent = 'Error al cargar fecha';
            }
        })
        .catch(error => {
            console.error('‚ùå Error en petici√≥n AJAX:', error);
            document.getElementById('informe_motivo').textContent = 'Error de conexi√≥n';
            document.getElementById('informe_fecha_baja').textContent = 'Error de conexi√≥n';
        });
    };

    window.verInformeBajaVarios = function(variosId) {
        console.log('üîß Obteniendo informe de baja para varios ID:', variosId);
        
        try {
            // Buscar datos del varios en la tabla para llenar informaci√≥n b√°sica
            const filasVarios = document.querySelectorAll('#varios-table tr');
            let variosData = null;
            
            filasVarios.forEach(fila => {
                const celdas = fila.querySelectorAll('td');
                if (celdas.length > 0 && celdas[0].textContent.trim() === variosId.toString()) {
                    variosData = {
                        id: celdas[0].textContent.trim(),
                        tipo: celdas[1].textContent.trim(),
                        denominacion: celdas[2].textContent.trim(),
                        num_registro: celdas[3].textContent.trim(),
                        sede: celdas[4].textContent.trim()
                    };
                }
            });
            
            if (!variosData) {
                alert('Error: No se pudieron obtener los datos del material varios');
                return;
            }
            
            // Llenar datos b√°sicos en el modal de informe
            document.getElementById('informe_num_inventario').textContent = variosData.num_registro || variosId;
            document.getElementById('informe_titulo').textContent = variosData.denominacion || 'Material Varios';
            document.getElementById('informe_autor').textContent = variosData.tipo || 'Varios';
            document.getElementById('informe_cdu').textContent = 'N/A';
            document.getElementById('informe_siglas').textContent = 'VAR';
            
            // Mostrar indicadores de carga
            document.getElementById('informe_motivo').textContent = 'Cargando motivo de baja...';
            document.getElementById('informe_fecha_baja').textContent = 'Cargando...';
            
            // Manejar imagen (varios generalmente no tienen imagen)
            const imagenModal = document.getElementById('informe_imagen');
            const placeholderModal = document.getElementById('informe_placeholder');
            
            if (imagenModal && placeholderModal) {
                imagenModal.style.display = 'none';
                placeholderModal.style.display = 'flex';
            }
            
            // Guardar el ID del varios para usar en el bot√≥n DAR DE ALTA
            window.currentVariosId = variosId;
            
            // Limpiar otros IDs
            window.currentLibroId = null;
            window.currentMapaId = null;
            window.currentMultimediaId = null;
            window.currentNotebookId = null;
            window.currentProgramaId = null;
            window.currentProyectorId = null;
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('verInformeModal'));
            modal.show();
            
            // Obtener datos reales del informe de baja
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch('/obtener-informe-baja-varios/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    varios_id: variosId
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('üìã Respuesta del servidor:', data);
                
                if (data.success) {
                    const informe = data.informe;
                    
                    // Actualizar contenido del modal con datos reales
                    document.getElementById('informe_motivo').textContent = informe.motivo || 'No especificado';
                    document.getElementById('informe_fecha_baja').textContent = (informe && informe.fecha_baja) ? informe.fecha_baja : 'No registrada';
                    
                    // Manejar imagen de baja si existe
                    const imagenContainer = document.getElementById('imagen_baja_container');
                    const imagenElement = document.getElementById('imagen_baja');
                    
                    if (informe.imagen_baja && imagenContainer && imagenElement) {
                        imagenElement.src = informe.imagen_baja;
                        imagenContainer.style.display = 'block';
                        console.log('‚úÖ Imagen de baja cargada:', informe.imagen_baja);
                    } else if (imagenContainer) {
                        imagenContainer.style.display = 'none';
                        console.log('‚ùå No hay imagen de baja disponible');
                    }
                    
                    console.log('‚úÖ Informe de baja cargado exitosamente para varios:', variosId);
                } else {
                    console.error('‚ùå Error del servidor:', data.error);
                    document.getElementById('informe_motivo').textContent = 'Error al cargar motivo: ' + data.error;
                    document.getElementById('informe_fecha_baja').textContent = 'Error al cargar fecha';
                }
            })
            .catch(error => {
                console.error('‚ùå Error de red:', error);
                document.getElementById('informe_motivo').textContent = 'Error de conexi√≥n al cargar motivo';
                document.getElementById('informe_fecha_baja').textContent = 'Error de conexi√≥n';
            });
            
        } catch (error) {
            console.error('Error al mostrar informe de baja varios:', error);
            alert('Error al mostrar el informe de baja');
        }
    };

    // Event listener para el bot√≥n "DAR DE ALTA" - IMPLEMENTACI√ìN COMPLETA
    const btnDarDeAlta = document.getElementById('btnDarDeAlta');
    if (btnDarDeAlta) {
        btnDarDeAlta.addEventListener('click', function() {
            // Funci√≥n para mostrar el modal de confirmaci√≥n con validaciones
            function mostrarModalConfirmacion() {
                const confirmarModal = new bootstrap.Modal(document.getElementById('confirmarAltaModal'));
                const tituloElement = document.getElementById('informe_titulo');
                const confirmElement = document.getElementById('confirm_titulo_libro');
                
                if (tituloElement && confirmElement && tituloElement.textContent.trim() !== '') {
                    const titulo = tituloElement.textContent.trim();
                    confirmElement.textContent = titulo;
                    
                    const informeModal = bootstrap.Modal.getInstance(document.getElementById('verInformeModal'));
                    if (informeModal) informeModal.hide();
                    
                    confirmarModal.show();
                } else {
                    console.error('Elementos no encontrados o vac√≠os: informe_titulo o confirm_titulo_libro');
                    // Reintentar despu√©s de un breve delay para permitir que AJAX complete
                    setTimeout(mostrarModalConfirmacion, 500);
                }
            }
            
            // Verificar si es un libro, mapa, multimedia, notebook, programa, proyector o varios
            if (window.currentLibroId) {
                // L√≥gica para libros
                mostrarModalConfirmacion();
            } else if (window.currentMapaId) {
                // L√≥gica para mapas - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else if (window.currentMultimediaId) {
                // L√≥gica para multimedia - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else if (window.currentNotebookId) {
                // L√≥gica para notebooks - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else if (window.currentProgramaId) {
                // L√≥gica para programas - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else if (window.currentProyectorId) {
                // L√≥gica para proyectores - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else if (window.currentVariosId) {
                // L√≥gica para varios - IMPLEMENTACI√ìN COMPLETA
                mostrarModalConfirmacion();
            } else {
                console.error('No se ha seleccionado ning√∫n material para dar de alta');
                alert('Por favor, seleccione un material para dar de alta');
            }
        });
    }
    
    // Event listener para el bot√≥n CONFIRMAR del modal de confirmaci√≥n
    const btnConfirmarAlta = document.getElementById('confirmarDarAlta');
    if (btnConfirmarAlta) {
        btnConfirmarAlta.addEventListener('click', function() {
            if (window.currentLibroId) {
                darDeAltaLibro(window.currentLibroId);
            } else if (window.currentMapaId) {
                darDeAltaMapa(window.currentMapaId);
            } else if (window.currentMultimediaId) {
                darDeAltaMultimedia(window.currentMultimediaId);
            } else if (window.currentNotebookId) {
                darDeAltaNotebook(window.currentNotebookId);
            } else if (window.currentProgramaId) {
                darDeAltaPrograma(window.currentProgramaId);
            } else if (window.currentProyectorId) {
                darDeAltaProyector(window.currentProyectorId);
            } else if (window.currentVariosId) {
                darDeAltaVarios(window.currentVariosId);
            }
        });
    }

    // ===== FUNCI√ìN PARA DAR DE ALTA LIBRO (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaLibro(libroId) {
        if (!libroId) {
            alert('Error: ID de libro no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('libro_id', libroId);
        formData.append('sede', 'LA PLATA'); // Valor por defecto
        formData.append('disponibilidad', 'Domicilio'); // Valor por defecto
        formData.append('observaciones', 'Material reactivado desde sistema de gesti√≥n');
        
        // Obtener token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Realizar petici√≥n AJAX
        fetch('/dar-alta-libro/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            if (data.success) {
                // Cerrar modal de confirmaci√≥n
                const confirmarModal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (confirmarModal) confirmarModal.hide();
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
                console.log('‚úÖ Libro dado de alta exitosamente:', data);
            } else {
                alert('Error al dar de alta el libro: ' + (data.error || 'Error desconocido'));
                console.error('‚ùå Error del servidor:', data);
            }
        })
        .catch(error => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n. Por favor, intente nuevamente.');
        });
    }

    // ===== FUNCI√ìN PARA DAR DE ALTA MULTIMEDIA (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaMultimedia(multimediaId) {
        if (!multimediaId) {
            alert('Error: ID de multimedia no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('multimedia_id', multimediaId);
        formData.append('sede', 'LA PLATA'); // Valor por defecto
        formData.append('observaciones', 'Material reactivado desde sistema de gesti√≥n');
        
        // Obtener token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Realizar petici√≥n AJAX
        fetch('/dar-alta-multimedia/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            if (data.success) {
                // Cerrar modal de confirmaci√≥n
                const confirmarModal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (confirmarModal) confirmarModal.hide();
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
                console.log('‚úÖ Multimedia dado de alta exitosamente:', data);
            } else {
                alert('Error al dar de alta el multimedia: ' + (data.error || 'Error desconocido'));
                console.error('‚ùå Error del servidor:', data);
            }
        })
        .catch(error => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n. Por favor, intente nuevamente.');
        });
    }

    // ===== FUNCI√ìN PARA DAR DE ALTA NOTEBOOK (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaNotebook(notebookId) {
        if (!notebookId) {
            alert('Error: ID de notebook no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Obtener el token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('notebook_id', notebookId);
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Realizar petici√≥n al backend
        fetch('/dar-alta-notebook/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Cerrar modal de confirmaci√≥n
                const modal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (modal) {
                    modal.hide();
                }
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                alert('Error al dar de alta el notebook: ' + (data.error || 'Error desconocido'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error de conexi√≥n al dar de alta el notebook');
        })
        .finally(() => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
        });
    }
    function darDeAltaMapa(mapaId) {
        if (!mapaId) {
            alert('Error: ID de mapa no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('mapa_id', mapaId);
        formData.append('sede', 'LA PLATA'); // Valor por defecto
        formData.append('observaciones', 'Material reactivado desde sistema de gesti√≥n');
        
        // Obtener token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        // Realizar petici√≥n AJAX
        fetch('/dar-alta-mapa/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            if (data.success) {
                // Cerrar modal de confirmaci√≥n
                const confirmarModal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (confirmarModal) confirmarModal.hide();
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
                console.log('‚úÖ Mapa dado de alta exitosamente:', data);
            } else {
                alert('Error al dar de alta el mapa: ' + (data.error || 'Error desconocido'));
                console.error('‚ùå Error del servidor:', data);
            }
        })
        .catch(error => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n. Por favor, intente nuevamente.');
        });
    }
});

// Funci√≥n para reactivar programas
    // ===== FUNCI√ìN PARA DAR DE ALTA PROGRAMA (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaPrograma(programaId) {
        if (!programaId) {
            alert('Error: ID de programa no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        console.log('‚ôªÔ∏è Iniciando reactivaci√≥n de programa:', programaId);
        
        // Realizar petici√≥n AJAX para reactivar el programa
        fetch('/dar-alta-programa/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: `programa_id=${programaId}`
        })
        .then(response => response.json())
        .then(data => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            if (data.success) {
                console.log('‚úÖ Programa reactivado exitosamente');
                
                // Cerrar modal de confirmaci√≥n
                const confirmarModal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (confirmarModal) confirmarModal.hide();
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos
                setTimeout(() => {
                    location.reload();
                }, 2000);
                
            } else {
                console.error('‚ùå Error al reactivar programa:', data.error);
                alert('Error al reactivar el programa: ' + (data.error || 'Error desconocido'));
            }
        })
        .catch(error => {
            // Restaurar bot√≥n en caso de error
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
            
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n al reactivar el programa');
        });
    }

    // ===== FUNCI√ìN PARA DAR DE ALTA VARIOS (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaVarios(variosId) {
        if (!variosId) {
            alert('Error: ID de varios no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Obtener el token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('varios_id', variosId);
        formData.append('sede', 'LA PLATA'); // Valor por defecto
        formData.append('disponibilidad', 'Domicilio'); // Valor por defecto
        formData.append('observaciones', ''); // Observaciones vac√≠as por defecto
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        console.log('‚ôªÔ∏è Iniciando reactivaci√≥n de varios:', variosId);
        
        // Realizar petici√≥n al backend
        fetch('/dar-alta-varios/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ Varios reactivado exitosamente');
                
                // Cerrar modal de confirmaci√≥n
                const modal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (modal) {
                    modal.hide();
                }
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                console.error('‚ùå Error al reactivar varios:', data.error);
                alert('Error al dar de alta el material varios: ' + (data.error || 'Error desconocido'));
            }
        })
        .catch(error => {
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n al dar de alta el material varios');
        })
        .finally(() => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
        });
    }

    // ===== FUNCI√ìN PARA DAR DE ALTA PROYECTOR (COMUNICACI√ìN CON BACKEND) =====
    function darDeAltaProyector(proyectorId) {
        if (!proyectorId) {
            alert('Error: ID de proyector no v√°lido');
            return;
        }
        
        // Mostrar indicador de carga
        const btnConfirmar = document.getElementById('confirmarDarAlta');
        const textoOriginal = btnConfirmar.textContent;
        btnConfirmar.textContent = 'PROCESANDO...';
        btnConfirmar.disabled = true;
        
        // Obtener el token CSRF
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // Preparar datos para enviar
        const formData = new FormData();
        formData.append('proyector_id', proyectorId);
        formData.append('sede', 'LA PLATA'); // Valor por defecto
        formData.append('observaciones', ''); // Observaciones vac√≠as por defecto
        formData.append('csrfmiddlewaretoken', csrfToken);
        
        console.log('‚ôªÔ∏è Iniciando reactivaci√≥n de proyector:', proyectorId);
        
        // Realizar petici√≥n al backend
        fetch('/dar-alta-proyector/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('‚úÖ Proyector reactivado exitosamente');
                
                // Cerrar modal de confirmaci√≥n
                const modal = bootstrap.Modal.getInstance(document.getElementById('confirmarAltaModal'));
                if (modal) {
                    modal.hide();
                }
                
                // Mostrar modal de √©xito
                const exitoModal = new bootstrap.Modal(document.getElementById('exitoModal'));
                exitoModal.show();
                
                // Recargar la p√°gina despu√©s de 2 segundos para actualizar la tabla
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                console.error('‚ùå Error al reactivar proyector:', data.error);
                alert('Error al dar de alta el proyector: ' + (data.error || 'Error desconocido'));
            }
        })
        .catch(error => {
            console.error('‚ùå Error en la petici√≥n:', error);
            alert('Error de conexi√≥n al dar de alta el proyector');
        })
        .finally(() => {
            // Restaurar bot√≥n
            btnConfirmar.textContent = textoOriginal;
            btnConfirmar.disabled = false;
        });
    }

</script>

<!-- Modal de Detalles para Mapas -->
<div class="modal fade" id="detallesMapaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üó∫Ô∏è DETALLES DEL MAPA
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #27ae60; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Mapa
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_mapa_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">N¬∞ Registro:</td>
                                    <td style="padding: 12px 0;" id="detalle_mapa_num_registro">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Tipo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #27ae60;" id="detalle_mapa_tipo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Denominaci√≥n:</td>
                                    <td style="padding: 12px 0;" id="detalle_mapa_denominacion">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_mapa_sede">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_mapa_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles para Programas -->
<div class="modal fade" id="detallesProgramaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #8e44ad, #7d3c98); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üíª DETALLES DEL PROGRAMA
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #8e44ad; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Programa
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">N¬∞ Registro:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_num_registro">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Tipo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #8e44ad;" id="detalle_programa_tipo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Denominaci√≥n:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_denominacion">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Enlace:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_enlace">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_sede">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Disponibilidad:</td>
                                    <td style="padding: 12px 0;" id="detalle_programa_disponibilidad">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Observaciones -->
                <div class="row">
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #8e44ad; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Observaciones
                            </h6>
                            <div id="detalle_programa_observaciones" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #8e44ad; font-size: 14px; line-height: 1.5; min-height: 80px;">
                                Cargando observaciones...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles para Multimedia -->
<div class="modal fade" id="detallesMultimediaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üé¨ DETALLES DEL MULTIMEDIA
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #e74c3c; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Multimedia
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Materia:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #e74c3c;" id="detalle_multimedia_materia">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Profesor:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_profesor">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Carrera:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_carrera">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">T√≠tulo Contenido:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_titulo_contenido">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Enlace:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_enlace">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_multimedia_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles para Notebook -->
<div class="modal fade" id="detallesNotebookModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üíª DETALLES DEL NOTEBOOK
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #f39c12; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Notebook
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_notebook_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">N¬∞ Registro:</td>
                                    <td style="padding: 12px 0;" id="detalle_notebook_num_registro">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Modelo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #f39c12;" id="detalle_notebook_modelo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_notebook_sede">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_notebook_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles para Proyector -->
<div class="modal fade" id="detallesProyectorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #16a085, #138d75); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üìΩÔ∏è DETALLES DEL PROYECTOR
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #16a085; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Proyector
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_proyector_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">N¬∞ Registro:</td>
                                    <td style="padding: 12px 0;" id="detalle_proyector_num_registro">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Modelo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #16a085;" id="detalle_proyector_modelo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_proyector_sede">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_proyector_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles para Varios -->
<div class="modal fade" id="detallesVariosModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üì¶ DETALLES DEL MATERIAL VARIOS
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal -->
                <div class="row mb-4">
                    <!-- Informaci√≥n detallada -->
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #9b59b6; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Material Varios
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">ID:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">N¬∞ Registro:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_num_registro">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Tipo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #9b59b6;" id="detalle_varios_tipo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Denominaci√≥n:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_denominacion">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_sede">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Cantidad Total:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_cantidad">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Cantidad Disponible:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_cantidad_disponible">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_varios_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para ver detalles del material -->
<div class="modal fade" id="detallesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üìã DETALLES DEL MATERIAL
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 80vh; overflow-y: auto;">
                <!-- Informaci√≥n principal con imagen -->
                <div class="row mb-4">
                    <!-- Imagen del libro -->
                    <div class="col-md-4 text-center">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #3498db; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Imagen del Material
                            </h6>
                            <div style="width: 200px; height: 280px; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: relative;">
                                <img id="detalle_imagen_principal" src="" alt="Material" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                <div id="detalle_placeholder_principal" style="width: 100%; height: 100%; background: linear-gradient(135deg, #bdc3c7, #95a5a6); display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; text-align: center; font-weight: 600;">
                                    Sin<br>Imagen<br>Disponible
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informaci√≥n detallada -->
                    <div class="col-md-8">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #3498db; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Informaci√≥n del Material
                            </h6>
                            
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600; width: 35%;">N¬∞ Inventario:</td>
                                    <td style="padding: 12px 0;" id="detalle_num_inventario">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">T√≠tulo:</td>
                                    <td style="padding: 12px 0; font-weight: 600; color: #3498db;" id="detalle_titulo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Autor:</td>
                                    <td style="padding: 12px 0;" id="detalle_autor">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Editorial:</td>
                                    <td style="padding: 12px 0;" id="detalle_editorial">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">CDU:</td>
                                    <td style="padding: 12px 0;" id="detalle_cdu">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Siglas:</td>
                                    <td style="padding: 12px 0;" id="detalle_siglas">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 12px 0;" id="detalle_sede">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px 0; font-weight: 600;">Disponibilidad:</td>
                                    <td style="padding: 12px 0;" id="detalle_disponibilidad">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 0; font-weight: 600;">Estado:</td>
                                    <td style="padding: 12px 0;" id="detalle_estado">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Descripci√≥n y detalles adicionales -->
                <div class="row">
                    <!-- Descripci√≥n -->
                    <div class="col-md-6 mb-3">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); height: 100%;">
                            <h6 style="color: #3498db; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Descripci√≥n
                            </h6>
                            <div id="detalle_descripcion" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db; font-size: 14px; line-height: 1.5; min-height: 80px;">
                                Cargando descripci√≥n...
                            </div>
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div class="col-md-6 mb-3">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); height: 100%;">
                            <h6 style="color: #3498db; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Observaciones
                            </h6>
                            <div id="detalle_observaciones" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745; font-size: 14px; line-height: 1.5; min-height: 80px;">
                                Cargando observaciones...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Palabras clave -->
                <div class="row">
                    <div class="col-12">
                        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h6 style="color: #3498db; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px;">
                                Etiquetas / Palabras Clave
                            </h6>
                            <div id="detalle_etiquetas" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <!-- Las etiquetas se cargar√°n din√°micamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Obleas -->
<div class="modal fade" id="obleasModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #4ECDC4, #44A08D); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üìã IMPRIMIR OBLEAS - <span id="contadorObleas">0</span> OBLEAS SELECCIONADAS
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa; max-height: 70vh; overflow-y: auto;">
                <!-- √Årea de vista previa de obleas -->
                <div id="obleasContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; min-height: 200px; background: white; padding: 20px; border-radius: 10px; border: 2px dashed #4ECDC4;">
                    <div id="placeholder" style="grid-column: 1 / -1; text-align: center; color: #95a5a6; font-style: italic; padding: 40px;">
                        Haz clic en "Imprimir" de cualquier libro para agregar obleas aqu√≠
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: space-between;">
                <div style="display: flex; gap: 1rem;">
                    <button type="button" id="limpiarObleas" class="btn" 
                            style="background: #95a5a6; color: white; border: none; padding: 10px 25px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                        üóëÔ∏è LIMPIAR TODO
                    </button>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background: #4285F4; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                        CANCELAR
                    </button>
                    <button type="button" id="imprimirPDF" class="btn"
                            style="background: #27ae60; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                        üñ®Ô∏è GENERAR PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Baja -->
<div class="modal fade" id="bajaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #4ECDC4, #44A08D); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    DAR DE BAJA AL MATERIAL SELECCIONADO:
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <form method="POST" action="{% url 'baja_libro' %}" id="bajaForm" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body" style="padding: 0; background: #f8f9fa;">
                    <input type="hidden" id="libro_id" name="libro_id">
                    
                    <!-- Informaci√≥n del libro -->
                    <div style="background: linear-gradient(135deg, #e8f4f8, #f0f8ff); padding: 1.5rem; border-bottom: 2px solid #4ECDC4;">
                        <div class="row align-items-center">
                            <div class="col-2 text-center">
                                <div style="width: 80px; height: 100px; background: #ddd; border-radius: 8px; margin: 0 auto; position: relative; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                    <img id="libro_imagen_modal" src="" alt="Libro" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                    <div id="libro_placeholder" style="width: 100%; height: 100%; background: #bdc3c7; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center;">
                                        Sin<br>Imagen
                                    </div>
                                </div>
                            </div>
                            <div class="col-10">
                                <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                    <tr style="border-bottom: 1px solid #ddd;">
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%; text-align: center;">N¬∞ Inv.</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 25%;">T√≠tulo</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 20%;">Autor</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%;">Editorial</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 10%; text-align: center;">CDU</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 10%; text-align: center;">Siglas</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%; text-align: center;">Sede</td>
                                    </tr>
                                    <tr style="background: rgba(78, 205, 196, 0.1);">
                                        <td style="padding: 12px 12px; text-align: center; font-weight: 600;" id="modal_num_inventario">1</td>
                                        <td style="padding: 12px 12px; font-weight: 600; color: #2c3e50;" id="modal_titulo">T√≠tulo del libro</td>
                                        <td style="padding: 12px 12px;" id="modal_autor">Autor</td>
                                        <td style="padding: 12px 12px;" id="modal_editorial">Editorial</td>
                                        <td style="padding: 12px 12px; text-align: center;" id="modal_cdu">CDU</td>
                                        <td style="padding: 12px 12px; text-align: center; font-weight: 600;" id="modal_siglas">ABC</td>
                                        <td style="padding: 12px 12px; text-align: center;" id="modal_sede">LA PLATA</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de formulario -->
                    <div style="padding: 1.5rem;">
                        <div class="row">
                            <!-- Motivo de baja -->
                            <div class="col-md-6">
                                <div style="background: white; padding: 1.5rem; border-radius: 10px; border: 2px solid #4ECDC4; height: 100%;">
                                    <h6 style="color: #4ECDC4; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                                        Motivo de baja*
                                    </h6>
                                    <textarea class="form-control" id="motivo_baja" name="motivo_baja" 
                                              rows="6" required placeholder="Describe el motivo de la baja del material..."
                                              style="border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: none; padding: 12px;"></textarea>
                                </div>
                            </div>

                            <!-- Cargar imagen -->
                            <div class="col-md-6">
                                <div style="background: white; padding: 1.5rem; border-radius: 10px; border: 2px solid #f39c12; height: 100%;">
                                    <h6 style="color: #f39c12; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                                        Cargar imagen de baja
                                    </h6>
                                    
                                    <div style="text-align: center; margin-bottom: 1rem;">
                                        <div style="width: 120px; height: 80px; border: 2px dashed #f39c12; border-radius: 8px; margin: 0 auto; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; background: #fef9e7;" onclick="document.getElementById('imagen_rota').click()">
                                            <div style="text-align: center; color: #f39c12;">
                                                <div style="font-size: 24px; margin-bottom: 4px;">üìÅ</div>
                                                <div style="font-size: 11px; font-weight: 600;">SUBIR ARCHIVO</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <input type="file" class="form-control" id="imagen_rota" name="imagen_rota" 
                                           accept="image/*" style="display: none;">
                                    
                                    <div style="margin-top: 1rem;">
                                        <label style="color: #7B68EE; font-weight: 600; font-size: 12px; text-transform: uppercase; margin-bottom: 0.5rem; display: block;">
                                            Localizaci√≥n
                                        </label>
                                        <input type="text" class="form-control" placeholder="Guardar en..."
                                               style="border: 1px solid #ddd; border-radius: 5px; font-size: 13px; padding: 8px;" readonly value="Galer√≠a de bajas">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer del modal -->
                <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 1.5rem; border: none; justify-content: center; gap: 1rem;">
                    <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background: #4285F4; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px; min-width: 120px; transition: all 0.3s ease;">
                        CANCELAR
                    </button>
                    <button type="submit" class="btn"
                            style="background: #ff6b35; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px; min-width: 120px; transition: all 0.3s ease;">
                        CONFIRMAR
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Baja Espec√≠fico para Programas -->
<div class="modal fade" id="bajaProgramaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #4ECDC4, #44A08D); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    DAR DE BAJA AL PROGRAMA SELECCIONADO:
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <form method="POST" action="{% url 'baja_programa' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body" style="padding: 0; background: #f8f9fa;">
                    <input type="hidden" id="programa_id_baja" name="programa_id">
                    
                    <!-- Informaci√≥n del programa -->
                    <div style="background: linear-gradient(135deg, #e8f4f8, #f0f8ff); padding: 1.5rem; border-bottom: 2px solid #4ECDC4;">
                        <div class="row align-items-center">
                            <div class="col-2 text-center">
                                <div style="width: 80px; height: 100px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; margin: 0 auto; position: relative; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
                                    üìö
                                </div>
                            </div>
                            <div class="col-10">
                                <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                    <tr style="border-bottom: 1px solid #ddd;">
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%; text-align: center;">ID</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 25%;">Materia</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 20%;">Profesor</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%;">Carrera</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 10%; text-align: center;">Ciclo</td>
                                        <td style="padding: 8px 12px; font-weight: 600; background: #ecf0f1; width: 15%; text-align: center;">Sede</td>
                                    </tr>
                                    <tr style="background: rgba(78, 205, 196, 0.1);">
                                        <td style="padding: 12px 12px; text-align: center; font-weight: 600;" id="modal_programa_id">1</td>
                                        <td style="padding: 12px 12px; font-weight: 600; color: #2c3e50;" id="modal_programa_materia">Materia del programa</td>
                                        <td style="padding: 12px 12px;" id="modal_programa_profesor">Profesor</td>
                                        <td style="padding: 12px 12px;" id="modal_programa_carrera">Carrera</td>
                                        <td style="padding: 12px 12px; text-align: center;" id="modal_programa_ciclo">2024</td>
                                        <td style="padding: 12px 12px; text-align: center;" id="modal_programa_sede">LA PLATA</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de formulario -->
                    <div style="padding: 1.5rem;">
                        <div class="row">
                            <!-- Motivo de baja -->
                            <div class="col-md-6">
                                <div style="background: white; padding: 1.5rem; border-radius: 10px; border: 2px solid #4ECDC4; height: 100%;">
                                    <h6 style="color: #4ECDC4; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                                        Motivo de baja*
                                    </h6>
                                    <textarea class="form-control" id="motivo_baja_programa" name="motivo_baja" 
                                              rows="6" required placeholder="Describe el motivo de la baja del programa..."
                                              style="border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: none; padding: 12px;"></textarea>
                                </div>
                            </div>

                            <!-- Cargar imagen -->
                            <div class="col-md-6">
                                <div style="background: white; padding: 1.5rem; border-radius: 10px; border: 2px solid #f39c12; height: 100%;">
                                    <h6 style="color: #f39c12; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                                        Cargar imagen de baja
                                    </h6>
                                    
                                    <div style="text-align: center; margin-bottom: 1rem;">
                                        <div style="width: 120px; height: 80px; border: 2px dashed #f39c12; border-radius: 8px; margin: 0 auto; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; background: #fef9e7;" onclick="document.getElementById('imagen_rota_programa').click()">
                                            <div style="text-align: center; color: #f39c12;">
                                                <div style="font-size: 24px; margin-bottom: 4px;">üìÅ</div>
                                                <div style="font-size: 11px; font-weight: 600;">SUBIR ARCHIVO</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <input type="file" class="form-control" id="imagen_rota_programa" name="imagen_rota" 
                                           accept="image/*" style="display: none;">
                                    
                                    <div style="margin-top: 1rem;">
                                        <label style="color: #7B68EE; font-weight: 600; font-size: 12px; text-transform: uppercase; margin-bottom: 0.5rem; display: block;">
                                            Localizaci√≥n
                                        </label>
                                        <input type="text" class="form-control" placeholder="Guardar en..."
                                               style="border: 1px solid #ddd; border-radius: 5px; font-size: 13px; padding: 8px;" readonly value="Galer√≠a de bajas">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer del modal -->
                <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 1.5rem; border: none; justify-content: center; gap: 1rem;">
                    <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background: #4285F4; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px; min-width: 120px; transition: all 0.3s ease;">
                        CANCELAR
                    </button>
                    <button type="submit" class="btn"
                            style="background: #ff6b35; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px; min-width: 120px; transition: all 0.3s ease;">
                        CONFIRMAR
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Ver Informe -->
<div class="modal fade" id="verInformeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üìã INFORME DE BAJA DEL MATERIAL
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa;">
                <!-- Informaci√≥n del libro dado de baja -->
                <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 5px solid #dc3545;">
                    <div class="row">
                        <div class="col-3 text-center">
                            <div style="width: 100px; height: 130px; background: #ddd; border-radius: 8px; margin: 0 auto; position: relative; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                <img id="informe_imagen" src="" alt="Libro" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                <div id="informe_placeholder" style="width: 100%; height: 100%; background: #bdc3c7; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center;">
                                    Sin<br>Imagen
                                </div>
                            </div>
                        </div>
                        <div class="col-9">
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600; width: 30%;">N¬∞ Inventario:</td>
                                    <td style="padding: 8px 0;" id="informe_num_inventario">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">T√≠tulo:</td>
                                    <td style="padding: 8px 0; font-weight: 600; color: #dc3545;" id="informe_titulo">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Autor:</td>
                                    <td style="padding: 8px 0;" id="informe_autor">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">CDU:</td>
                                    <td style="padding: 8px 0;" id="informe_cdu">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Siglas:</td>
                                    <td style="padding: 8px 0;" id="informe_siglas">-</td>
                                </tr>
                                <tr>
                            <td style="padding: 8px 0; font-weight: 600;">Fecha de baja:</td>
                            <td style="padding: 8px 0; color: #dc3545;" id="informe_fecha_baja">Cargando...</td>
                        </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Motivo de baja -->
                <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                    <h6 style="color: #dc3545; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                        Motivo de la baja
                    </h6>
                    <div id="informe_motivo" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #dc3545; font-size: 14px; line-height: 1.5;">
                        Cargando motivo de baja...
                    </div>
                </div>

                <!-- Imagen de la baja (si existe) -->
                <div id="imagen_baja_container" style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; display: none;">
                    <h6 style="color: #dc3545; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                        Imagen de la baja
                    </h6>
                    <div style="text-align: center;">
                        <img id="imagen_baja" src="" alt="Imagen de baja" style="max-width: 300px; max-height: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center; gap: 1rem;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
                <button type="button" id="btnDarDeAlta" class="btn"
                        style="background: #28a745; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    üîÑ DAR DE ALTA
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Ver Informe Espec√≠fico para Programas -->
<div class="modal fade" id="informeBajaProgramaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <!-- Header del modal -->
            <div class="modal-header" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 1.5rem; border: none;">
                <h5 class="modal-title" style="font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; margin: 0;">
                    üìã INFORME DE BAJA DEL PROGRAMA
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8; font-size: 1.2rem;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: #f8f9fa;">
                <!-- Informaci√≥n del programa dado de baja -->
                <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; border-left: 5px solid #dc3545;">
                    <div class="row">
                        <div class="col-3 text-center">
                            <div style="width: 100px; height: 130px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; margin: 0 auto; position: relative; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px;">
                                üìö
                            </div>
                        </div>
                        <div class="col-9">
                            <table style="width: 100%; font-size: 14px; color: #2c3e50;">
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600; width: 30%;">ID Programa:</td>
                                    <td style="padding: 8px 0;" id="informe_programa_id">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Materia:</td>
                                    <td style="padding: 8px 0; font-weight: 600; color: #dc3545;" id="informe_programa_materia">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Profesor:</td>
                                    <td style="padding: 8px 0;" id="informe_programa_profesor">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Carrera:</td>
                                    <td style="padding: 8px 0;" id="informe_programa_carrera">-</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 8px 0; font-weight: 600;">Sede:</td>
                                    <td style="padding: 8px 0;" id="informe_programa_sede">-</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px 0; font-weight: 600;">Fecha de ingreso:</td>
                                    <td style="padding: 8px 0; color: #dc3545;" id="informe_programa_fecha_ingreso">Cargando...</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Motivo de baja -->
                <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                    <h6 style="color: #dc3545; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                        Motivo de la baja
                    </h6>
                    <div id="informe_programa_motivo" style="padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #dc3545; font-size: 14px; line-height: 1.5;">
                        Cargando motivo de baja...
                    </div>
                </div>

                <!-- Imagen de la baja (si existe) -->
                <div id="imagen_baja_programa_container" style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; display: none;">
                    <h6 style="color: #dc3545; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; font-size: 14px; letter-spacing: 0.5px;">
                        Imagen de la baja
                    </h6>
                    <div style="text-align: center;">
                        <img id="imagen_baja_programa" src="" alt="Imagen de baja" style="max-width: 300px; max-height: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center; gap: 1rem;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    CERRAR
                </button>
                <button type="button" id="btnDarDeAltaPrograma" class="btn"
                        style="background: #28a745; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;">
                    üîÑ DAR DE ALTA
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODAL CONFIRMAR ALTA ========== -->
<div class="modal fade" id="confirmarAltaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-dar-alta">
            <!-- Header del modal -->
            <div class="modal-header">
                <h5 class="modal-title">
                    ¬øDESEA VOLVER A PONER EL MATERIAL COMO DISPONIBLE?
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8;"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; background: white; text-align: center;">
                <div style="font-size: 48px; color: #28a745; margin-bottom: 1rem;">üìö</div>
                <p style="font-size: 16px; color: #495057; margin-bottom: 2rem; line-height: 1.5;">
                    El material <strong id="confirm_titulo_libro">t√≠tulo del material</strong> volver√° a estar disponible para pr√©stamos.
                </p>
            </div>

            <!-- Footer del modal -->
            <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center; gap: 1rem;">
                <button type="button" class="btn" data-bs-dismiss="modal" 
                        style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase;">
                    CANCELAR
                </button>
                <button type="button" id="confirmarDarAlta" class="btn"
                        style="background: #fd7e14; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase;">
                    CONFIRMAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODAL MODIFICAR DATOS ANTES DE DAR DE ALTA ========== -->
<div class="modal fade" id="modificarDatosModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content modal-dar-alta">
            <!-- Header del modal -->
            <div class="modal-header">
                <h5 class="modal-title">
                    CONFIRMAR DAR DE ALTA EL MATERIAL
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" 
                        style="filter: brightness(0) invert(1); opacity: 0.8;"></button>
            </div>

            <form id="formDarAlta" method="POST" action="{% url 'dar_alta_libro' %}">
                {% csrf_token %}
                <div class="modal-body" style="padding: 2rem; background: white;">
                    <input type="hidden" id="alta_libro_id" name="libro_id">
                    
                    <div class="row">
                        <!-- Sede -->
                        <div class="col-md-6">
                            <div class="form-group-custom">
                                <label for="alta_sede">Sede*</label>
                                <select class="form-control-custom select-custom" id="alta_sede" name="sede" required>
                                    <option value="LA PLATA" selected>LA PLATA</option>
                                    <option value="BERISSO">BERISSO</option>
                                    <option value="ENSENADA">ENSENADA</option>
                                </select>
                            </div>
                        </div>

                        <!-- Disponibilidad -->
                        <div class="col-md-6">
                            <div class="form-group-custom">
                                <label for="alta_disponibilidad">Disponibilidad*</label>
                                <select class="form-control-custom select-custom" id="alta_disponibilidad" name="disponibilidad" required>
                                    <option value="Domicilio" selected>Domicilio</option>
                                    <option value="Aula">Aula</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div class="form-group-custom">
                        <label for="alta_observaciones">Observaciones</label>
                        <textarea class="form-control-custom" id="alta_observaciones" name="observaciones" 
                                  rows="3" placeholder="Observaciones adicionales sobre la reactivaci√≥n del material..."></textarea>
                    </div>
                </div>

                <!-- Footer del modal -->
                <div class="modal-footer" style="background: #f8f9fa; padding: 1rem 2rem; border: none; justify-content: center; gap: 1rem;">
                    <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background: #6c757d; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase;">
                        CANCELAR
                    </button>
                    <button type="submit" class="btn"
                            style="background: #28a745; color: white; border: none; padding: 10px 30px; border-radius: 25px; font-weight: 600; text-transform: uppercase;">
                        CONFIRMAR
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ========== MODAL √âXITO ========== -->
<div class="modal fade" id="exitoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-dar-alta">
            <div class="modal-body" style="padding: 3rem; background: white; text-align: center;">
                <div style="font-size: 64px; color: #28a745; margin-bottom: 1rem;">‚úÖ</div>
                <h5 style="color: #28a745; font-weight: 700; margin-bottom: 1rem; text-transform: uppercase;">
                    EL ALTA DEL MATERIAL<br>
                    HA CONCLUIDO CON √âXITO
                </h5>
            </div>
            
            <div class="modal-footer" style="background: white; border: none; justify-content: center; padding-bottom: 2rem;">
                <button type="button" class="btn" data-bs-dismiss="modal" onclick="location.reload()"
                        style="background: #28a745; color: white; border: none; padding: 12px 40px; border-radius: 25px; font-weight: 600; text-transform: uppercase;">
                    ACEPTAR
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Incluir el modal del manual -->
{% include 'modals/manual_modal.html' %}

{% endblock %}