{% extends 'components/baseb.html' %}
{% load static %}

{% block title %}Editar Programa | Biblioteca Digital{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/modificacion_material.css' %}">
<link rel="stylesheet" href="{% static 'css/style_form.css' %}">
<link rel="stylesheet" href="{% static 'css/manual_modal.css' %}">
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/botones.css' %}">
<style>
    .page-header {
        background: linear-gradient(135deg, #e8f4f8, #f0f8ff);
        padding: 2rem 0;
        text-align: center;
        border-bottom: 1px solid #e0e6ed;
        background-image: 
            radial-gradient(circle at 20% 50%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(123, 104, 238, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 40% 80%, rgba(78, 205, 196, 0.05) 0%, transparent 50%);
        background-size: 400px 400px, 300px 300px, 500px 500px;
        background-position: 0% 50%, 100% 0%, 50% 100%;
        background-repeat: no-repeat;
    }

    .page-title {
        color: #4ECDC4;
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
        color: #7B68EE;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 0 2rem;
    }

    .form-card {
        background: white;
        padding: 3rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #e0e6ed;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.8rem;
        font-size: 14px;
    }

    .required::after {
        content: " *";
        color: #e53e3e;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
        color: #2d3748;
        box-sizing: border-box;
        min-height: 48px;
        font-family: inherit;
    }

    /* Asegurar que todos los inputs tengan exactamente el mismo tama√±o */
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="number"],
    .form-group input[type="url"],
    .form-group select {
        height: 48px;
        line-height: 1.4;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #4ECDC4;
        box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
    }

    .form-group textarea {
        height: 48px;
        min-height: 48px;
        resize: vertical;
        line-height: 1.4;
        font-family: inherit;
        overflow-y: auto;
    }

    .textarea-large {
        height: 48px;
        min-height: 48px;
    }

    /* Secci√≥n de imagen */
    .image-section {
        grid-column: 1 / -1;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 2rem;
        align-items: start;
        background: #f8fafc;
        padding: 2rem;
        border-radius: 8px;
        border: 1px solid #e0e6ed;
        margin-top: 1rem;
    }

    .image-upload {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .upload-container {
        display: flex;
        gap: 1rem;
        align-items: stretch;
    }

    .upload-button {
        background: #4ECDC4;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        min-width: 150px;
        font-size: 14px;
    }

    .upload-button:hover {
        background: #44C3B8;
        transform: translateY(-2px);
    }

    .url-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        font-size: 14px;
        background: white;
    }

    .url-input:focus {
        outline: none;
        border-color: #4ECDC4;
        box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
    }

    .image-preview {
        text-align: center;
    }

    .image-preview img {
        max-width: 120px;
        max-height: 160px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: 2px solid #e0e6ed;
    }

    /* Botones de acci√≥n */
    .action-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid #e0e6ed;
    }

    .btn {
        display: inline-block;
        font-family: 'Roboto', sans-serif;
        cursor: pointer;
        border: none;
        outline: none;
    }

    .btn-guardar {
        background: #4363FF; /* fondo azul mejorado */
        color: #ffffff;      /* texto blanco */
        border: 2px solid #000000; /* reborde negro */
        border-radius: 12px; /* redondeado mejorado */
        padding: 10px 24px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .btn-guardar:hover {
        background: #3A56E8;
        color: #ffffff;
        text-decoration: none;
    }

    .btn-cancelar {
        background: none;
        color: #d93025; /* color rojo mejorado */
        border: none;
        padding: 0; /* texto simple */
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .btn-cancelar:hover {
        background: none;
        color: #b52d20;
        text-decoration: none;
    }

    /* Salvaguarda de especificidad para evitar conflictos con CSS globales */
    .action-buttons .btn-guardar {
        background: #4363FF !important;
        color: #ffffff !important;
        border: 2px solid #000000 !important;
        border-radius: 12px !important;
    }
    .action-buttons .btn-cancelar {
        color: #d93025 !important;
        background: none !important;
        border: none !important;
        padding: 0 !important;
    }

    /* Modal de confirmaci√≥n */
    .modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .modal-header {
        background: #4ECDC4;
        color: white;
        padding: 1.5rem;
        text-align: center;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .modal-body {
        padding: 2rem;
    }

    .modal-footer {
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        background: #f8fafc;
        border-top: 1px solid #e0e6ed;
    }

    /* Media queries */
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-card {
            padding: 2rem;
        }
        
        .image-section {
            grid-template-columns: 1fr;
        }
        
        .image-preview {
            margin-top: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <!-- Formulario principal usando Django Form -->
    <div class="form-card">
        <form id="editFormPrograma" method="post" enctype="multipart/form-data" action="{% url 'editar_programa' programa.id_programa %}" class="form-grid">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.carrera.id_for_label }}" class="required">Carrera</label>
                {{ form.carrera }}
            </div>
            
            <div class="form-group">
                <label for="{{ form.materia.id_for_label }}" class="required">Materia</label>
                {{ form.materia }}
            </div>
            
            <div class="form-group">
                <label for="{{ form.profesor.id_for_label }}" class="required">Profesor/a</label>
                {{ form.profesor }}
            </div>
            
            <div class="form-group">
                <label for="{{ form.ciclo_lectivo.id_for_label }}" class="required">Ciclo Lectivo</label>
                {{ form.ciclo_lectivo }}
            </div>
            
            <div class="form-group">
                <label for="{{ form.ingresar_enlace.id_for_label }}">Enlace (URL)</label>
                {{ form.ingresar_enlace }}
            </div>

            <!-- Botones de acci√≥n -->
            <div class="action-buttons">
                <div></div>
                <div style="display: flex; gap: 2rem; align-items: center;">
                    <a href="{% url 'modificacion_materiales' %}" class="btn btn-cancelar">
                        CANCELAR
                    </a>
                    <button type="button" class="btn btn-guardar" onclick="mostrarModalConfirmacion()">
                        GUARDAR
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmaci√≥n -->
<div class="modal fade" id="confirmacionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 8px; border: none;">
            <div class="modal-body text-center" style="padding: 2rem;">
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="color: #2c3e50; font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem;">
                        ¬øDESEA CONFIRMAR LOS CAMBIOS REALIZADOS?
                    </h5>
                    <p style="color: #666; font-size: 0.9rem; margin: 0;">
                        Pulse un bot√≥n para continuar. Una vez aceptado, los datos ser√°n guardados en la base de datos.
                    </p>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button type="button" class="btn" data-bs-dismiss="modal"
                            style="background: #4285F4; color: white; border: none; padding: 10px 24px; border-radius: 4px; font-weight: 500; text-transform: uppercase; cursor: pointer;">
                        CANCELAR
                    </button>
                    <button type="button" class="btn" onclick="confirmarGuardado()"
                            style="background: #ff6b35; color: white; border: none; padding: 10px 24px; border-radius: 4px; font-weight: 500; text-transform: uppercase; cursor: pointer;">
                        CONFIRMAR
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<!-- Script para manejar la dependencia entre carrera y materia -->
<script>
    function mostrarModalConfirmacion() {
        const modal = new bootstrap.Modal(document.getElementById('confirmacionModal'));
        modal.show();
    }
    function confirmarGuardado() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('confirmacionModal'));
        if (modal) modal.hide();
        document.getElementById('editFormPrograma').submit();
    }
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ Editar programa cargado');
        
        const carreraSelect = document.getElementById('id_carrera');
        const materiaSelect = document.getElementById('id_materia');
        
        // Verificar que los elementos existen
        if (!carreraSelect || !materiaSelect) {
            console.log('‚ö†Ô∏è No se encontraron elementos necesarios para editar programa');
            return;
        }
        
        // Guardar los valores iniciales (para preservar la materia seleccionada al editar)
        const carreraInicial = carreraSelect.value;
        // Obtener la materia inicial desde el objeto programa de Django
        const materiaInicial = '{{ programa.materia|escapejs }}';
        
        console.log('üìã Valores iniciales:', { carreraInicial, materiaInicial });
        
        // Definir las materias por carrera (COMPLETO - copiado de alta_programa)
        const materiasPorCarrera = {
            'Profesorado de Educaci√≥n Inicial': [
                "An√°lisis del Mundo Contempor√°neo",
                "Ateneo de Naturaleza y Sociedad",
                "Ateneo de Matem√°tica",
                "Ateneo de Nuevas Expresiones Est√©ticas",
                "Ateneo de Pr√°cticas del Lenguaje y la Literatura",
                "Corporeidad y Motricidad",
                "Cultura, Comunicaci√≥n y Educaci√≥n",
                "Did√°ctica de la Matem√°tica",
                "Did√°ctica de las Ciencias Naturales",
                "Did√°ctica de las Ciencias Sociales",
                "Did√°ctica de las Pr√°cticas del Lenguaje y la Literatura",
                "Did√°ctica General",
                "Did√°ctica y Curriculum de Nivel Inicial",
                "Dimensi√≥n √âtico-Pol√≠tica de la Praxis Docente",
                "Educaci√≥n en y para la Salud",
                "Educaci√≥n F√≠sica Escolar",
                "Educaci√≥n Musical",
                "Educaci√≥n Pl√°stica",
                "Educaci√≥n Temprana",
                "Filosof√≠a",
                "Historia y Prospectiva de la Educaci√≥n",
                "Juego y Desarrollo Infantil",
                "Medios Audiovisuales, TICs y Educaci√≥n",
                "Pedagog√≠a",
                "Pol√≠tica, Legislaci√≥n y Administraci√≥n del Trabajo Escolar",
                "Pr√°ctica Docente 1",
                "Pr√°ctica Docente 2",
                "Pr√°ctica Docente 3",
                "Pr√°ctica Docente 4",
                "Psicolog√≠a del Desarrollo y el Aprendizaje 1",
                "Psicolog√≠a del Desarrollo y el Aprendizaje 2",
                "Psicolog√≠a Social e Institucional",
                "Reflexi√≥n Filos√≥fica de la Educaci√≥n",
                "Taller de Ciencias Naturales",
                "Taller de Ciencias Sociales",
                "Taller de Definici√≥n Institucional",
                "Taller de Lectura, Escritura y Oralidad (LEO)",
                "Taller de Literatura Infantil",
                "Taller de la Matem√°tica",
                "Taller de Materiales y Objetos L√∫dicos",
                "Taller de Pensamiento L√≥gico Matem√°tico",
                "Teor√≠as Sociopol√≠ticas y Educaci√≥n",
                "Trayectos Formativos Opcionales"
            ],
            'Profesorado de Educaci√≥n Primaria': [
                "An√°lisis del Mundo Contempor√°neo",
                "Arte y Educaci√≥n",
                "Ateneo de Ciencias Naturales",
                "Ateneo de Ciencias Sociales",
                "Ateneo de Matem√°tica",
                "Ateneo de Pr√°cticas del Lenguaje y la Literatura",
                "Configuraciones Culturales del Sujeto Educativo de Primaria",
                "Corporeidad y Motricidad",
                "Cultura, Comunicaci√≥n y Educaci√≥n",
                "Did√°ctica de la Matem√°tica 1",
                "Did√°ctica de la Matem√°tica 2",
                "Did√°ctica de las Ciencias Naturales 1",
                "Did√°ctica de las Ciencias Naturales 2",
                "Did√°ctica de las Ciencias Sociales 1",
                "Did√°ctica de las Ciencias Sociales 2",
                "Did√°ctica de Pr√°cticas del Lenguaje y la Literatura 1",
                "Did√°ctica de Pr√°cticas del Lenguaje y la Literatura 2",
                "Did√°ctica General",
                "Did√°ctica y Curriculum de Nivel Primario",
                "Dimensi√≥n √âtico-Pol√≠tica de la Praxis Docente",
                "Educaci√≥n Art√≠stica",
                "Educaci√≥n F√≠sica Escolar",
                "Filosof√≠a",
                "Historia y Prospectiva de la Educaci√≥n",
                "Medios Audiovisuales, TICs y Educaci√≥n",
                "Pedagog√≠a",
                "Pedagog√≠a Cr√≠tica de las Diferencias",
                "Pol√≠tica, Legislaci√≥n y Administraci√≥n del Trabajo Escolar",
                "Pr√°ctica Docente 1",
                "Pr√°ctica Docente 2",
                "Pr√°ctica Docente 3",
                "Pr√°ctica Docente 4",
                "Psicolog√≠a del Desarrollo y el Aprendizaje 1",
                "Psicolog√≠a del Desarrollo y el Aprendizaje 2",
                "Psicolog√≠a Social e Institucional",
                "Reflexi√≥n Filos√≥fica de la Educaci√≥n",
                "Taller de Definici√≥n Institucional",
                "Taller de Lectura, Escritura y Oralidad (LEO)",
                "Taller de Pensamiento L√≥gico Matem√°tico",
                "Teor√≠as Sociopol√≠ticas y Educaci√≥n",
                "Trayectos Formativos Opcionales"
            ],
            'Profesorado de Educaci√≥n Secundaria en Geograf√≠a': [
                "Antropolog√≠a",
                "Cartograf√≠a",
                "Cartograf√≠a Digital",
                "Cultura Digital y Educaci√≥n",
                "Derechos, Interculturalidad y Ciudadan√≠a",
                "Did√°ctica de la Geograf√≠a",
                "Did√°ctica de las Ciencias Sociales",
                "Did√°ctica y Curriculum",
                "Econom√≠a Pol√≠tica",
                "Educaci√≥n Sexual Integral (ESI)",
                "Educaci√≥n y Transformaciones Sociales Contempor√°neas",
                "Ense√±anza de la Geograf√≠a",
                "Espacio de Opci√≥n Institucional (EOI)",
                "Geograf√≠a Ambiental",
                "Geograf√≠a Ambiental de Am√©rica Latina",
                "Geograf√≠a Ambiental de Argentina",
                "Geograf√≠a Cultural",
                "Geograf√≠a de G√©nero",
                "Geograf√≠a Econ√≥mica y Social Argentina",
                "Geograf√≠a Pol√≠tica y Geopol√≠tica",
                "Geograf√≠a Rural",
                "Geograf√≠a Social",
                "Geograf√≠a Social de Am√©rica Latina",
                "Geograf√≠a Urbana",
                "Historia de los Modelos Econ√≥micos de Argentina",
                "Historia Social General",
                "Introducci√≥n a las Ciencias Sociales y a la Geograf√≠a",
                "Organizaci√≥n Econ√≥mica del Espacio",
                "Pedagog√≠a",
                "Pr√°ctica Docente 1",
                "Pr√°ctica Docente 2",
                "Pr√°ctica Docente 3",
                "Pr√°ctica Docente 4",
                "Problemas Ambientales Locales/Regionales: La Investigaci√≥n en el Aula",
                "Problemas Filos√≥ficos de la Educaci√≥n",
                "Pol√≠tica Educativa Argentina",
                "Psicolog√≠a del Aprendizaje",
                "Reflexi√≥n Filos√≥fico-Pol√≠tica de la Pr√°ctica Docente",
                "Sociolog√≠a",
                "Teor√≠a y Metodolog√≠a en Geograf√≠a",
                "Trayectorias Educativas de J√≥venes y Adultos",
                "Unidades Curriculares Optativas"
            ],
            'Profesorado de Educaci√≥n Secundaria en Ciencias Pol√≠ticas': [
                "An√°lisis de las Instituciones Educativas",
                "Antropolog√≠a",
                "Cultura Digital y Educaci√≥n",
                "Derecho",
                "Derechos Humanos y Ciudadan√≠a",
                "Derechos, Interculturalidad y Ciudadan√≠a",
                "Did√°ctica de la Ciencia Pol√≠tica",
                "Did√°ctica de las Ciencias Sociales",
                "Did√°ctica y Curriculum",
                "Econom√≠a Pol√≠tica",
                "Educaci√≥n y Transformaciones Sociales Contempor√°neas",
                "Educaci√≥n Sexual Integral (ESI)",
                "Espacio de Opci√≥n Institucional (EOI)",
                "Estado, Administraci√≥n y Pol√≠ticas P√∫blicas",
                "Estado y Pol√≠tica de G√©nero",
                "Fundamentos de Ciencia Pol√≠tica",
                "Geograf√≠a",
                "Historia Argentina",
                "Historia Latinoamericana",
                "Historia Mundial",
                "Investigaci√≥n en la Ense√±anza de la Ciencia Pol√≠tica",
                "Opini√≥n P√∫blica, Medios y Pol√≠tica",
                "Pedagog√≠a",
                "Pensamiento Pol√≠tico Pedag√≥gico Latinoamericano",
                "Pol√≠tica Educativa Argentina",
                "Pr√°ctica Docente 1",
                "Pr√°ctica Docente 2",
                "Pr√°ctica Docente 3",
                "Pr√°ctica Docente 4",
                "Problemas Filos√≥ficos de la Educaci√≥n",
                "Problem√°tica y Pol√≠tica Ambiental",
                "Psicolog√≠a del Aprendizaje",
                "Reflexi√≥n Filos√≥fico-Pol√≠tica de la Pr√°ctica Docente",
                "Sistemas Pol√≠ticos Comparados",
                "Sociolog√≠a",
                "Teor√≠a de las Relaciones Internacionales y Pol√≠tica Internacional",
                "Teor√≠a Pol√≠tica 1",
                "Teor√≠a Pol√≠tica 2",
                "Teor√≠a Pol√≠tica 3",
                "Teor√≠a y Derecho Constitucional",
                "Unidades Curriculares Optativas"
            ],
            'Tecnicatura Superior en An√°lisis de Sistemas': [
                "√Ålgebra",
                "Algoritmos y estructuras de datos 1",
                "Algoritmos y estructuras de datos 2",
                "Algoritmos y estructuras de datos 3",
                "An√°lisis Matem√°tico 1",
                "An√°lisis Matem√°tico 2",
                "Arquitectura de Computadores",
                "Aspectos legales de la Profesi√≥n",
                "Base de Datos",
                "Ciencia, Tecnolog√≠a y Sociedad",
                "Estad√≠stica",
                "Ingenier√≠a de Software 1",
                "Ingenier√≠a de Software 2",
                "Ingl√©s 1",
                "Ingl√©s 2",
                "Ingl√©s 3",
                "Pr√°cticas Profesionalizantes 1",
                "Pr√°cticas Profesionalizantes 2",
                "Pr√°cticas Profesionalizantes 3",
                "Redes y Comunicaciones",
                "Seminario de actualizaci√≥n",
                "Sistemas Operativos",
                "Sistemas y Organizaciones"
            ],
            'Tecnicatura Superior en Enfermer√≠a': [
                "Aspectos Bio√©ticos y Legales de la Profesi√≥n",
                "Biolog√≠a Humana",
                "Comunicaci√≥n en Ciencias de la Salud",
                "Condiciones y Medio Ambiente del Trabajo",
                "Cuidados de la Salud Centrados en la Comunidad y la Familia",
                "Enfermer√≠a Comunitaria y Pr√°cticas Educativas en Salud",
                "Enfermer√≠a del Adulto y del Adulto Mayor I",
                "Enfermer√≠a del Adulto y el Adulto Mayor II",
                "Enfermer√≠a en Emergencias y Cat√°strofes",
                "Enfermer√≠a en Salud Mental",
                "Enfermer√≠a Materno Infantil",
                "Farmacolog√≠a en Enfermer√≠a",
                "Fundamentos del Cuidado",
                "Ingl√©s",
                "Introducci√≥n a la Metodolog√≠a de Investigaci√≥n en Salud",
                "Nutrici√≥n y Dietoterapia",
                "Organizaci√≥n y Gesti√≥n de Servicios de Enfermer√≠a",
                "Pr√°cticas Profesionalizantes 1",
                "Pr√°cticas Profesionalizantes 2",
                "Pr√°cticas Profesionalizantes 3",
                "Psicolog√≠a",
                "Salud P√∫blica 1",
                "Salud P√∫blica 2",
                "Teor√≠as Socioculturales de la Salud"
            ],
            'Tecnicatura Superior en Acompa√±amiento Terap√©utico': [
                "Acompa√±amiento Terap√©utico del Adulto y Adulto Mayor",
                "Acompa√±amiento Terap√©utico en la Ni√±ez y Adolescencia",
                "Acompa√±amiento Terap√©utico",
                "Contextualizaci√≥n del Campo Profesional del Acompa√±amiento Terap√©utico",
                "√âtica",
                "Fundamentos de Psicolog√≠a General y de Intervenci√≥n Sociocomunitaria",
                "Ingl√©s",
                "Intervenci√≥n Comunitaria y Recursos Sociales",
                "Investigaci√≥n en Salud",
                "Modalidades de Intervenci√≥n en el Acompa√±amiento Terap√©utico",
                "Modelo de Ocupaci√≥n Humana",
                "Organizaci√≥n y Gesti√≥n de los Servicios de Salud Mental",
                "Pr√°cticas Profesionalizantes I",
                "Pr√°cticas Profesionalizantes II",
                "Pr√°cticas Profesionalizantes III",
                "Principios M√©dicos y de Psicofarmacolog√≠a",
                "Psicofarmacolog√≠a",
                "Psicolog√≠a de los Ciclos Vitales",
                "Psicolog√≠a de Grupos",
                "Psicopatolog√≠a",
                "Salud P√∫blica y Salud Mental",
                "Sistemas Familiares"
            ],
            'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
                "Administraci√≥n de las Organizaciones",
                "Capacitaci√≥n de Personal",
                "Comunicaci√≥n y Administraci√≥n de Medios",
                "Control de la Contaminaci√≥n",
                "Derecho del Trabajo",
                "Ergonom√≠a",
                "Estad√≠stica",
                "F√≠sica 1",
                "F√≠sica 2",
                "Higiene Laboral y Medio Ambiente 1",
                "Higiene Laboral y Medio Ambiente 2",
                "Ingl√©s T√©cnico",
                "Medicina del Trabajo 1",
                "Medicina del Trabajo 2",
                "Medios de Representaci√≥n",
                "Pr√°ctica Profesionalizante 1",
                "Pr√°ctica Profesionalizante 2",
                "Pr√°ctica Profesionalizante 3",
                "Psicolog√≠a Laboral",
                "Qu√≠mica 1",
                "Qu√≠mica 2",
                "Seguridad 1",
                "Seguridad 2",
                "Seguridad 3"
            ]
        };
        
        // Funci√≥n para cargar materias (mejorada para preservar selecci√≥n al editar)
        function cargarMaterias(carreraSeleccionada, materiaASeleccionar = null) {
            console.log('üìö Carrera seleccionada:', carreraSeleccionada);
            
            // Limpiar opciones actuales
            materiaSelect.innerHTML = '';
            
            if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                // Agregar opci√≥n vac√≠a
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Seleccione una materia';
                materiaSelect.appendChild(opcionVacia);
                
                // Agregar materias de la carrera seleccionada
                materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                    const option = document.createElement('option');
                    option.value = materia;
                    option.textContent = materia;
                    materiaSelect.appendChild(option);
                });
                
                // Si se especifica una materia a seleccionar, seleccionarla
                if (materiaASeleccionar) {
                    materiaSelect.value = materiaASeleccionar;
                    console.log('‚úÖ Materia restaurada:', materiaASeleccionar);
                }
                
                materiaSelect.disabled = false;
                console.log('‚úÖ Materias cargadas:', materiasPorCarrera[carreraSeleccionada].length);
            } else {
                // No hay carrera seleccionada o no tiene materias
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Primero seleccione una carrera';
                materiaSelect.appendChild(opcionVacia);
                materiaSelect.disabled = true;
                console.log('‚ö†Ô∏è No hay materias para:', carreraSeleccionada);
            }
        }
        
        // Event listener para cambio de carrera
        carreraSelect.addEventListener('change', function() {
            cargarMaterias(this.value);
        });
        
        // Inicializaci√≥n: cargar materias si ya hay una carrera seleccionada (modo edici√≥n)
        if (carreraInicial) {
            cargarMaterias(carreraInicial, materiaInicial);
        } else {
            // Si no hay carrera inicial, deshabilitar materia
            materiaSelect.disabled = true;
        }
        
        console.log('üéØ Vinculaci√≥n carrera-materia inicializada correctamente');
    });
</script>
{% endblock %}