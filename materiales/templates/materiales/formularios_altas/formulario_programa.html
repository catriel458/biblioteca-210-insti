{% extends 'components/baseb.html' %}
{% load static %}
{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/manual_modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_form.css' %}">
    <link rel="stylesheet" href="{% static 'css/botones.css' %}">
    <style>
        .modal-lg {
            max-width: 900px;
        }

        .modal-header {
            background-color: #25898D;
            color: white;
            border-bottom: none;
        }

        .modal-header .btn-close {
            background: none;
            border: none;
            color: white;
            opacity: 0.8;
        }

        .modal-header .btn-close:hover {
            opacity: 1;
        }

        .section-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #25898D;
            margin-bottom: 15px;
        }

        .section-title {
            color: #25898D;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .tipo-material-title {
            color: #25898D;
            font-weight: bold;
            text-align: center;
            font-size: 1.2em;
        }

        .info-text {
            background-color: white;
            padding: 8px 12px;
            border-radius: 4px;
            min-height: 35px;
            margin-bottom: 0;
            border: 1px solid #e9ecef;
            word-wrap: break-word;
        }

        .modal-footer .btn-primary {
            background-color: #25898D;
            border-color: #25898D;
        }

        .modal-footer .btn-primary:hover {
            background-color: #1e7075;
            border-color: #1e7075;
        }

        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }

       #id_sede {
        padding:5px
       }

       #id_disponibilidad {
        padding:5px
       }
    </style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if success %}
        <div class="alert alert-success">{{ success }}</div>
    {% endif %}
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form id="form_alta_material" action="/alta-programa/" method="POST">
        {% csrf_token %}

        <!-- CAMPOS SIMPLIFICADOS - SOLO LOS NECESARIOS -->
        <div class="row">
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.profesor.id_for_label }}" class="text-input" style="color:#25898D;">Profesor/a:</label>
                {{ form.profesor }}
                {% if form.profesor.errors %}
                    <div class="text-danger">{{ form.profesor.errors }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.carrera.id_for_label }}" class="text-input" style="color:#25898D;">Carrera:</label>
                {{ form.carrera }}
                {% if form.carrera.errors %}
                    <div class="text-danger">{{ form.carrera.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.materia.id_for_label }}" class="text-input" style="color:#25898D;">Materia:</label>
                {{ form.materia }}
                {% if form.materia.errors %}
                    <div class="text-danger">{{ form.materia.errors }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.ciclo_lectivo.id_for_label }}" class="text-input" style="color:#25898D;">Ciclo Lectivo:</label>
                {{ form.ciclo_lectivo }}
                {% if form.ciclo_lectivo.errors %}
                    <div class="text-danger">{{ form.ciclo_lectivo.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-12 form-group mb-3">
                <label for="{{ form.ingresar_enlace.id_for_label }}" class="text-input" style="color:#25898D;">Enlace (URL):</label>
                {{ form.ingresar_enlace }}
                {% if form.ingresar_enlace.errors %}
                    <div class="text-danger">{{ form.ingresar_enlace.errors }}</div>
                {% endif %}
                <small class="form-text text-muted">Enlace al programa de la materia (opcional)</small>
            </div>
        </div>

        <!-- Botones -->
        <div class="row">
            <div class="col-12 d-flex justify-content-end gap-3">
                <button type="reset" class="btn btn-outline-danger btn-sm">Cancelar</button>
                <button type="submit" class="btn btn-primary btn-sm">Guardar</button>
            </div>
        </div>
    </form>
</div>

<!-- Modal de Confirmación de Alta de Material -->
<div class="modal fade" id="modalConfirmacionAltaMaterial" tabindex="-1" aria-labelledby="modalConfirmacionLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalConfirmacionLabel">CONFIRME LOS DATOS</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <!-- Tipo de Material -->
          <div class="section-container mb-4">
            <h6 class="tipo-material-title">TIPO DE MATERIAL: <span id="confirmTipoMaterial" class="text-primary"></span></h6>
          </div>

          <!-- Información Principal -->
          <div class="section-container mb-4">
            <h6 class="section-title">Información Principal</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <strong>Profesor/a:</strong>
                <p id="confirmProfesor" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Carrera:</strong>
                <p id="confirmCarrera" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Materia:</strong>
                <p id="confirmMateria" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Ciclo y Enlace -->
          <div class="section-container mb-4">
            <h6 class="section-title">Detalles Académicos</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <strong>Ciclo Lectivo:</strong>
                <p id="confirmCicloLectivo" class="info-text"></p>
              </div>
              <div class="col-md-6">
                <strong>Enlace (URL):</strong>
                <p id="confirmEnlace" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Descripción -->
          <div class="section-container mb-4">
            <div class="row">
              <div class="col-12">
                <strong>Descripción:</strong>
                <p id="confirmDescripcion" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Ubicación y Disponibilidad -->
          <div class="section-container mb-4">
            <h6 class="section-title">Ubicación y Disponibilidad</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <strong>Sede:</strong>
                <p id="confirmSede" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Disponibilidad:</strong>
                <p id="confirmDisponibilidad" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Ejemplar N°:</strong>
                <p id="confirmEjemplarNum" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Observaciones -->
          <div class="section-container mb-4">
            <h6 class="section-title">Observaciones</h6>
            <div class="row">
              <div class="col-12">
                <p id="confirmObservaciones" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Imagen -->
          <div class="section-container mb-4">
            <h6 class="section-title">Imagen</h6>
            <div class="row">
              <div class="col-12">
                <p id="confirmImagen" class="info-text"></p>
              </div>
            </div>
          </div>
        </div>  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnConfirmarAltaMaterial">Confirmar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- SCRIPT CON DEPENDENCIA CARRERA-MATERIA -->
<script>
// Script para el formulario de programa (paste.txt - primer template)
document.addEventListener('DOMContentLoaded', function() {
    console.log('✅ Formulario programa cargado');
    
    const form = document.getElementById('form_alta_material');
    const carreraSelect = document.getElementById('id_carrera');
    const materiaSelect = document.getElementById('id_materia');
    
    // Materias por carrera
    const materiasPorCarrera = {
        'Profesorado de Educación Inicial': [
            'Pedagogía', 'Psicología Educacional', 'Sociología de la Educación', 
            'Historia y Política de la Educación Argentina', 'Filosofía de la Educación',
            'Didáctica General', 'Curriculum y Didáctica del Nivel Inicial', 
            'Juego y Desarrollo Infantil', 'Literatura Infantil', 'Matemática y su Didáctica',
            'Ciencias Sociales y su Didáctica', 'Ciencias Naturales y su Didáctica',
            'Lengua y su Didáctica', 'Educación Artística', 'Educación Física',
            'Práctica Docente I', 'Práctica Docente II', 'Práctica Docente III', 'Práctica Docente IV'
        ],
        'Profesorado de Educación Primaria': [
            'Pedagogía', 'Psicología Educacional', 'Sociología de la Educación',
            'Historia y Política de la Educación Argentina', 'Filosofía de la Educación',
            'Didáctica General', 'Curriculum y Didáctica del Nivel Primario',
            'Matemática y su Didáctica I', 'Matemática y su Didáctica II',
            'Lengua y su Didáctica I', 'Lengua y su Didáctica II',
            'Ciencias Sociales y su Didáctica I', 'Ciencias Sociales y su Didáctica II',
            'Ciencias Naturales y su Didáctica I', 'Ciencias Naturales y su Didáctica II',
            'Educación Artística', 'Educación Física', 'Tecnologías de la Información',
            'Práctica Docente I', 'Práctica Docente II', 'Práctica Docente III', 'Práctica Docente IV'
        ],
        'Profesorado de Educación Secundaria en Geografía': [
            'Pedagogía', 'Psicología Educacional', 'Sociología de la Educación',
            'Historia y Política de la Educación Argentina', 'Filosofía de la Educación',
            'Didáctica General', 'Didáctica de la Geografía',
            'Geografía Física I', 'Geografía Física II', 'Geografía Humana I', 'Geografía Humana II',
            'Geografía de América', 'Geografía de Argentina', 'Geografía Mundial',
            'Cartografía', 'Climatología', 'Geomorfología', 'Biogeografía',
            'Geografía Económica', 'Geografía Urbana y Rural', 'Epistemología de la Geografía',
            'Práctica Docente I', 'Práctica Docente II', 'Práctica Docente III', 'Práctica Docente IV'
        ],
        'Profesorado de Educación Secundaria en Ciencias Políticas': [
            'Pedagogía', 'Psicología Educacional', 'Sociología de la Educación',
            'Historia y Política de la Educación Argentina', 'Filosofía de la Educación',
            'Didáctica General', 'Didáctica de las Ciencias Políticas',
            'Teoría Política', 'Historia del Pensamiento Político', 'Sistemas Políticos Comparados',
            'Política Argentina', 'Política Latinoamericana', 'Relaciones Internacionales',
            'Derecho Constitucional', 'Sociología Política', 'Economía Política',
            'Filosofía Política', 'Metodología de la Investigación Social',
            'Práctica Docente I', 'Práctica Docente II', 'Práctica Docente III', 'Práctica Docente IV'
        ],
        'Tecnicatura Superior en Análisis de Sistemas': [
            'Matemática', 'Inglés Técnico', 'Arquitectura de Computadoras',
            'Sistemas Operativos', 'Algoritmos y Estructuras de Datos',
            'Programación I', 'Programación II', 'Programación III',
            'Base de Datos I', 'Base de Datos II', 'Análisis de Sistemas I', 'Análisis de Sistemas II',
            'Ingeniería de Software', 'Redes y Comunicaciones', 'Seguridad Informática',
            'Desarrollo Web', 'Programación Orientada a Objetos', 'Metodologías de Desarrollo',
            'Gestión de Proyectos', 'Práctica Profesionalizante I', 'Práctica Profesionalizante II'
        ],
        'Tecnicatura Superior en Enfermería': [
            'Anatomía y Fisiología I', 'Anatomía y Fisiología II', 'Microbiología y Parasitología',
            'Farmacología', 'Patología', 'Nutrición y Dietoterapia',
            'Enfermería Básica', 'Enfermería Médica', 'Enfermería Quirúrgica',
            'Enfermería Materno Infantil', 'Enfermería Pediátrica', 'Enfermería Geriátrica',
            'Enfermería en Salud Mental', 'Enfermería Comunitaria', 'Administración en Enfermería',
            'Bioética', 'Epidemiología', 'Primeros Auxilios',
            'Práctica Profesional I', 'Práctica Profesional II', 'Práctica Profesional III'
        ],
        'Tecnicatura Superior en Acompañamiento Terapéutico': [
            'Psicología General', 'Psicopatología', 'Neurociencias', 'Desarrollo Humano',
            'Teorías y Técnicas de Acompañamiento Terapéutico', 'Comunicación Terapéutica',
            'Dinámicas Familiares', 'Integración Social', 'Recreación Terapéutica',
            'Talleres de Expresión', 'Primeros Auxilios', 'Bioética',
            'Legislación en Salud Mental', 'Trabajo Interdisciplinario',
            'Práctica Profesional I', 'Práctica Profesional II', 'Práctica Profesional III'
        ],
        'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
            'Matemática', 'Física', 'Química', 'Legislación Laboral',
            'Higiene Industrial I', 'Higiene Industrial II', 'Seguridad Industrial I', 'Seguridad Industrial II',
            'Medicina del Trabajo', 'Toxicología Laboral', 'Ergonomía',
            'Protección contra Incendios', 'Contaminación Ambiental', 'Gestión de Residuos',
            'Capacitación en Seguridad', 'Investigación de Accidentes', 'Auditorías de Seguridad',
            'Gestión de Riesgos', 'Práctica Profesional I', 'Práctica Profesional II'
        ]
    };

    // ✅ VERIFICACIÓN CRÍTICA: Solo ejecutar si estamos en la página de programa
    // Verificar si existe el campo carrera Y si es el formulario de programa
    if (form && carreraSelect && materiaSelect) {
        console.log('🎯 Inicializando funcionalidad carrera-materia para programa');
        
        // Forzar el action correcto
        form.action = '/alta-programa/';
        console.log('🔧 Action corregido a:', form.action);
        
        // FUNCIÓN para cargar materias
        function cargarMaterias(carreraSeleccionada) {
            console.log('📚 Carrera seleccionada:', carreraSeleccionada);
            
            // Limpiar opciones de materia
            materiaSelect.innerHTML = '';
            
            if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                // Agregar opción vacía
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Seleccione una materia';
                materiaSelect.appendChild(opcionVacia);
                
                // Agregar materias de la carrera seleccionada
                materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                    const option = document.createElement('option');
                    option.value = materia;
                    option.textContent = materia;
                    materiaSelect.appendChild(option);
                });
                
                materiaSelect.disabled = false;
                console.log('✅ Materias cargadas:', materiasPorCarrera[carreraSeleccionada].length);
            } else {
                // No hay carrera seleccionada o no tiene materias
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Primero seleccione una carrera';
                materiaSelect.appendChild(opcionVacia);
                materiaSelect.disabled = true;
                console.log('⚠️ No hay materias para:', carreraSeleccionada);
            }
        }
        
        // Event listener para cambio de carrera
        carreraSelect.addEventListener('change', function() {
            cargarMaterias(this.value);
        });
        
        // Inicializar estado de materia
        materiaSelect.disabled = true;
        
        // Si ya hay una carrera seleccionada al cargar (por ejemplo, por validación de errores)
        if (carreraSelect.value) {
            cargarMaterias(carreraSelect.value);
        }
        
        // Verificar cuando se envía
        form.addEventListener('submit', function(e) {
            console.log('🚀 PROGRAMA enviándose a:', form.action);
            console.log('🚀 Method:', form.method);
        });
        
    } else {
        console.log('⚠️ No se encontraron elementos necesarios para programa');
        console.log('Form:', !!form, 'Carrera:', !!carreraSelect, 'Materia:', !!materiaSelect);
    }
});
</script>
{% endblock %}