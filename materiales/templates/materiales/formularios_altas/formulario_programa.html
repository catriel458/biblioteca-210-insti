{% extends 'components/baseb.html' %}
{% load static %}
{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/manual_modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_form.css' %}">
    <link rel="stylesheet" href="{% static 'css/botones.css' %}">
    <style>
        .modal-lg {
            max-width: 900px;
        }

        .modal-header {
            background-color: #25898D;
            color: white;
            border-bottom: none;
        }

        .modal-header .btn-close {
            background: none;
            border: none;
            color: white;
            opacity: 0.8;
        }

        .modal-header .btn-close:hover {
            opacity: 1;
        }

        .section-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #25898D;
            margin-bottom: 15px;
        }

        .section-title {
            color: #25898D;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .tipo-material-title {
            color: #25898D;
            font-weight: bold;
            text-align: center;
            font-size: 1.2em;
        }

        .info-text {
            background-color: white;
            padding: 8px 12px;
            border-radius: 4px;
            min-height: 35px;
            margin-bottom: 0;
            border: 1px solid #e9ecef;
            word-wrap: break-word;
        }

        .modal-footer .btn-primary {
            background-color: #25898D;
            border-color: #25898D;
        }

        .modal-footer .btn-primary:hover {
            background-color: #1e7075;
            border-color: #1e7075;
        }

        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }

       #id_sede {
        padding:5px
       }

       #id_disponibilidad {
        padding:5px
       }
    </style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if success %}
        <div class="alert alert-success">{{ success }}</div>
    {% endif %}
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form id="form_alta_material" action="/alta-programa/" method="POST">
        {% csrf_token %}

        <!-- CAMPOS SIMPLIFICADOS - SOLO LOS NECESARIOS -->
        <div class="row">
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.profesor.id_for_label }}" class="text-input" style="color:#25898D;">Profesor/a:</label>
                {{ form.profesor }}
                {% if form.profesor.errors %}
                    <div class="text-danger">{{ form.profesor.errors }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.carrera.id_for_label }}" class="text-input" style="color:#25898D;">Carrera:</label>
                {{ form.carrera }}
                {% if form.carrera.errors %}
                    <div class="text-danger">{{ form.carrera.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.materia.id_for_label }}" class="text-input" style="color:#25898D;">Materia:</label>
                {{ form.materia }}
                {% if form.materia.errors %}
                    <div class="text-danger">{{ form.materia.errors }}</div>
                {% endif %}
            </div>
            <div class="col-12 col-sm-6 form-group mb-3">
                <label for="{{ form.ciclo_lectivo.id_for_label }}" class="text-input" style="color:#25898D;">Ciclo Lectivo:</label>
                {{ form.ciclo_lectivo }}
                {% if form.ciclo_lectivo.errors %}
                    <div class="text-danger">{{ form.ciclo_lectivo.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-12 form-group mb-3">
                <label for="{{ form.ingresar_enlace.id_for_label }}" class="text-input" style="color:#25898D;">Enlace (URL):</label>
                {{ form.ingresar_enlace }}
                {% if form.ingresar_enlace.errors %}
                    <div class="text-danger">{{ form.ingresar_enlace.errors }}</div>
                {% endif %}
                <small class="form-text text-muted">Enlace al programa de la materia (opcional)</small>
            </div>
        </div>

        <!-- Botones -->
        <div class="row">
            <div class="col-12 d-flex justify-content-end gap-3">
                <button type="reset" class="btn btn-outline-danger btn-sm">Cancelar</button>
                <button type="submit" class="btn btn-primary btn-sm">Guardar</button>
            </div>
        </div>
    </form>
</div>

<!-- Modal de Confirmaci√≥n de Alta de Material -->
<div class="modal fade" id="modalConfirmacionAltaMaterial" tabindex="-1" aria-labelledby="modalConfirmacionLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalConfirmacionLabel">CONFIRME LOS DATOS</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <!-- Tipo de Material -->
          <div class="section-container mb-4">
            <h6 class="tipo-material-title">TIPO DE MATERIAL: <span id="confirmTipoMaterial" class="text-primary"></span></h6>
          </div>

          <!-- Informaci√≥n Principal -->
          <div class="section-container mb-4">
            <h6 class="section-title">Informaci√≥n Principal</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <strong>Profesor/a:</strong>
                <p id="confirmProfesor" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Carrera:</strong>
                <p id="confirmCarrera" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Materia:</strong>
                <p id="confirmMateria" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Ciclo y Enlace -->
          <div class="section-container mb-4">
            <h6 class="section-title">Detalles Acad√©micos</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <strong>Ciclo Lectivo:</strong>
                <p id="confirmCicloLectivo" class="info-text"></p>
              </div>
              <div class="col-md-6">
                <strong>Enlace (URL):</strong>
                <p id="confirmEnlace" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Descripci√≥n -->
          <div class="section-container mb-4">
            <div class="row">
              <div class="col-12">
                <strong>Descripci√≥n:</strong>
                <p id="confirmDescripcion" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Ubicaci√≥n y Disponibilidad -->
          <div class="section-container mb-4">
            <h6 class="section-title">Ubicaci√≥n y Disponibilidad</h6>
            <div class="row g-3">
              <div class="col-md-4">
                <strong>Sede:</strong>
                <p id="confirmSede" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Disponibilidad:</strong>
                <p id="confirmDisponibilidad" class="info-text"></p>
              </div>
              <div class="col-md-4">
                <strong>Ejemplar N¬∞:</strong>
                <p id="confirmEjemplarNum" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Observaciones -->
          <div class="section-container mb-4">
            <h6 class="section-title">Observaciones</h6>
            <div class="row">
              <div class="col-12">
                <p id="confirmObservaciones" class="info-text"></p>
              </div>
            </div>
          </div>

          <!-- Imagen -->
          <div class="section-container mb-4">
            <h6 class="section-title">Imagen</h6>
            <div class="row">
              <div class="col-12">
                <p id="confirmImagen" class="info-text"></p>
              </div>
            </div>
          </div>
        </div>  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnConfirmarAltaMaterial">Confirmar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- SCRIPT CON DEPENDENCIA CARRERA-MATERIA -->
<script>
// Script para el formulario de programa (paste.txt - primer template)
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Formulario programa cargado');
    
    const form = document.getElementById('form_alta_material');
    const carreraSelect = document.getElementById('id_carrera');
    const materiaSelect = document.getElementById('id_materia');
    
    // Materias por carrera
    const materiasPorCarrera = {
        'Profesorado de Educaci√≥n Inicial': [
            'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n', 
            'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
            'Did√°ctica General', 'Curriculum y Did√°ctica del Nivel Inicial', 
            'Juego y Desarrollo Infantil', 'Literatura Infantil', 'Matem√°tica y su Did√°ctica',
            'Ciencias Sociales y su Did√°ctica', 'Ciencias Naturales y su Did√°ctica',
            'Lengua y su Did√°ctica', 'Educaci√≥n Art√≠stica', 'Educaci√≥n F√≠sica',
            'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
        ],
        'Profesorado de Educaci√≥n Primaria': [
            'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
            'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
            'Did√°ctica General', 'Curriculum y Did√°ctica del Nivel Primario',
            'Matem√°tica y su Did√°ctica I', 'Matem√°tica y su Did√°ctica II',
            'Lengua y su Did√°ctica I', 'Lengua y su Did√°ctica II',
            'Ciencias Sociales y su Did√°ctica I', 'Ciencias Sociales y su Did√°ctica II',
            'Ciencias Naturales y su Did√°ctica I', 'Ciencias Naturales y su Did√°ctica II',
            'Educaci√≥n Art√≠stica', 'Educaci√≥n F√≠sica', 'Tecnolog√≠as de la Informaci√≥n',
            'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
        ],
        'Profesorado de Educaci√≥n Secundaria en Geograf√≠a': [
            'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
            'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
            'Did√°ctica General', 'Did√°ctica de la Geograf√≠a',
            'Geograf√≠a F√≠sica I', 'Geograf√≠a F√≠sica II', 'Geograf√≠a Humana I', 'Geograf√≠a Humana II',
            'Geograf√≠a de Am√©rica', 'Geograf√≠a de Argentina', 'Geograf√≠a Mundial',
            'Cartograf√≠a', 'Climatolog√≠a', 'Geomorfolog√≠a', 'Biogeograf√≠a',
            'Geograf√≠a Econ√≥mica', 'Geograf√≠a Urbana y Rural', 'Epistemolog√≠a de la Geograf√≠a',
            'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
        ],
        'Profesorado de Educaci√≥n Secundaria en Ciencias Pol√≠ticas': [
            'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
            'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
            'Did√°ctica General', 'Did√°ctica de las Ciencias Pol√≠ticas',
            'Teor√≠a Pol√≠tica', 'Historia del Pensamiento Pol√≠tico', 'Sistemas Pol√≠ticos Comparados',
            'Pol√≠tica Argentina', 'Pol√≠tica Latinoamericana', 'Relaciones Internacionales',
            'Derecho Constitucional', 'Sociolog√≠a Pol√≠tica', 'Econom√≠a Pol√≠tica',
            'Filosof√≠a Pol√≠tica', 'Metodolog√≠a de la Investigaci√≥n Social',
            'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
        ],
        'Tecnicatura Superior en An√°lisis de Sistemas': [
            'Matem√°tica', 'Ingl√©s T√©cnico', 'Arquitectura de Computadoras',
            'Sistemas Operativos', 'Algoritmos y Estructuras de Datos',
            'Programaci√≥n I', 'Programaci√≥n II', 'Programaci√≥n III',
            'Base de Datos I', 'Base de Datos II', 'An√°lisis de Sistemas I', 'An√°lisis de Sistemas II',
            'Ingenier√≠a de Software', 'Redes y Comunicaciones', 'Seguridad Inform√°tica',
            'Desarrollo Web', 'Programaci√≥n Orientada a Objetos', 'Metodolog√≠as de Desarrollo',
            'Gesti√≥n de Proyectos', 'Pr√°ctica Profesionalizante I', 'Pr√°ctica Profesionalizante II'
        ],
        'Tecnicatura Superior en Enfermer√≠a': [
            'Anatom√≠a y Fisiolog√≠a I', 'Anatom√≠a y Fisiolog√≠a II', 'Microbiolog√≠a y Parasitolog√≠a',
            'Farmacolog√≠a', 'Patolog√≠a', 'Nutrici√≥n y Dietoterapia',
            'Enfermer√≠a B√°sica', 'Enfermer√≠a M√©dica', 'Enfermer√≠a Quir√∫rgica',
            'Enfermer√≠a Materno Infantil', 'Enfermer√≠a Pedi√°trica', 'Enfermer√≠a Geri√°trica',
            'Enfermer√≠a en Salud Mental', 'Enfermer√≠a Comunitaria', 'Administraci√≥n en Enfermer√≠a',
            'Bio√©tica', 'Epidemiolog√≠a', 'Primeros Auxilios',
            'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II', 'Pr√°ctica Profesional III'
        ],
        'Tecnicatura Superior en Acompa√±amiento Terap√©utico': [
            'Psicolog√≠a General', 'Psicopatolog√≠a', 'Neurociencias', 'Desarrollo Humano',
            'Teor√≠as y T√©cnicas de Acompa√±amiento Terap√©utico', 'Comunicaci√≥n Terap√©utica',
            'Din√°micas Familiares', 'Integraci√≥n Social', 'Recreaci√≥n Terap√©utica',
            'Talleres de Expresi√≥n', 'Primeros Auxilios', 'Bio√©tica',
            'Legislaci√≥n en Salud Mental', 'Trabajo Interdisciplinario',
            'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II', 'Pr√°ctica Profesional III'
        ],
        'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
            'Matem√°tica', 'F√≠sica', 'Qu√≠mica', 'Legislaci√≥n Laboral',
            'Higiene Industrial I', 'Higiene Industrial II', 'Seguridad Industrial I', 'Seguridad Industrial II',
            'Medicina del Trabajo', 'Toxicolog√≠a Laboral', 'Ergonom√≠a',
            'Protecci√≥n contra Incendios', 'Contaminaci√≥n Ambiental', 'Gesti√≥n de Residuos',
            'Capacitaci√≥n en Seguridad', 'Investigaci√≥n de Accidentes', 'Auditor√≠as de Seguridad',
            'Gesti√≥n de Riesgos', 'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II'
        ]
    };

    // ‚úÖ VERIFICACI√ìN CR√çTICA: Solo ejecutar si estamos en la p√°gina de programa
    // Verificar si existe el campo carrera Y si es el formulario de programa
    if (form && carreraSelect && materiaSelect) {
        console.log('üéØ Inicializando funcionalidad carrera-materia para programa');
        
        // Forzar el action correcto
        form.action = '/alta-programa/';
        console.log('üîß Action corregido a:', form.action);
        
        // FUNCI√ìN para cargar materias
        function cargarMaterias(carreraSeleccionada) {
            console.log('üìö Carrera seleccionada:', carreraSeleccionada);
            
            // Limpiar opciones de materia
            materiaSelect.innerHTML = '';
            
            if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                // Agregar opci√≥n vac√≠a
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Seleccione una materia';
                materiaSelect.appendChild(opcionVacia);
                
                // Agregar materias de la carrera seleccionada
                materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                    const option = document.createElement('option');
                    option.value = materia;
                    option.textContent = materia;
                    materiaSelect.appendChild(option);
                });
                
                materiaSelect.disabled = false;
                console.log('‚úÖ Materias cargadas:', materiasPorCarrera[carreraSeleccionada].length);
            } else {
                // No hay carrera seleccionada o no tiene materias
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Primero seleccione una carrera';
                materiaSelect.appendChild(opcionVacia);
                materiaSelect.disabled = true;
                console.log('‚ö†Ô∏è No hay materias para:', carreraSeleccionada);
            }
        }
        
        // Event listener para cambio de carrera
        carreraSelect.addEventListener('change', function() {
            cargarMaterias(this.value);
        });
        
        // Inicializar estado de materia
        materiaSelect.disabled = true;
        
        // Si ya hay una carrera seleccionada al cargar (por ejemplo, por validaci√≥n de errores)
        if (carreraSelect.value) {
            cargarMaterias(carreraSelect.value);
        }
        
        // Verificar cuando se env√≠a
        form.addEventListener('submit', function(e) {
            console.log('üöÄ PROGRAMA envi√°ndose a:', form.action);
            console.log('üöÄ Method:', form.method);
        });
        
    } else {
        console.log('‚ö†Ô∏è No se encontraron elementos necesarios para programa');
        console.log('Form:', !!form, 'Carrera:', !!carreraSelect, 'Materia:', !!materiaSelect);
    }
});
</script>
{% endblock %}