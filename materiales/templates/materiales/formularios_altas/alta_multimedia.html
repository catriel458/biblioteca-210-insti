{% load static %}
<link rel="stylesheet" href="{% static 'css/style_form.css' %}">
<form id="form_alta_multimedia" method="POST" action="/alta-multimedia/" data-form-id="multimedia" data-form-type="multimedia">
  {% csrf_token %}
  <div data-block="content" data-form-type="multimedia">
    <div class="row mb-4">
        <div class="col-md-3">
            <label for="profesor" style="font-size: 14px;">Profesor/a <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="profesor" name="profesor" 
                   required placeholder="Nombre del profesor">
        </div>
        <div class="col-md-3">
            <label for="carrera" style="font-size: 14px;">Carrera <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="carrera" name="carrera" required>
                <option value="">Carrera</option>
                <option value="Profesorado de Educaci칩n Inicial">Profesorado de Educaci칩n Inicial</option>
                <option value="Profesorado de Educaci칩n Primaria">Profesorado de Educaci칩n Primaria</option>
                <option value="Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas">Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas</option>
                <option value="Profesorado de Educaci칩n Secundaria en Geograf칤a">Profesorado de Educaci칩n Secundaria en Geograf칤a</option>
                <option value="Tecnicatura Superior en Acompa침amiento Terap칠utico">Tecnicatura Superior en Acompa침amiento Terap칠utico</option>
                <option value="Tecnicatura Superior en An치lisis de Sistemas">Tecnicatura Superior en An치lisis de Sistemas</option>
                <option value="Tecnicatura Superior en Enfermer칤a">Tecnicatura Superior en Enfermer칤a</option>
                <option value="Tecnicatura Superior en Higiene y Seguridad en el Trabajo">Tecnicatura Superior en Higiene y Seguridad en el Trabajo</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="materia" style="font-size: 14px;">Materia <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="materia" name="materia" required>
                <option value="">Primero seleccione una carrera</option>
            </select>
        </div>
    </div>
    <div class="row mb-4">
        <!-- Campos iniciales para URL y t칤tulo -->
        <div class="col-md-3">
            <label for="ingresar_enlace" style="font-size: 14px;">Ingresar enlace (URL)</label>
            <div class="input-group">
                <input type="url" class="form-control form-control-sm" id="ingresar_enlace" name="ingresar_enlace" placeholder="URL del contenido multimedia">
            </div>
        </div>
        <div class="col-md-6">
            <label for="titulo_contenido" style="font-size: 14px;">Titulo del contenido <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="titulo_contenido" name="titulo_contenido" required>
        </div>
    </div>
    
    <!-- Input hidden para almacenar los grupos de multimedia -->
    <input type="hidden" id="gruposMultimedia" name="gruposMultimedia" value="">
    
    <!-- Contenedor para mostrar resumen de multimedia agregados (ANTES del bot칩n +) -->
    <div class="row">
        <div class="col-12">
            <div id="contenedor-tipos-multimedia"></div>
        </div>
    </div>
    
    <!-- Nueva fila para el bot칩n + centrado con el campo URL (DESPU칄S de los campos din치micos) -->
    <div class="row mb-4">
        <div class="col-md-3 d-flex justify-content-center">
            <button type="button" class="boton-mas" id="btn-agregar-multimedia" title="Agregar otro contenido multimedia">
                +
            </button>
        </div>
    </div>

    <!-- Contenedor para los ejemplares -->
    <div id="contenedor-ejemplares-multimedia" class="mb-4">
        <!-- Los ejemplares se generar치n aqu칤 din치micamente -->
    </div>
    
    <!-- Botones -->
    <div class="row mt-4">
        <div class="col-12 text-end">
            <button type="button" class="btn btn-secondary me-2" id="btn-cancelar-form" onclick="cancelarFormulario()">Cancelar</button>
            <button type="submit" class="btn btn-primary" onclick="prepararEnvioFormulario()">Guardar</button>
        </div>
    </div>
    <!-- Fin de botones -->
  </div>
</form>

<!-- Incluir el modal de alerta -->
{% include 'modals/alertas/vaciar_campos.html' %}

<!-- Importaci칩n del JS para el modal de vaciar campos -->
<script src="{% static 'js/alertas.js' %}"></script>

<!-- Importaci칩n del JS din치mico de ejemplares -->
<script src="{% static 'js/form_altas.js' %}"></script>

<!-- Script simplificado para funcionalidad multimedia -->
<script>
    // Inicializar gruposTiposMultimedia si no existe
    if (!window.gruposTiposMultimedia) {
        window.gruposTiposMultimedia = [];
    }

    // Funci칩n para agregar nuevo grupo de multimedia
     function agregarNuevoMultimedia() {
         console.log('Ejecutando agregarNuevoMultimedia()');
         const contenedor = document.getElementById('contenedor-tipos-multimedia');
         if (!contenedor) {
             console.error('No se encontr칩 el contenedor de tipos multimedia');
             return;
         }
         console.log('Contenedor encontrado:', contenedor);
         const index = window.gruposTiposMultimedia.length;
         console.log('칈ndice actual:', index);
         
         // Crear nuevo grupo
         const nuevoGrupo = {
             url: '',
             titulo: ''
         };
         
         window.gruposTiposMultimedia.push(nuevoGrupo);
         
         // Crear HTML para el nuevo grupo con la estructura exacta especificada
         const grupoHTML = `
             <div class="grupo-multimedia mb-3" data-index="${index}">
                 <div class="row">
                     <div class="col-md-2">
                         <label for="ingresar_enlace_${index}" style="font-size: 14px;">Ingresar enlace (URL)</label>
                         <div class="input-group">
                             <input type="url" class="form-control form-control-sm" 
                                    id="ingresar_enlace_${index}" 
                                    name="ingresar_enlace_${index}" 
                                    placeholder="URL del contenido multimedia">
                         </div>
                     </div>
                     <div class="col-md-4">
                         <label for="titulo_contenido_${index}" style="font-size: 14px;">Titulo del contenido <span class="text-danger">*</span></label>
                         <input type="text" class="form-control form-control-sm" 
                                id="titulo_contenido_${index}" 
                                name="titulo_contenido_${index}" 
                                required>
                     </div>
                     <div class="col-md-2 d-flex align-items-end">
                         <button type="button" class="btn btn-outline-danger btn-sm" 
                                 onclick="eliminarMultimedia(${index})" 
                                 title="Eliminar este contenido multimedia">
                             <i class="fas fa-trash"></i>
                         </button>
                     </div>
                 </div>
             </div>
         `;
         
         contenedor.insertAdjacentHTML('beforeend', grupoHTML);
         console.log('Nuevo grupo agregado exitosamente');
     }

    // Funci칩n para eliminar grupo de multimedia
    function eliminarMultimedia(index) {
        const grupo = document.querySelector(`[data-index="${index}"]`);
        if (grupo) {
            grupo.remove();
            window.gruposTiposMultimedia.splice(index, 1);
            // Reindexar los elementos restantes
            actualizarIndices();
        }
    }

    // Funci칩n para actualizar 칤ndices despu칠s de eliminar
     function actualizarIndices() {
         const grupos = document.querySelectorAll('.grupo-multimedia');
         grupos.forEach((grupo, nuevoIndex) => {
             grupo.setAttribute('data-index', nuevoIndex);
             const inputs = grupo.querySelectorAll('input');
             const labels = grupo.querySelectorAll('label');
             
             // Actualizar el input de URL
             inputs[0].id = `ingresar_enlace_${nuevoIndex}`;
             inputs[0].name = `ingresar_enlace_${nuevoIndex}`;
             labels[0].setAttribute('for', `ingresar_enlace_${nuevoIndex}`);
             
             // Actualizar el input de t칤tulo
             inputs[1].id = `titulo_contenido_${nuevoIndex}`;
             inputs[1].name = `titulo_contenido_${nuevoIndex}`;
             labels[1].setAttribute('for', `titulo_contenido_${nuevoIndex}`);
             
             // Actualizar el bot칩n de eliminar
             const btnEliminar = grupo.querySelector('button');
             btnEliminar.setAttribute('onclick', `eliminarMultimedia(${nuevoIndex})`);
         });
     }

    // Funci칩n de inicializaci칩n
    function inicializarFuncionalidadMultimedia() {
        console.log('游 Inicializando funcionalidad multimedia...');
        // Event listener para el bot칩n de agregar multimedia
        const btnAgregarMultimedia = document.getElementById('btn-agregar-multimedia');
        console.log('Bot칩n encontrado:', btnAgregarMultimedia);
        if (btnAgregarMultimedia) {
            btnAgregarMultimedia.addEventListener('click', function() {
                console.log('Bot칩n clickeado, ejecutando agregarNuevoMultimedia()');
                agregarNuevoMultimedia();
            });
            console.log('Event listener agregado correctamente');
        } else {
            console.error('No se encontr칩 el bot칩n btn-agregar-multimedia');
        }
        
        // Configuraci칩n de carrera-materia
        const carreraSelect = document.getElementById('carrera');
        const materiaSelect = document.getElementById('materia');
        const form = document.getElementById('form_alta_multimedia');
        
        if (carreraSelect && materiaSelect) {
        // Materias por carrera
        const materiasPorCarrera = {
            'Profesorado de Educaci칩n Inicial': [
                "An치lisis del Mundo Contempor치neo",
                "Ateneo de Naturaleza y Sociedad",
                "Ateneo de Matem치tica",
                "Ateneo de Nuevas Expresiones Est칠ticas",
                "Ateneo de Pr치cticas del Lenguaje y la Literatura",
                "Corporeidad y Motricidad",
                "Cultura, Comunicaci칩n y Educaci칩n",
                "Did치ctica de la Matem치tica",
                "Did치ctica de las Ciencias Naturales",
                "Did치ctica de las Ciencias Sociales",
                "Did치ctica de las Pr치cticas del Lenguaje y la Literatura",
                "Did치ctica General",
                "Did치ctica y Curriculum de Nivel Inicial",
                "Dimensi칩n 칄tico-Pol칤tica de la Praxis Docente",
                "Educaci칩n en y para la Salud",
                "Educaci칩n F칤sica Escolar",
                "Educaci칩n Musical",
                "Educaci칩n Pl치stica",
                "Educaci칩n Temprana",
                "Filosof칤a",
                "Historia y Prospectiva de la Educaci칩n",
                "Juego y Desarrollo Infantil",
                "Medios Audiovisuales, TICs y Educaci칩n",
                "Pedagog칤a",
                "Pol칤tica, Legislaci칩n y Administraci칩n del Trabajo Escolar",
                "Pr치ctica Docente 1",
                "Pr치ctica Docente 2",
                "Pr치ctica Docente 3",
                "Pr치ctica Docente 4",
                "Psicolog칤a del Desarrollo y el Aprendizaje 1",
                "Psicolog칤a del Desarrollo y el Aprendizaje 2",
                "Psicolog칤a Social e Institucional",
                "Reflexi칩n Filos칩fica de la Educaci칩n",
                "Taller de Ciencias Naturales",
                "Taller de Ciencias Sociales",
                "Taller de Definici칩n Institucional",
                "Taller de Lectura, Escritura y Oralidad (LEO)",
                "Taller de Literatura Infantil",
                "Taller de la Matem치tica",
                "Taller de Materiales y Objetos L칰dicos",
                "Taller de Pensamiento L칩gico Matem치tico",
                "Teor칤as Sociopol칤ticas y Educaci칩n",
                "Trayectos Formativos Opcionales"
            ],
            'Profesorado de Educaci칩n Primaria': [
                "An치lisis del Mundo Contempor치neo",
                "Arte y Educaci칩n",
                "Ateneo de Ciencias Naturales",
                "Ateneo de Ciencias Sociales",
                "Ateneo de Matem치tica",
                "Ateneo de Pr치cticas del Lenguaje y la Literatura",
                "Configuraciones Culturales del Sujeto Educativo de Primaria",
                "Corporeidad y Motricidad",
                "Cultura, Comunicaci칩n y Educaci칩n",
                "Did치ctica de la Matem치tica 1",
                "Did치ctica de la Matem치tica 2",
                "Did치ctica de las Ciencias Naturales 1",
                "Did치ctica de las Ciencias Naturales 2",
                "Did치ctica de las Ciencias Sociales 1",
                "Did치ctica de las Ciencias Sociales 2",
                "Did치ctica de Pr치cticas del Lenguaje y la Literatura 1",
                "Did치ctica de Pr치cticas del Lenguaje y la Literatura 2",
                "Did치ctica General",
                "Did치ctica y Curriculum de Nivel Primario",
                "Dimensi칩n 칄tico-Pol칤tica de la Praxis Docente",
                "Educaci칩n Art칤stica",
                "Educaci칩n F칤sica Escolar",
                "Filosof칤a",
                "Historia y Prospectiva de la Educaci칩n",
                "Medios Audiovisuales, TICs y Educaci칩n",
                "Pedagog칤a",
                "Pedagog칤a Cr칤tica de las Diferencias",
                "Pol칤tica, Legislaci칩n y Administraci칩n del Trabajo Escolar",
                "Pr치ctica Docente 1",
                "Pr치ctica Docente 2",
                "Pr치ctica Docente 3",
                "Pr치ctica Docente 4",
                "Psicolog칤a del Desarrollo y el Aprendizaje 1",
                "Psicolog칤a del Desarrollo y el Aprendizaje 2",
                "Psicolog칤a Social e Institucional",
                "Reflexi칩n Filos칩fica de la Educaci칩n",
                "Taller de Definici칩n Institucional",
                "Taller de Lectura, Escritura y Oralidad (LEO)",
                "Taller de Pensamiento L칩gico Matem치tico",
                "Teor칤as Sociopol칤ticas y Educaci칩n",
                "Trayectos Formativos Opcionales"
            ],
            'Profesorado de Educaci칩n Secundaria en Geograf칤a': [
                "Antropolog칤a",
                "Cartograf칤a",
                "Cartograf칤a Digital",
                "Cultura Digital y Educaci칩n",
                "Derechos, Interculturalidad y Ciudadan칤a",
                "Did치ctica de la Geograf칤a",
                "Did치ctica de las Ciencias Sociales",
                "Did치ctica y Curriculum",
                "Econom칤a Pol칤tica",
                "Educaci칩n Sexual Integral (ESI)",
                "Educaci칩n y Transformaciones Sociales Contempor치neas",
                "Ense침anza de la Geograf칤a",
                "Espacio de Opci칩n Institucional (EOI)",
                "Geograf칤a Ambiental",
                "Geograf칤a Ambiental de Am칠rica Latina",
                "Geograf칤a Ambiental de Argentina",
                "Geograf칤a Cultural",
                "Geograf칤a de G칠nero",
                "Geograf칤a Econ칩mica y Social Argentina",
                "Geograf칤a Pol칤tica y Geopol칤tica",
                "Geograf칤a Rural",
                "Geograf칤a Social",
                "Geograf칤a Social de Am칠rica Latina",
                "Geograf칤a Urbana",
                "Historia de los Modelos Econ칩micos de Argentina",
                "Historia Social General",
                "Introducci칩n a las Ciencias Sociales y a la Geograf칤a",
                "Organizaci칩n Econ칩mica del Espacio",
                "Pedagog칤a",
                "Pr치ctica Docente 1",
                "Pr치ctica Docente 2",
                "Pr치ctica Docente 3",
                "Pr치ctica Docente 4",
                "Problemas Ambientales Locales/Regionales: La Investigaci칩n en el Aula",
                "Problemas Filos칩ficos de la Educaci칩n",
                "Pol칤tica Educativa Argentina",
                "Psicolog칤a del Aprendizaje",
                "Reflexi칩n Filos칩fico-Pol칤tica de la Pr치ctica Docente",
                "Sociolog칤a",
                "Teor칤a y Metodolog칤a en Geograf칤a",
                "Trayectorias Educativas de J칩venes y Adultos",
                "Unidades Curriculares Optativas"
            ],
            'Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas': [
                "An치lisis de las Instituciones Educativas",
                "Antropolog칤a",
                "Cultura Digital y Educaci칩n",
                "Derecho",
                "Derechos Humanos y Ciudadan칤a",
                "Derechos, Interculturalidad y Ciudadan칤a",
                "Did치ctica de la Ciencia Pol칤tica",
                "Did치ctica de las Ciencias Sociales",
                "Did치ctica y Curriculum",
                "Econom칤a Pol칤tica",
                "Educaci칩n y Transformaciones Sociales Contempor치neas",
                "Educaci칩n Sexual Integral (ESI)",
                "Espacio de Opci칩n Institucional (EOI)",
                "Estado, Administraci칩n y Pol칤ticas P칰blicas",
                "Estado y Pol칤tica de G칠nero",
                "Fundamentos de Ciencia Pol칤tica",
                "Geograf칤a",
                "Historia Argentina",
                "Historia Latinoamericana",
                "Historia Mundial",
                "Investigaci칩n en la Ense침anza de la Ciencia Pol칤tica",
                "Opini칩n P칰blica, Medios y Pol칤tica",
                "Pedagog칤a",
                "Pensamiento Pol칤tico Pedag칩gico Latinoamericano",
                "Pol칤tica Educativa Argentina",
                "Pr치ctica Docente 1",
                "Pr치ctica Docente 2",
                "Pr치ctica Docente 3",
                "Pr치ctica Docente 4",
                "Problemas Filos칩ficos de la Educaci칩n",
                "Problem치tica y Pol칤tica Ambiental",
                "Psicolog칤a del Aprendizaje",
                "Reflexi칩n Filos칩fico-Pol칤tica de la Pr치ctica Docente",
                "Sistemas Pol칤ticos Comparados",
                "Sociolog칤a",
                "Teor칤a de las Relaciones Internacionales y Pol칤tica Internacional",
                "Teor칤a Pol칤tica 1",
                "Teor칤a Pol칤tica 2",
                "Teor칤a Pol칤tica 3",
                "Teor칤a y Derecho Constitucional",
                "Unidades Curriculares Optativas"
            ],
            'Tecnicatura Superior en An치lisis de Sistemas': [
                "츼lgebra",
                "Algoritmos y estructuras de datos 1",
                "Algoritmos y estructuras de datos 2",
                "Algoritmos y estructuras de datos 3",
                "An치lisis Matem치tico 1",
                "An치lisis Matem치tico 2",
                "Arquitectura de Computadores",
                "Aspectos legales de la Profesi칩n",
                "Base de Datos",
                "Ciencia, Tecnolog칤a y Sociedad",
                "Estad칤stica",
                "Ingenier칤a de Software 1",
                "Ingenier칤a de Software 2",
                "Ingl칠s 1",
                "Ingl칠s 2",
                "Ingl칠s 3",
                "Pr치cticas Profesionalizantes 1",
                "Pr치cticas Profesionalizantes 2",
                "Pr치cticas Profesionalizantes 3",
                "Redes y Comunicaciones",
                "Seminario de actualizaci칩n",
                "Sistemas Operativos",
                "Sistemas y Organizaciones"
            ],
            'Tecnicatura Superior en Enfermer칤a': [
                "Aspectos Bio칠ticos y Legales de la Profesi칩n",
                "Biolog칤a Humana",
                "Comunicaci칩n en Ciencias de la Salud",
                "Condiciones y Medio Ambiente del Trabajo",
                "Cuidados de la Salud Centrados en la Comunidad y la Familia",
                "Enfermer칤a Comunitaria y Pr치cticas Educativas en Salud",
                "Enfermer칤a del Adulto y del Adulto Mayor I",
                "Enfermer칤a del Adulto y el Adulto Mayor II",
                "Enfermer칤a en Emergencias y Cat치strofes",
                "Enfermer칤a en Salud Mental",
                "Enfermer칤a Materno Infantil",
                "Farmacolog칤a en Enfermer칤a",
                "Fundamentos del Cuidado",
                "Ingl칠s",
                "Introducci칩n a la Metodolog칤a de Investigaci칩n en Salud",
                "Nutrici칩n y Dietoterapia",
                "Organizaci칩n y Gesti칩n de Servicios de Enfermer칤a",
                "Pr치cticas Profesionalizantes 1",
                "Pr치cticas Profesionalizantes 2",
                "Pr치cticas Profesionalizantes 3",
                "Psicolog칤a",
                "Salud P칰blica 1",
                "Salud P칰blica 2",
                "Teor칤as Socioculturales de la Salud"
            ],
            'Tecnicatura Superior en Acompa침amiento Terap칠utico': [
                "Acompa침amiento Terap칠utico del Adulto y Adulto Mayor",
                "Acompa침amiento Terap칠utico en la Ni침ez y Adolescencia",
                "Acompa침amiento Terap칠utico",
                "Contextualizaci칩n del Campo Profesional del Acompa침amiento Terap칠utico",
                "칄tica",
                "Fundamentos de Psicolog칤a General y de Intervenci칩n Sociocomunitaria",
                "Ingl칠s",
                "Intervenci칩n Comunitaria y Recursos Sociales",
                "Investigaci칩n en Salud",
                "Modalidades de Intervenci칩n en el Acompa침amiento Terap칠utico",
                "Modelo de Ocupaci칩n Humana",
                "Organizaci칩n y Gesti칩n de los Servicios de Salud Mental",
                "Pr치cticas Profesionalizantes I",
                "Pr치cticas Profesionalizantes II",
                "Pr치cticas Profesionalizantes III",
                "Principios M칠dicos y de Psicofarmacolog칤a",
                "Psicofarmacolog칤a",
                "Psicolog칤a de los Ciclos Vitales",
                "Psicolog칤a de Grupos",
                "Psicopatolog칤a",
                "Salud P칰blica y Salud Mental",
                "Sistemas Familiares"
            ],
            'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
                "Administraci칩n de las Organizaciones",
                "Capacitaci칩n de Personal",
                "Comunicaci칩n y Administraci칩n de Medios",
                "Control de la Contaminaci칩n",
                "Derecho del Trabajo",
                "Ergonom칤a",
                "Estad칤stica",
                "F칤sica 1",
                "F칤sica 2",
                "Higiene Laboral y Medio Ambiente 1",
                "Higiene Laboral y Medio Ambiente 2",
                "Ingl칠s T칠cnico",
                "Medicina del Trabajo 1",
                "Medicina del Trabajo 2",
                "Medios de Representaci칩n",
                "Pr치ctica Profesionalizante 1",
                "Pr치ctica Profesionalizante 2",
                "Pr치ctica Profesionalizante 3",
                "Psicolog칤a Laboral",
                "Qu칤mica 1",
                "Qu칤mica 2",
                "Seguridad 1",
                "Seguridad 2",
                "Seguridad 3"
            ]
        };
        
        // Funci칩n para cargar materias
        function cargarMaterias(carreraSeleccionada) {
            materiaSelect.innerHTML = '';
            
            if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Seleccione una materia';
                materiaSelect.appendChild(opcionVacia);
                
                materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                    const option = document.createElement('option');
                    option.value = materia;
                    option.textContent = materia;
                    materiaSelect.appendChild(option);
                });
                
                materiaSelect.disabled = false;
            } else {
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Primero seleccione una carrera';
                materiaSelect.appendChild(opcionVacia);
                materiaSelect.disabled = true;
            }
        }
        
        // Event listener para cambio de carrera
        carreraSelect.addEventListener('change', function() {
            cargarMaterias(this.value);
        });
        
        // Inicializar estado
        materiaSelect.disabled = true;
        if (carreraSelect.value) {
            cargarMaterias(carreraSelect.value);
        }
        }
    }

    // Funci칩n para preparar el env칤o del formulario de multimedia
    function prepararEnvioFormulario() {
        console.log('游닋 Preparando env칤o del formulario de multimedia...');
        
        try {
            // Recopilar datos de multimedia desde los inputs del DOM
            const gruposMultimedia = [];
            const contenedor = document.getElementById('contenedor-tipos-multimedia');
            
            if (contenedor) {
                const grupos = contenedor.querySelectorAll('.grupo-multimedia');
                grupos.forEach((grupo, index) => {
                    const urlInput = grupo.querySelector(`input[name="ingresar_enlace_${index}"]`);
                    const tituloInput = grupo.querySelector(`input[name="titulo_contenido_${index}"]`);
                    
                    if (urlInput && tituloInput) {
                        gruposMultimedia.push({
                            url: urlInput.value || '',
                            titulo: tituloInput.value || ''
                        });
                    }
                });
            }
            
            // Actualizar window.gruposTiposMultimedia
            window.gruposTiposMultimedia = gruposMultimedia;
            
            // Serializar los datos si existe el input hidden
            const gruposTiposMultimediaInput = document.getElementById('gruposMultimedia');
            if (gruposTiposMultimediaInput) {
                gruposTiposMultimediaInput.value = JSON.stringify(window.gruposTiposMultimedia);
            }
            
            console.log('游닋 Datos de multimedia preparados:', {
                gruposTiposMultimedia: window.gruposTiposMultimedia
            });
        } catch (error) {
            console.error('Error al preparar el env칤o del formulario:', error);
        }
    }
    
    // Inicializar cuando el DOM est칠 listo
    document.addEventListener('DOMContentLoaded', function() {
        console.log('游늯 DOM Content Loaded - Ejecutando inicializaci칩n multimedia');
        inicializarFuncionalidadMultimedia();
    });
</script>