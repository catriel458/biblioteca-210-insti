{% load static %}
<form id="form_alta_multimedia" method="POST" action="/alta-multimedia/" data-form-id="multimedia">
  {% csrf_token %}
  <div data-block="content" data-form-type="multimedia">
    <div class="row mb-4">
        <div class="col-md-2">
            <label for="profesor" class="form-label small">Profesor/a <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="profesor" name="profesor" 
                   required placeholder="Nombre del profesor">
        </div>
        <div class="col-md-2">
            <label for="carrera" class="form-label small">Carrera <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="carrera" name="carrera" required>
                <option value="">Carrera</option>
                <option value="Profesorado de Educaci√≥n Inicial">Profesorado de Educaci√≥n Inicial</option>
                <option value="Profesorado de Educaci√≥n Primaria">Profesorado de Educaci√≥n Primaria</option>
                <option value="Profesorado de Educaci√≥n Secundaria en Ciencias Pol√≠ticas">Profesorado de Educaci√≥n Secundaria en Ciencias Pol√≠ticas</option>
                <option value="Profesorado de Educaci√≥n Secundaria en Geograf√≠a">Profesorado de Educaci√≥n Secundaria en Geograf√≠a</option>
                <option value="Tecnicatura en Acompa√±amiento Terap√©utico">Tecnicatura en Acompa√±amiento Terap√©utico</option>
                <option value="Tecnicatura Superior en An√°lisis de Sistemas">Tecnicatura Superior en An√°lisis de Sistemas</option>
                <option value="Tecnicatura en Enfermer√≠a">Tecnicatura en Enfermer√≠a</option>
                <option value="Tecnicatura Superior en Higiene y Seguridad en el Trabajo">Tecnicatura Superior en Higiene y Seguridad en el Trabajo</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="materia" class="form-label small">Materia <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="materia" name="materia" required>
                <option value="">Primero seleccione una carrera</option>
            </select>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-2">
            <label for="ingresar_enlace" class="form-label small">Ingresar enlace (URL)</label>
            <div class="input-group">
                <input type="url" class="form-control form-control-sm" id="ingresar_enlace" name="ingresar_enlace" placeholder="URL del contenido multimedia">
            </div>
        </div>
        <div class="col-md-4">
            <label for="titulo_contenido" class="form-label small">Titulo del contenido <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="titulo_contenido" name="titulo_contenido" required>
            </div>
        </div>
    </div>

    <!-- Contenedor para los ejemplares -->
    <div id="contenedor-ejemplares-multimedia" class="mb-4">
        <!-- Los ejemplares se generar√°n aqu√≠ din√°micamente -->
    </div>
    
    <!-- Botones -->
    <div class="row mt-4">
        <div class="col-12 text-end">
            <a href="{% url 'alta_materiales' %}" class="btn btn-secondary me-2">Cancelar</a>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
    </div>
    <!-- Fin de botones -->
  </div>
</form>
<!-- Importaci√≥n del JS din√°mico de ejemplares -->
<script src="{% static 'js/form_altas.js' %}"></script>
<script src="{% static 'js/form_controller.js' %}"></script>

<!-- Script para la funcionalidad carrera-materia -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carreraSelect = document.getElementById('carrera');
        const materiaSelect = document.getElementById('materia');
        
        if (!carreraSelect || !materiaSelect) {
            console.log('‚ö†Ô∏è Elementos carrera-materia no encontrados');
            return;
        }

        // Materias por carrera
        const materiasPorCarrera = {
            'Profesorado de Educaci√≥n Inicial': [
                'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n', 
                'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
                'Did√°ctica General', 'Curriculum y Did√°ctica del Nivel Inicial', 
                'Juego y Desarrollo Infantil', 'Literatura Infantil', 'Matem√°tica y su Did√°ctica',
                'Ciencias Sociales y su Did√°ctica', 'Ciencias Naturales y su Did√°ctica',
                'Lengua y su Did√°ctica', 'Educaci√≥n Art√≠stica', 'Educaci√≥n F√≠sica',
                'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
            ],
            'Profesorado de Educaci√≥n Primaria': [
                'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
                'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
                'Did√°ctica General', 'Curriculum y Did√°ctica del Nivel Primario',
                'Matem√°tica y su Did√°ctica I', 'Matem√°tica y su Did√°ctica II',
                'Lengua y su Did√°ctica I', 'Lengua y su Did√°ctica II',
                'Ciencias Sociales y su Did√°ctica I', 'Ciencias Sociales y su Did√°ctica II',
                'Ciencias Naturales y su Did√°ctica I', 'Ciencias Naturales y su Did√°ctica II',
                'Educaci√≥n Art√≠stica', 'Educaci√≥n F√≠sica', 'Tecnolog√≠as de la Informaci√≥n',
                'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
            ],
            'Profesorado de Educaci√≥n Secundaria en Geograf√≠a': [
                'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
                'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
                'Did√°ctica General', 'Did√°ctica de la Geograf√≠a',
                'Geograf√≠a F√≠sica I', 'Geograf√≠a F√≠sica II', 'Geograf√≠a Humana I', 'Geograf√≠a Humana II',
                'Geograf√≠a de Am√©rica', 'Geograf√≠a de Argentina', 'Geograf√≠a Mundial',
                'Cartograf√≠a', 'Climatolog√≠a', 'Geomorfolog√≠a', 'Biogeograf√≠a',
                'Geograf√≠a Econ√≥mica', 'Geograf√≠a Urbana y Rural', 'Epistemolog√≠a de la Geograf√≠a',
                'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
            ],
            'Profesorado de Educaci√≥n Secundaria en Ciencias Pol√≠ticas': [
                'Pedagog√≠a', 'Psicolog√≠a Educacional', 'Sociolog√≠a de la Educaci√≥n',
                'Historia y Pol√≠tica de la Educaci√≥n Argentina', 'Filosof√≠a de la Educaci√≥n',
                'Did√°ctica General', 'Did√°ctica de las Ciencias Pol√≠ticas',
                'Teor√≠a Pol√≠tica', 'Historia del Pensamiento Pol√≠tico', 'Sistemas Pol√≠ticos Comparados',
                'Pol√≠tica Argentina', 'Pol√≠tica Latinoamericana', 'Relaciones Internacionales',
                'Derecho Constitucional', 'Sociolog√≠a Pol√≠tica', 'Econom√≠a Pol√≠tica',
                'Filosof√≠a Pol√≠tica', 'Metodolog√≠a de la Investigaci√≥n Social',
                'Pr√°ctica Docente I', 'Pr√°ctica Docente II', 'Pr√°ctica Docente III', 'Pr√°ctica Docente IV'
            ],
            'Tecnicatura Superior en An√°lisis de Sistemas': [
                'Matem√°tica', 'Ingl√©s T√©cnico', 'Arquitectura de Computadoras',
                'Sistemas Operativos', 'Algoritmos y Estructuras de Datos',
                'Programaci√≥n I', 'Programaci√≥n II', 'Programaci√≥n III',
                'Base de Datos I', 'Base de Datos II', 'An√°lisis de Sistemas I', 'An√°lisis de Sistemas II',
                'Ingenier√≠a de Software', 'Redes y Comunicaciones', 'Seguridad Inform√°tica',
                'Desarrollo Web', 'Programaci√≥n Orientada a Objetos', 'Metodolog√≠as de Desarrollo',
                'Gesti√≥n de Proyectos', 'Pr√°ctica Profesionalizante I', 'Pr√°ctica Profesionalizante II'
            ],
            'Tecnicatura en Enfermer√≠a': [
                'Anatom√≠a y Fisiolog√≠a I', 'Anatom√≠a y Fisiolog√≠a II', 'Microbiolog√≠a y Parasitolog√≠a',
                'Farmacolog√≠a', 'Patolog√≠a', 'Nutrici√≥n y Dietoterapia',
                'Enfermer√≠a B√°sica', 'Enfermer√≠a M√©dica', 'Enfermer√≠a Quir√∫rgica',
                'Enfermer√≠a Materno Infantil', 'Enfermer√≠a Pedi√°trica', 'Enfermer√≠a Geri√°trica',
                'Enfermer√≠a en Salud Mental', 'Enfermer√≠a Comunitaria', 'Administraci√≥n en Enfermer√≠a',
                'Bio√©tica', 'Epidemiolog√≠a', 'Primeros Auxilios',
                'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II', 'Pr√°ctica Profesional III'
            ],
            'Tecnicatura en Acompa√±amiento Terap√©utico': [
                'Psicolog√≠a General', 'Psicopatolog√≠a', 'Neurociencias', 'Desarrollo Humano',
                'Teor√≠as y T√©cnicas de Acompa√±amiento Terap√©utico', 'Comunicaci√≥n Terap√©utica',
                'Din√°micas Familiares', 'Integraci√≥n Social', 'Recreaci√≥n Terap√©utica',
                'Talleres de Expresi√≥n', 'Primeros Auxilios', 'Bio√©tica',
                'Legislaci√≥n en Salud Mental', 'Trabajo Interdisciplinario',
                'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II', 'Pr√°ctica Profesional III'
            ],
            'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
                'Matem√°tica', 'F√≠sica', 'Qu√≠mica', 'Legislaci√≥n Laboral',
                'Higiene Industrial I', 'Higiene Industrial II', 'Seguridad Industrial I', 'Seguridad Industrial II',
                'Medicina del Trabajo', 'Toxicolog√≠a Laboral', 'Ergonom√≠a',
                'Protecci√≥n contra Incendios', 'Contaminaci√≥n Ambiental', 'Gesti√≥n de Residuos',
                'Capacitaci√≥n en Seguridad', 'Investigaci√≥n de Accidentes', 'Auditor√≠as de Seguridad',
                'Gesti√≥n de Riesgos', 'Pr√°ctica Profesional I', 'Pr√°ctica Profesional II'
            ]
        };

        // ‚úÖ VERIFICACI√ìN CR√çTICA: Solo ejecutar si estamos en la p√°gina de multimedia
        // Verificar si existe el campo carrera Y si es el formulario de multimedia
        if (form && carreraSelect && materiaSelect) {
            console.log('üéØ Inicializando funcionalidad carrera-materia para multimedia');
            
            // Forzar el action correcto si es necesario
            if (form.action === '') {
                form.action = '/alta-multimedia/';
                console.log('üîß Action corregido a:', form.action);
            }
            
            // FUNCI√ìN para cargar materias
            function cargarMaterias(carreraSeleccionada) {
                console.log('üìö Carrera seleccionada:', carreraSeleccionada);
                
                // Limpiar opciones de materia
                materiaSelect.innerHTML = '';
                
                if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                    // Agregar opci√≥n vac√≠a
                    const opcionVacia = document.createElement('option');
                    opcionVacia.value = '';
                    opcionVacia.textContent = 'Seleccione una materia';
                    materiaSelect.appendChild(opcionVacia);
                    
                    // Agregar materias de la carrera seleccionada
                    materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                        const option = document.createElement('option');
                        option.value = materia;
                        option.textContent = materia;
                        materiaSelect.appendChild(option);
                    });
                    
                    materiaSelect.disabled = false;
                    console.log('‚úÖ Materias cargadas:', materiasPorCarrera[carreraSeleccionada].length);
                } else {
                    // No hay carrera seleccionada o no tiene materias
                    const opcionVacia = document.createElement('option');
                    opcionVacia.value = '';
                    opcionVacia.textContent = 'Primero seleccione una carrera';
                    materiaSelect.appendChild(opcionVacia);
                    materiaSelect.disabled = true;
                    console.log('‚ö†Ô∏è No hay materias para:', carreraSeleccionada);
                }
            }
            
            // Event listener para cambio de carrera
            carreraSelect.addEventListener('change', function() {
                cargarMaterias(this.value);
            });
            
            // Inicializar estado de materia
            materiaSelect.disabled = true;
            
            // Si ya hay una carrera seleccionada al cargar (por ejemplo, por validaci√≥n de errores)
            if (carreraSelect.value) {
                cargarMaterias(carreraSelect.value);
            }
            
            // Verificar cuando se env√≠a
            form.addEventListener('submit', function(e) {
                console.log('üöÄ MULTIMEDIA envi√°ndose a:', form.action);
            });
        }
    });
</script>