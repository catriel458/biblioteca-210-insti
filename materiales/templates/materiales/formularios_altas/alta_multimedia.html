{% load static %}
<link rel="stylesheet" href="{% static 'css/style_form.css' %}">
<form id="form_alta_multimedia" method="POST" action="/alta-multimedia/" data-form-id="multimedia">
  {% csrf_token %}
  <div data-block="content" data-form-type="multimedia">
    <div class="row mb-4">
        <div class="col-md-3">
            <label for="profesor" style="font-size: 14px;">Profesor/a <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="profesor" name="profesor" 
                   required placeholder="Nombre del profesor">
        </div>
        <div class="col-md-3">
            <label for="carrera" style="font-size: 14px;">Carrera <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="carrera" name="carrera" required>
                <option value="">Carrera</option>
                <option value="Profesorado de Educaci칩n Inicial">Profesorado de Educaci칩n Inicial</option>
                <option value="Profesorado de Educaci칩n Primaria">Profesorado de Educaci칩n Primaria</option>
                <option value="Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas">Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas</option>
                <option value="Profesorado de Educaci칩n Secundaria en Geograf칤a">Profesorado de Educaci칩n Secundaria en Geograf칤a</option>
                <option value="Tecnicatura en Acompa침amiento Terap칠utico">Tecnicatura en Acompa침amiento Terap칠utico</option>
                <option value="Tecnicatura Superior en An치lisis de Sistemas">Tecnicatura Superior en An치lisis de Sistemas</option>
                <option value="Tecnicatura en Enfermer칤a">Tecnicatura en Enfermer칤a</option>
                <option value="Tecnicatura Superior en Higiene y Seguridad en el Trabajo">Tecnicatura Superior en Higiene y Seguridad en el Trabajo</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="materia" style="font-size: 14px;">Materia <span class="text-danger">*</span></label>
            <select class="form-control form-control-sm" id="materia" name="materia" required>
                <option value="">Primero seleccione una carrera</option>
            </select>
        </div>
    </div>
    <div class="row mb-4">
        <!-- Campos iniciales para URL y t칤tulo -->
        <div class="col-md-3">
            <label for="ingresar_enlace" style="font-size: 14px;">Ingresar enlace (URL)</label>
            <div class="input-group">
                <input type="url" class="form-control form-control-sm" id="ingresar_enlace" name="ingresar_enlace" placeholder="URL del contenido multimedia">
            </div>
        </div>
        <div class="col-md-6">
            <label for="titulo_contenido" style="font-size: 14px;">Titulo del contenido <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="titulo_contenido" name="titulo_contenido" required>
        </div>
    </div>
    
    <!-- Input hidden para almacenar los grupos de multimedia -->
    <input type="hidden" id="gruposMultimedia" name="gruposMultimedia" value="">
    
    <!-- Contenedor para mostrar resumen de multimedia agregados (ANTES del bot칩n +) -->
    <div class="row">
        <div class="col-12">
            <div id="contenedor-tipos-multimedia"></div>
        </div>
    </div>
    
    <!-- Nueva fila para el bot칩n + centrado con el campo URL (DESPU칄S de los campos din치micos) -->
    <div class="row mb-4">
        <div class="col-md-3 d-flex justify-content-center">
            <button type="button" class="boton-mas" id="btn-agregar-multimedia" title="Agregar otro contenido multimedia">
                +
            </button>
        </div>
    </div>

    <!-- Contenedor para los ejemplares -->
    <div id="contenedor-ejemplares-multimedia" class="mb-4">
        <!-- Los ejemplares se generar치n aqu칤 din치micamente -->
    </div>
    
    <!-- Botones -->
    <div class="row mt-4">
        <div class="col-12 text-end">
            <a href="{% url 'alta_materiales' %}" class="btn btn-secondary me-2">Cancelar</a>
            <button type="submit" class="btn btn-primary" onclick="prepararEnvioFormulario()">Guardar</button>
        </div>
    </div>
    <!-- Fin de botones -->
  </div>
</form>
<!-- Importaci칩n del JS din치mico de ejemplares -->
<script src="{% static 'js/form_altas.js' %}"></script>

<!-- Script simplificado para funcionalidad multimedia -->
<script>
    // Inicializar gruposTiposMultimedia si no existe
    if (!window.gruposTiposMultimedia) {
        window.gruposTiposMultimedia = [];
    }

    // Funci칩n para agregar nuevo grupo de multimedia
     function agregarNuevoMultimedia() {
         console.log('Ejecutando agregarNuevoMultimedia()');
         const contenedor = document.getElementById('contenedor-tipos-multimedia');
         console.log('Contenedor encontrado:', contenedor);
         const index = window.gruposTiposMultimedia.length;
         console.log('칈ndice actual:', index);
         
         // Crear nuevo grupo
         const nuevoGrupo = {
             url: '',
             titulo: ''
         };
         
         window.gruposTiposMultimedia.push(nuevoGrupo);
         
         // Crear HTML para el nuevo grupo con la estructura exacta especificada
         const grupoHTML = `
             <div class="grupo-multimedia mb-3" data-index="${index}">
                 <div class="row">
                     <div class="col-md-2">
                         <label for="ingresar_enlace_${index}" style="font-size: 14px;">Ingresar enlace (URL)</label>
                         <div class="input-group">
                             <input type="url" class="form-control form-control-sm" 
                                    id="ingresar_enlace_${index}" 
                                    name="ingresar_enlace_${index}" 
                                    placeholder="URL del contenido multimedia">
                         </div>
                     </div>
                     <div class="col-md-4">
                         <label for="titulo_contenido_${index}" style="font-size: 14px;">Titulo del contenido <span class="text-danger">*</span></label>
                         <input type="text" class="form-control form-control-sm" 
                                id="titulo_contenido_${index}" 
                                name="titulo_contenido_${index}" 
                                required>
                     </div>
                     <div class="col-md-2 d-flex align-items-end">
                         <button type="button" class="btn btn-outline-danger btn-sm" 
                                 onclick="eliminarMultimedia(${index})" 
                                 title="Eliminar este contenido multimedia">
                             <i class="fas fa-trash"></i>
                         </button>
                     </div>
                 </div>
             </div>
         `;
         
         contenedor.insertAdjacentHTML('beforeend', grupoHTML);
         console.log('Nuevo grupo agregado exitosamente');
     }

    // Funci칩n para eliminar grupo de multimedia
    function eliminarMultimedia(index) {
        const grupo = document.querySelector(`[data-index="${index}"]`);
        if (grupo) {
            grupo.remove();
            window.gruposTiposMultimedia.splice(index, 1);
            // Reindexar los elementos restantes
            actualizarIndices();
        }
    }

    // Funci칩n para actualizar 칤ndices despu칠s de eliminar
     function actualizarIndices() {
         const grupos = document.querySelectorAll('.grupo-multimedia');
         grupos.forEach((grupo, nuevoIndex) => {
             grupo.setAttribute('data-index', nuevoIndex);
             const inputs = grupo.querySelectorAll('input');
             const labels = grupo.querySelectorAll('label');
             
             // Actualizar el input de URL
             inputs[0].id = `ingresar_enlace_${nuevoIndex}`;
             inputs[0].name = `ingresar_enlace_${nuevoIndex}`;
             labels[0].setAttribute('for', `ingresar_enlace_${nuevoIndex}`);
             
             // Actualizar el input de t칤tulo
             inputs[1].id = `titulo_contenido_${nuevoIndex}`;
             inputs[1].name = `titulo_contenido_${nuevoIndex}`;
             labels[1].setAttribute('for', `titulo_contenido_${nuevoIndex}`);
             
             // Actualizar el bot칩n de eliminar
             const btnEliminar = grupo.querySelector('button');
             btnEliminar.setAttribute('onclick', `eliminarMultimedia(${nuevoIndex})`);
         });
     }

    // Funci칩n de inicializaci칩n
    function inicializarFuncionalidadMultimedia() {
        console.log('游 Inicializando funcionalidad multimedia...');
        // Event listener para el bot칩n de agregar multimedia
        const btnAgregarMultimedia = document.getElementById('btn-agregar-multimedia');
        console.log('Bot칩n encontrado:', btnAgregarMultimedia);
        if (btnAgregarMultimedia) {
            btnAgregarMultimedia.addEventListener('click', function() {
                console.log('Bot칩n clickeado, ejecutando agregarNuevoMultimedia()');
                agregarNuevoMultimedia();
            });
            console.log('Event listener agregado correctamente');
        } else {
            console.error('No se encontr칩 el bot칩n btn-agregar-multimedia');
        }
        
        // Configuraci칩n de carrera-materia
        const carreraSelect = document.getElementById('carrera');
        const materiaSelect = document.getElementById('materia');
        const form = document.getElementById('form_alta_multimedia');
        
        if (carreraSelect && materiaSelect) {
        // Materias por carrera
        const materiasPorCarrera = {
            'Profesorado de Educaci칩n Inicial': [
                'Pedagog칤a', 'Psicolog칤a Educacional', 'Sociolog칤a de la Educaci칩n', 
                'Historia y Pol칤tica de la Educaci칩n Argentina', 'Filosof칤a de la Educaci칩n',
                'Did치ctica General', 'Curriculum y Did치ctica del Nivel Inicial', 
                'Juego y Desarrollo Infantil', 'Literatura Infantil', 'Matem치tica y su Did치ctica',
                'Ciencias Sociales y su Did치ctica', 'Ciencias Naturales y su Did치ctica',
                'Lengua y su Did치ctica', 'Educaci칩n Art칤stica', 'Educaci칩n F칤sica',
                'Pr치ctica Docente I', 'Pr치ctica Docente II', 'Pr치ctica Docente III', 'Pr치ctica Docente IV'
            ],
            'Profesorado de Educaci칩n Primaria': [
                'Pedagog칤a', 'Psicolog칤a Educacional', 'Sociolog칤a de la Educaci칩n',
                'Historia y Pol칤tica de la Educaci칩n Argentina', 'Filosof칤a de la Educaci칩n',
                'Did치ctica General', 'Curriculum y Did치ctica del Nivel Primario',
                'Matem치tica y su Did치ctica I', 'Matem치tica y su Did치ctica II',
                'Lengua y su Did치ctica I', 'Lengua y su Did치ctica II',
                'Ciencias Sociales y su Did치ctica I', 'Ciencias Sociales y su Did치ctica II',
                'Ciencias Naturales y su Did치ctica I', 'Ciencias Naturales y su Did치ctica II',
                'Educaci칩n Art칤stica', 'Educaci칩n F칤sica', 'Tecnolog칤as de la Informaci칩n',
                'Pr치ctica Docente I', 'Pr치ctica Docente II', 'Pr치ctica Docente III', 'Pr치ctica Docente IV'
            ],
            'Profesorado de Educaci칩n Secundaria en Geograf칤a': [
                'Pedagog칤a', 'Psicolog칤a Educacional', 'Sociolog칤a de la Educaci칩n',
                'Historia y Pol칤tica de la Educaci칩n Argentina', 'Filosof칤a de la Educaci칩n',
                'Did치ctica General', 'Did치ctica de la Geograf칤a',
                'Geograf칤a F칤sica I', 'Geograf칤a F칤sica II', 'Geograf칤a Humana I', 'Geograf칤a Humana II',
                'Geograf칤a de Am칠rica', 'Geograf칤a de Argentina', 'Geograf칤a Mundial',
                'Cartograf칤a', 'Climatolog칤a', 'Geomorfolog칤a', 'Biogeograf칤a',
                'Geograf칤a Econ칩mica', 'Geograf칤a Urbana y Rural', 'Epistemolog칤a de la Geograf칤a',
                'Pr치ctica Docente I', 'Pr치ctica Docente II', 'Pr치ctica Docente III', 'Pr치ctica Docente IV'
            ],
            'Profesorado de Educaci칩n Secundaria en Ciencias Pol칤ticas': [
                'Pedagog칤a', 'Psicolog칤a Educacional', 'Sociolog칤a de la Educaci칩n',
                'Historia y Pol칤tica de la Educaci칩n Argentina', 'Filosof칤a de la Educaci칩n',
                'Did치ctica General', 'Did치ctica de las Ciencias Pol칤ticas',
                'Teor칤a Pol칤tica', 'Historia del Pensamiento Pol칤tico', 'Sistemas Pol칤ticos Comparados',
                'Pol칤tica Argentina', 'Pol칤tica Latinoamericana', 'Relaciones Internacionales',
                'Derecho Constitucional', 'Sociolog칤a Pol칤tica', 'Econom칤a Pol칤tica',
                'Filosof칤a Pol칤tica', 'Metodolog칤a de la Investigaci칩n Social',
                'Pr치ctica Docente I', 'Pr치ctica Docente II', 'Pr치ctica Docente III', 'Pr치ctica Docente IV'
            ],
            'Tecnicatura Superior en An치lisis de Sistemas': [
                'Matem치tica', 'Ingl칠s T칠cnico', 'Arquitectura de Computadoras',
                'Sistemas Operativos', 'Algoritmos y Estructuras de Datos',
                'Programaci칩n I', 'Programaci칩n II', 'Programaci칩n III',
                'Base de Datos I', 'Base de Datos II', 'An치lisis de Sistemas I', 'An치lisis de Sistemas II',
                'Ingenier칤a de Software', 'Redes y Comunicaciones', 'Seguridad Inform치tica',
                'Desarrollo Web', 'Programaci칩n Orientada a Objetos', 'Metodolog칤as de Desarrollo',
                'Gesti칩n de Proyectos', 'Pr치ctica Profesionalizante I', 'Pr치ctica Profesionalizante II'
            ],
            'Tecnicatura en Enfermer칤a': [
                'Anatom칤a y Fisiolog칤a I', 'Anatom칤a y Fisiolog칤a II', 'Microbiolog칤a y Parasitolog칤a',
                'Farmacolog칤a', 'Patolog칤a', 'Nutrici칩n y Dietoterapia',
                'Enfermer칤a B치sica', 'Enfermer칤a M칠dica', 'Enfermer칤a Quir칰rgica',
                'Enfermer칤a Materno Infantil', 'Enfermer칤a Pedi치trica', 'Enfermer칤a Geri치trica',
                'Enfermer칤a en Salud Mental', 'Enfermer칤a Comunitaria', 'Administraci칩n en Enfermer칤a',
                'Bio칠tica', 'Epidemiolog칤a', 'Primeros Auxilios',
                'Pr치ctica Profesional I', 'Pr치ctica Profesional II', 'Pr치ctica Profesional III'
            ],
            'Tecnicatura en Acompa침amiento Terap칠utico': [
                'Psicolog칤a General', 'Psicopatolog칤a', 'Neurociencias', 'Desarrollo Humano',
                'Teor칤as y T칠cnicas de Acompa침amiento Terap칠utico', 'Comunicaci칩n Terap칠utica',
                'Din치micas Familiares', 'Integraci칩n Social', 'Recreaci칩n Terap칠utica',
                'Talleres de Expresi칩n', 'Primeros Auxilios', 'Bio칠tica',
                'Legislaci칩n en Salud Mental', 'Trabajo Interdisciplinario',
                'Pr치ctica Profesional I', 'Pr치ctica Profesional II', 'Pr치ctica Profesional III'
            ],
            'Tecnicatura Superior en Higiene y Seguridad en el Trabajo': [
                'Matem치tica', 'F칤sica', 'Qu칤mica', 'Legislaci칩n Laboral',
                'Higiene Industrial I', 'Higiene Industrial II', 'Seguridad Industrial I', 'Seguridad Industrial II',
                'Medicina del Trabajo', 'Toxicolog칤a Laboral', 'Ergonom칤a',
                'Protecci칩n contra Incendios', 'Contaminaci칩n Ambiental', 'Gesti칩n de Residuos',
                'Capacitaci칩n en Seguridad', 'Investigaci칩n de Accidentes', 'Auditor칤as de Seguridad',
                'Gesti칩n de Riesgos', 'Pr치ctica Profesional I', 'Pr치ctica Profesional II'
            ]
        };
        
        // Funci칩n para cargar materias
        function cargarMaterias(carreraSeleccionada) {
            materiaSelect.innerHTML = '';
            
            if (carreraSeleccionada && materiasPorCarrera[carreraSeleccionada]) {
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Seleccione una materia';
                materiaSelect.appendChild(opcionVacia);
                
                materiasPorCarrera[carreraSeleccionada].forEach(function(materia) {
                    const option = document.createElement('option');
                    option.value = materia;
                    option.textContent = materia;
                    materiaSelect.appendChild(option);
                });
                
                materiaSelect.disabled = false;
            } else {
                const opcionVacia = document.createElement('option');
                opcionVacia.value = '';
                opcionVacia.textContent = 'Primero seleccione una carrera';
                materiaSelect.appendChild(opcionVacia);
                materiaSelect.disabled = true;
            }
        }
        
        // Event listener para cambio de carrera
        carreraSelect.addEventListener('change', function() {
            cargarMaterias(this.value);
        });
        
        // Inicializar estado
        materiaSelect.disabled = true;
        if (carreraSelect.value) {
            cargarMaterias(carreraSelect.value);
        }
        }
    }

    // Funci칩n para preparar el env칤o del formulario de multimedia
    function prepararEnvioFormulario() {
        console.log('游닋 Preparando env칤o del formulario de multimedia...');
        
        // Recopilar datos de multimedia desde los inputs del DOM
        const gruposMultimedia = [];
        const contenedor = document.getElementById('contenedor-ejemplares-multimedia');
        
        if (contenedor) {
            const grupos = contenedor.querySelectorAll('.grupo-multimedia');
            grupos.forEach((grupo, index) => {
                const urlInput = grupo.querySelector(`input[name="ingresar_enlace_${index}"]`);
                const tituloInput = grupo.querySelector(`input[name="titulo_contenido_${index}"]`);
                
                if (urlInput && tituloInput) {
                    gruposMultimedia.push({
                        url: urlInput.value || '',
                        titulo: tituloInput.value || ''
                    });
                }
            });
        }
        
        // Actualizar window.gruposTiposMultimedia
        window.gruposTiposMultimedia = gruposMultimedia;
        
        // Serializar los datos si existe el input hidden
        const gruposTiposMultimediaInput = document.getElementById('gruposTiposMultimedia');
        if (gruposTiposMultimediaInput) {
            gruposTiposMultimediaInput.value = JSON.stringify(window.gruposTiposMultimedia);
        }
        
        console.log('游닋 Datos de multimedia preparados:', {
            gruposTiposMultimedia: window.gruposTiposMultimedia
        });
    }
    
    // Inicializar cuando el DOM est칠 listo
    document.addEventListener('DOMContentLoaded', function() {
        console.log('游늯 DOM Content Loaded - Ejecutando inicializaci칩n multimedia');
        inicializarFuncionalidadMultimedia();
    });
</script>